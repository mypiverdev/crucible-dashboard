<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CremoLogix — Specification</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --navy: #1E3A5F; --blue: #2D7DD2; --green: #28A745; --amber: #F4A261;
  --red: #E63946; --light-bg: #F8F9FA; --text: #333333; --text-light: #666666;
  --border: #DEE2E6; --white: #FFFFFF;
}
@page { size: letter; margin: 0.75in; }
html { font-size: 10.5pt; }
body { font-family: system-ui, 'Segoe UI', sans-serif; color: var(--text); line-height: 1.6; background: var(--white); }
@media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .cover { box-shadow: none !important; } .no-print { display: none !important; } }
.cover { background: linear-gradient(135deg, #1E3A5F 0%, #0F1F33 60%, #162D4A 100%); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 100vh; position: relative; overflow: hidden; }
.cover::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(ellipse at 30% 20%, rgba(45,125,210,0.12) 0%, transparent 50%), radial-gradient(ellipse at 70% 80%, rgba(45,125,210,0.08) 0%, transparent 50%); pointer-events: none; }
.cover-content { position: relative; z-index: 1; max-width: 700px; }
.cover .brand-mark { font-size: 1.4rem; font-weight: 300; letter-spacing: 0.35em; text-transform: uppercase; color: rgba(255,255,255,0.7); margin-bottom: 60px; border: 1px solid rgba(255,255,255,0.2); display: inline-block; padding: 10px 28px; border-radius: 4px; }
.cover h1 { font-size: 3rem; color: white; margin-bottom: 20px; font-weight: 700; letter-spacing: -0.02em; }
.cover .subtitle { font-size: 1.3rem; color: rgba(255,255,255,0.8); font-weight: 300; margin-bottom: 60px; line-height: 1.5; }
.cover .divider-line { width: 80px; height: 2px; background: var(--blue); margin: 0 auto 40px; }
.cover .meta { font-size: 0.95rem; color: rgba(255,255,255,0.6); line-height: 2; }
.cover .confidential { position: absolute; bottom: 40px; left: 0; right: 0; text-align: center; font-size: 0.8rem; letter-spacing: 0.15em; text-transform: uppercase; color: rgba(255,255,255,0.35); }
.page-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 56px; border-bottom: 2px solid var(--navy); font-size: 0.78rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.08em; }
.page-header .logo-text { font-weight: 700; color: var(--navy); letter-spacing: 0.15em; }
.content { padding: 48px 56px; max-width: 900px; margin: 0 auto; }
h1 { font-size: 2.4rem; color: var(--navy); font-weight: 700; letter-spacing: -0.02em; line-height: 1.2; margin: 36px 0 16px; }
h2 { font-size: 1.6rem; color: var(--navy); font-weight: 700; letter-spacing: -0.01em; line-height: 1.3; margin: 32px 0 14px; border-bottom: 2px solid var(--blue); padding-bottom: 8px; }
h3 { font-size: 1.2rem; color: var(--navy); font-weight: 600; line-height: 1.3; margin: 24px 0 10px; }
h4 { font-size: 1.05rem; color: var(--navy); font-weight: 600; margin: 18px 0 8px; }
p { margin-bottom: 14px; line-height: 1.7; }
strong { color: var(--navy); }
ul, ol { margin-bottom: 16px; padding-left: 0; list-style: none; }
ul li, ol li { padding: 6px 0 6px 26px; position: relative; line-height: 1.6; }
ul li::before { content: '\25B6'; position: absolute; left: 0; color: var(--blue); font-size: 0.55rem; top: 12px; }
ol { counter-reset: item; }
ol li { counter-increment: item; }
ol li::before { content: counter(item); position: absolute; left: 0; width: 22px; height: 22px; background: var(--navy); color: #fff; border-radius: 50%; font-size: 0.7rem; font-weight: 700; display: flex; align-items: center; justify-content: center; top: 8px; }
table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.92rem; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
thead th { background: var(--navy); color: white; padding: 12px 16px; text-align: left; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.04em; border: 1px solid #15304D; }
tbody td { padding: 11px 16px; border: 1px solid var(--border); vertical-align: top; line-height: 1.5; }
tbody tr:nth-child(even) { background: #F8F9FA; }
tbody tr:hover { background: #EBF3FB; }
blockquote { border-left: 4px solid var(--blue); background: #EBF3FB; padding: 20px 24px; border-radius: 0 8px 8px 0; margin: 20px 0; }
blockquote p:last-child { margin-bottom: 0; }
code { background: rgba(45,125,210,0.08); padding: 2px 7px; border-radius: 4px; font-size: 0.88rem; color: var(--blue); font-weight: 500; }
pre { background: #1b2e4a; color: #e2e8f0; padding: 20px 24px; border-radius: 10px; overflow-x: auto; margin: 20px 0; box-shadow: 0 4px 12px rgba(26,43,74,0.12); }
pre code { background: none; padding: 0; color: #e2e8f0; font-size: 0.85rem; }
hr { border: none; height: 2px; background: linear-gradient(90deg, var(--blue), transparent); margin: 32px 0; }
a { color: var(--blue); text-decoration: none; font-weight: 500; }
a:hover { text-decoration: underline; }
img { max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin: 16px 0; }
.back-link { position: fixed; top: 16px; right: 20px; z-index: 100; background: var(--navy); color: white; padding: 8px 18px; border-radius: 6px; font-size: 0.82rem; font-weight: 600; text-decoration: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: background 0.15s; }
.back-link:hover { background: #264E7A; text-decoration: none; color: white; }
</style>
</head>
<body>
<a class="back-link no-print" href="../..">&#8592; Dashboard</a>
<div class="cover">
  <div class="cover-content">
    <div class="brand-mark">CremoLogix</div>
    <h1>Specification</h1>
    <div class="subtitle">AI-assisted underwriting platform for CDFIs — automates financial analysis while maintaining full human control over credit decisions</div>
    <div class="divider-line"></div>
    <div class="meta">February 13, 2026<br>Crucible Product Development Pipeline</div>
  </div>
  <div class="confidential">Confidential</div>
</div>
<div class="page-header no-print">
  <span class="logo-text">CremoLogix</span>
  <span>Specification</span>
</div>
<div class="content" id="content"></div>
<script>
  const md = "# CremoLogix -- Technical & Prototype Specification\n\n**Crucible Document Type:** Specification\n**Status:** Implementation-Ready\n**Sources:**\n- `C:/projects/CremoLogix_Technical_Spec.md` (Technical Specification v1.0.0-MVP)\n- `C:/projects/CremoLogix_Prototype_Spec_v2.md` (Prototype Specification v2)\n\n---\n\n## Table of Contents\n\n1. [Executive Summary](#1-executive-summary)\n2. [System Architecture Overview](#2-system-architecture-overview)\n3. [Data Models & Database Schema](#3-data-models--database-schema)\n4. [API Contract Specification](#4-api-contract-specification)\n5. [AI/ML Pipeline Specification](#5-aiml-pipeline-specification)\n6. [Integration Specifications](#6-integration-specifications)\n7. [Security Architecture](#7-security-architecture)\n8. [Workflow Engine Design](#8-workflow-engine-design)\n9. [Audit Trail Architecture](#9-audit-trail-architecture)\n10. [Non-Functional Requirements](#10-non-functional-requirements)\n11. [MVP Scope Boundaries](#11-mvp-scope-boundaries)\n12. [Dependency Matrix](#12-dependency-matrix)\n13. [Prototype Design System](#13-prototype-design-system)\n14. [Prototype Screen Inventory](#14-prototype-screen-inventory)\n15. [Screen Navigation Map](#15-screen-navigation-map)\n\n---\n\n## 1. Executive Summary\n\n### Purpose\n\nThis specification consolidates the full technical blueprint and UI prototype definition for CremoLogix MVP. It translates validated business analysis outputs into an implementable engineering plan covering every data model, API contract, AI pipeline, integration point, infrastructure requirement, and screen design.\n\n### What CremoLogix Is\n\nCremoLogix is an AI-assisted underwriting sidecar platform for Community Development Financial Institutions (CDFIs). It automates document processing, financial analysis, risk assessment, scoring, and credit memo generation while keeping a human underwriter in the decision loop at every critical juncture. CremoLogix does NOT approve or decline loans -- it produces a scored, evidence-backed underwriting package that a Credit Manager reviews and decides upon.\n\n### MVP Scope\n\n- **Single tenant:** Siura Capital (pilot CDFI)\n- **Four user roles:** Borrower, Underwriter, Credit Manager, Administrator\n- **13-phase underwriting workflow** from intake through closeout\n- **84 screens** across 9 portals (Borrower, Denied Applicant, Broker, Intake Agent, Underwriter, Credit Manager, External Funding, FinOps, Administrator) plus 9 SPA demo shells\n- **Salesforce integration** for TOS referral channel\n- **Basic LOS export** via sidecar API pattern\n- **AI pipelines** for OCR, extraction, financial analysis, risk assessment, scoring, and credit memo generation\n\n---\n\n## 2. System Architecture Overview\n\n### 2.1 High-Level Architecture\n\n```\n+------------------------------------------------------------------+\n|                        CLIENTS                                    |\n|  +------------+  +-------------+  +------------+  +------------+ |\n|  | Borrower   |  | Underwriter |  | Credit Mgr |  | Admin      | |\n|  | Portal     |  | Portal      |  | Portal     |  | Portal     | |\n|  | (React SPA)|  | (React SPA) |  | (React SPA)|  | (React SPA)| |\n|  +------+-----+  +------+------+  +------+-----+  +------+-----+ |\n+---------|----------------|----------------|----------------|------+\n          |                |                |                |\n          v                v                v                v\n+------------------------------------------------------------------+\n|                     API GATEWAY / LOAD BALANCER                   |\n|              (Rate Limiting, CORS, Auth Routing)                  |\n+----------------------------------+-------------------------------+\n                                   |\n          +------------------------+------------------------+\n          |                                                 |\n+---------v-----------+                       +-------------v--------+\n|   AUTH SERVICE      |                       |   NOTIFICATION SVC   |\n| - JWT issuance      |                       | - Email dispatch     |\n| - Token refresh     |                       | - In-app notices     |\n| - Password reset    |                       | - Template engine    |\n| - Email verify      |                       +----------------------+\n+---------------------+\n          |\n+---------v------------------------------------------------------------+\n|                        CORE API SERVER (Node.js / NestJS)            |\n|                                                                      |\n|  +------------------+ +------------------+ +----------------------+  |\n|  | Case Management  | | Financial Engine | | Scoring Engine       |  |\n|  | - CRUD           | | - Spread compute | | - Factor evaluation  |  |\n|  | - Phase workflow  | | - Ratio calc     | | - Weight application |  |\n|  | - Assignments    | | - Trend analysis | | - Recommendation     |  |\n|  +------------------+ +------------------+ +----------------------+  |\n|                                                                      |\n|  +------------------+ +------------------+ +----------------------+  |\n|  | Document Mgmt    | | Risk Assessment  | | Packet Assembly      |  |\n|  | - Upload/store   | | - Rule engine    | | - Memo generation    |  |\n|  | - Status track   | | - Narrative gen  | | - PDF/Word export    |  |\n|  +------------------+ +------------------+ +----------------------+  |\n|                                                                      |\n|  +------------------+ +------------------+ +----------------------+  |\n|  | Admin Config     | | Audit Service    | | Integration Layer    |  |\n|  | - Products       | | - Event capture  | | - Salesforce         |  |\n|  | - Scoring models | | - Immutable log  | | - LOS sidecar       |  |\n|  | - Workflows      | | - Query/export   | | - Email service      |  |\n|  +------------------+ +------------------+ +----------------------+  |\n+-------------------+--------------------------------------------------+\n                    |\n     +--------------+--------------+\n     |              |              |\n+----v-----+  +----v-----+  +----v-----------+\n| PostgreSQL|  | Redis    |  | Object Storage |\n| (Primary  |  | (Cache,  |  | (S3-compatible)|\n|  Database)|  |  Queues) |  | - Documents    |\n+-----------+  +----------+  | - Exports      |\n                              +----------------+\n                    |\n     +--------------+--------------+\n     |                             |\n+----v-----------------+   +------v-----------------+\n| AI/ML PIPELINE       |   | ASYNC WORKER CLUSTER   |\n| (Python/FastAPI)     |   | (Bull/BullMQ on Redis) |\n| - OCR Service        |   | - Doc processing jobs  |\n| - Classification     |   | - Analysis jobs        |\n| - Extraction Engine  |   | - Notification jobs    |\n| - NLP / LLM Gateway |   | - Export jobs           |\n+----------------------+   +--------------------------+\n```\n\n### 2.2 Component Breakdown\n\n| Component | Technology | Responsibility |\n|-----------|-----------|---------------|\n| **Frontend SPA** | React 18 + TypeScript, Vite, TailwindCSS | All screens across all portals |\n| **API Gateway** | Azure Front Door + WAF | Rate limiting, routing, CORS, TLS termination |\n| **Core API Server** | Node.js 20 + NestJS + TypeScript | Business logic, REST endpoints, workflow engine |\n| **Auth Service** | NestJS module (internal) | JWT issuance, RBAC enforcement, session management |\n| **AI/ML Pipeline** | Python 3.11 + FastAPI | OCR, classification, extraction, NLP, LLM orchestration |\n| **Async Workers** | BullMQ on Redis | Document processing, analysis jobs, export generation |\n| **Primary Database** | PostgreSQL 16 | All relational data, row-level security |\n| **Cache / Queue** | Redis 7 | Session cache, job queues, rate limit counters |\n| **Object Storage** | Azure Blob Storage (or Azurite for dev) | Document files, generated exports |\n| **Notification Service** | NestJS module + SendGrid/SES | Email dispatch, in-app notification persistence |\n\n### 2.3 Multi-Tenant Architecture\n\nFor MVP (single tenant), multi-tenancy is implemented at the data layer with `tenant_id` foreign keys on all tenant-scoped tables. Row-Level Security (RLS) policies in PostgreSQL enforce isolation.\n\n**Approach:** Shared database, shared schema, row-level tenant isolation.\n\n- Every tenant-scoped table includes a `tenant_id UUID NOT NULL` column.\n- PostgreSQL RLS policies set `current_setting('app.current_tenant_id')` at connection time.\n- The API middleware extracts tenant context from the authenticated JWT and sets the session variable before each request.\n- Indexes include `tenant_id` as a prefix for all multi-tenant queries.\n\n**Post-MVP evolution:** If tenant count exceeds ~50 or data isolation requirements increase, migrate to schema-per-tenant.\n\n### 2.4 Deployment Model\n\n- **Cloud Provider:** Azure (primary), with Terraform for infrastructure-as-code\n- **Container Orchestration:** Azure Container Apps (MVP) -- AKS (post-MVP)\n- **CI/CD:** GitHub Actions with staging and production environments\n- **Infrastructure as Code:** Terraform\n- **Environments:** Development, Staging, Production\n- **Region:** East US (MVP), multi-region post-MVP\n\n---\n\n## 3. Data Models & Database Schema\n\nAll tables use UUID v7 primary keys (time-sortable). Timestamps are `TIMESTAMPTZ` stored in UTC. Soft deletes use `deleted_at TIMESTAMPTZ NULL`. All tenant-scoped tables enforce RLS via `tenant_id`.\n\n### Conventions\n\n- `id` -- UUID v7 primary key\n- `created_at` / `updated_at` -- automatic timestamps\n- `deleted_at` -- soft delete marker (NULL = active)\n- `tenant_id` -- foreign key to `tenants.id`, present on all tenant-scoped entities\n- `_jsonb` suffix -- JSONB columns for flexible/nested data\n- Enum types defined as PostgreSQL ENUMs\n\n### 3.1 Tenant\n\nRepresents a CDFI organization. Top-level entity for multi-tenant isolation.\n\n```\nTABLE: tenants\n---------------------------------------------------------------\nColumn              | Type         | Constraints\n---------------------------------------------------------------\nid                  | UUID         | PK, DEFAULT uuid_generate_v7()\nname                | VARCHAR(255) | NOT NULL\nslug                | VARCHAR(100) | NOT NULL, UNIQUE\ndomain              | VARCHAR(255) | NULL (custom domain)\nlogo_url            | VARCHAR(512) | NULL\nprimary_contact_email| VARCHAR(255)| NOT NULL\nsettings_jsonb      | JSONB        | NOT NULL DEFAULT '{}'\nstatus              | ENUM('active','suspended','onboarding') | NOT NULL DEFAULT 'onboarding'\ncreated_at          | TIMESTAMPTZ  | NOT NULL DEFAULT now()\nupdated_at          | TIMESTAMPTZ  | NOT NULL DEFAULT now()\ndeleted_at          | TIMESTAMPTZ  | NULL\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(slug) WHERE deleted_at IS NULL\n  - idx_tenants_status(status)\n\nsettings_jsonb schema:\n{\n  \"timezone\": \"America/New_York\",\n  \"default_currency\": \"USD\",\n  \"branding\": { \"primary_color\": \"#hex\", \"secondary_color\": \"#hex\" },\n  \"notifications\": { \"digest_frequency\": \"daily\" | \"realtime\" },\n  \"retention_days\": 2555\n}\n```\n\n### 3.2 User\n\nAll human users across all roles. A user belongs to exactly one tenant.\n\n```\nTABLE: users\n---------------------------------------------------------------\nColumn              | Type         | Constraints\n---------------------------------------------------------------\nid                  | UUID         | PK\ntenant_id           | UUID         | FK tenants(id), NOT NULL\nemail               | VARCHAR(255) | NOT NULL\npassword_hash       | VARCHAR(255) | NOT NULL\nfirst_name          | VARCHAR(100) | NOT NULL\nlast_name           | VARCHAR(100) | NOT NULL\nphone               | VARCHAR(20)  | NULL\navatar_url          | VARCHAR(512) | NULL\nemail_verified      | BOOLEAN      | NOT NULL DEFAULT false\nemail_verified_at   | TIMESTAMPTZ  | NULL\nverification_token  | VARCHAR(255) | NULL\nreset_token         | VARCHAR(255) | NULL\nreset_token_expires | TIMESTAMPTZ  | NULL\nstatus              | ENUM('active','inactive','pending_verification','locked') | NOT NULL DEFAULT 'pending_verification'\nlast_login_at       | TIMESTAMPTZ  | NULL\nfailed_login_count  | INTEGER      | NOT NULL DEFAULT 0\nlocked_until        | TIMESTAMPTZ  | NULL\npreferences_jsonb   | JSONB        | NOT NULL DEFAULT '{}'\ncreated_at          | TIMESTAMPTZ  | NOT NULL DEFAULT now()\nupdated_at          | TIMESTAMPTZ  | NOT NULL DEFAULT now()\ndeleted_at          | TIMESTAMPTZ  | NULL\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(tenant_id, email) WHERE deleted_at IS NULL\n  - idx_users_tenant(tenant_id)\n  - idx_users_status(tenant_id, status)\n  - idx_users_verification_token(verification_token) WHERE verification_token IS NOT NULL\n  - idx_users_reset_token(reset_token) WHERE reset_token IS NOT NULL\n```\n\n### 3.3 UserRole (Join Table)\n\nMaps users to roles. A user may hold multiple roles within the same tenant.\n\n```\nTABLE: user_roles\n---------------------------------------------------------------\nColumn              | Type         | Constraints\n---------------------------------------------------------------\nid                  | UUID         | PK\nuser_id             | UUID         | FK users(id), NOT NULL\ntenant_id           | UUID         | FK tenants(id), NOT NULL\nrole                | ENUM('borrower','underwriter','credit_manager','admin') | NOT NULL\ngranted_by          | UUID         | FK users(id), NULL\ngranted_at          | TIMESTAMPTZ  | NOT NULL DEFAULT now()\nrevoked_at          | TIMESTAMPTZ  | NULL\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(user_id, tenant_id, role) WHERE revoked_at IS NULL\n  - idx_user_roles_tenant_role(tenant_id, role)\n```\n\n### 3.4 LoanProduct\n\nConfigurable loan product definitions per tenant.\n\n```\nTABLE: loan_products\n---------------------------------------------------------------\nColumn              | Type           | Constraints\n---------------------------------------------------------------\nid                  | UUID           | PK\ntenant_id           | UUID           | FK tenants(id), NOT NULL\nname                | VARCHAR(255)   | NOT NULL\ncode                | VARCHAR(50)    | NOT NULL\ndescription         | TEXT           | NULL\nloan_type           | ENUM('term','line_of_credit','sba_7a','sba_504','micro','real_estate','equipment','working_capital') | NOT NULL\nmin_amount          | DECIMAL(15,2)  | NOT NULL\nmax_amount          | DECIMAL(15,2)  | NOT NULL\nmin_term_months     | INTEGER        | NOT NULL\nmax_term_months     | INTEGER        | NOT NULL\ninterest_rate_type  | ENUM('fixed','variable','blended') | NOT NULL\ndefault_rate_floor  | DECIMAL(5,4)   | NULL\ndefault_rate_ceiling| DECIMAL(5,4)   | NULL\nrequired_documents_jsonb | JSONB     | NOT NULL DEFAULT '[]'\neligibility_criteria_jsonb | JSONB   | NOT NULL DEFAULT '{}'\nunderwriting_checklist_jsonb | JSONB | NOT NULL DEFAULT '[]'\nscoring_model_id    | UUID           | FK scoring_models(id), NULL\nworkflow_config_id  | UUID           | FK workflow_configs(id), NULL\nstatus              | ENUM('active','inactive','draft') | NOT NULL DEFAULT 'draft'\ncreated_at          | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at          | TIMESTAMPTZ    | NOT NULL DEFAULT now()\ndeleted_at          | TIMESTAMPTZ    | NULL\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(tenant_id, code) WHERE deleted_at IS NULL\n  - idx_loan_products_tenant_status(tenant_id, status)\n```\n\n### 3.5 Application\n\nA borrower's loan application submission. One application produces one case.\n\n```\nTABLE: applications\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\nborrower_user_id        | UUID           | FK users(id), NOT NULL\nloan_product_id         | UUID           | FK loan_products(id), NOT NULL\nintake_channel          | ENUM('direct','salesforce_referral','external_referral') | NOT NULL\nreferral_source         | VARCHAR(255)   | NULL\nsalesforce_referral_id  | VARCHAR(100)   | NULL\nexternal_referrer_user_id| UUID          | FK users(id), NULL\nbusiness_name           | VARCHAR(255)   | NOT NULL\nbusiness_ein            | VARCHAR(20)    | NULL\nbusiness_type           | ENUM('sole_prop','llc','s_corp','c_corp','partnership','nonprofit') | NOT NULL\nbusiness_state          | VARCHAR(2)     | NOT NULL\nbusiness_address_jsonb  | JSONB          | NOT NULL\nbusiness_start_date     | DATE           | NULL\nnaics_code              | VARCHAR(10)    | NULL\nindustry_description    | VARCHAR(255)   | NULL\nrequested_amount        | DECIMAL(15,2)  | NOT NULL\nrequested_term_months   | INTEGER        | NULL\nloan_purpose            | TEXT           | NOT NULL\nuse_of_funds_jsonb      | JSONB          | NOT NULL DEFAULT '[]'\nguarantors_jsonb        | JSONB          | NOT NULL DEFAULT '[]'\nannual_revenue          | DECIMAL(15,2)  | NULL\nemployee_count          | INTEGER        | NULL\nyears_in_business       | DECIMAL(4,1)   | NULL\nexisting_debt_amount    | DECIMAL(15,2)  | NULL\nstatus                  | ENUM('draft','submitted','in_review','case_created','withdrawn') | NOT NULL DEFAULT 'draft'\nsubmitted_at            | TIMESTAMPTZ    | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\ndeleted_at              | TIMESTAMPTZ    | NULL\n---------------------------------------------------------------\nINDEXES:\n  - idx_applications_tenant_status(tenant_id, status)\n  - idx_applications_borrower(tenant_id, borrower_user_id)\n  - idx_applications_submitted(tenant_id, submitted_at DESC)\n  - idx_applications_salesforce(salesforce_referral_id) WHERE salesforce_referral_id IS NOT NULL\n```\n\n### 3.6 Case\n\nThe core underwriting case entity. Created from an application, tracks the 13-phase workflow.\n\n```\nTABLE: cases\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\napplication_id          | UUID           | FK applications(id), NOT NULL, UNIQUE\ncase_number             | VARCHAR(30)    | NOT NULL\nloan_product_id         | UUID           | FK loan_products(id), NOT NULL\nborrower_user_id        | UUID           | FK users(id), NOT NULL\nassigned_underwriter_id | UUID           | FK users(id), NULL\nassigned_reviewer_id    | UUID           | FK users(id), NULL\ncurrent_phase           | ENUM('configuration','intake','document_collection','data_extraction','financial_analysis','risk_assessment','follow_up_questions','response_collection','override_management','scoring','packet_assembly','credit_review','export_closeout') | NOT NULL DEFAULT 'intake'\nstatus                  | ENUM('open','in_progress','pending_borrower','pending_review','approved','declined','returned','withdrawn','archived') | NOT NULL DEFAULT 'open'\npriority                | ENUM('low','normal','high','urgent') | NOT NULL DEFAULT 'normal'\nrequested_amount        | DECIMAL(15,2)  | NOT NULL\nrecommended_amount      | DECIMAL(15,2)  | NULL\napproved_amount         | DECIMAL(15,2)  | NULL\nsla_due_date            | TIMESTAMPTZ    | NULL\nrisk_tier               | ENUM('low','moderate','elevated','high') | NULL\noverall_score           | DECIMAL(5,2)   | NULL\nai_recommendation       | ENUM('approve','approve_with_conditions','decline','insufficient_data') | NULL\nunderwriter_confirmed   | BOOLEAN        | NOT NULL DEFAULT false\nconfirmed_at            | TIMESTAMPTZ    | NULL\ncase_metadata_jsonb     | JSONB          | NOT NULL DEFAULT '{}'\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nclosed_at               | TIMESTAMPTZ    | NULL\ndeleted_at              | TIMESTAMPTZ    | NULL\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(tenant_id, case_number) WHERE deleted_at IS NULL\n  - idx_cases_tenant_status(tenant_id, status)\n  - idx_cases_underwriter(tenant_id, assigned_underwriter_id, status)\n  - idx_cases_reviewer(tenant_id, assigned_reviewer_id, status)\n  - idx_cases_phase(tenant_id, current_phase)\n  - idx_cases_sla(tenant_id, sla_due_date) WHERE status IN ('open','in_progress','pending_borrower')\n  - idx_cases_application(application_id)\n```\n\n### 3.7 CasePhase\n\nTracks each phase's state and timing for a case. One row per phase per case.\n\n```\nTABLE: case_phases\n---------------------------------------------------------------\nColumn              | Type           | Constraints\n---------------------------------------------------------------\nid                  | UUID           | PK\ntenant_id           | UUID           | FK tenants(id), NOT NULL\ncase_id             | UUID           | FK cases(id), NOT NULL\nphase               | ENUM(same as cases.current_phase) | NOT NULL\nstatus              | ENUM('pending','active','completed','skipped','blocked') | NOT NULL DEFAULT 'pending'\nentered_at          | TIMESTAMPTZ    | NULL\ncompleted_at        | TIMESTAMPTZ    | NULL\ncompleted_by        | UUID           | FK users(id), NULL\nsla_target_at       | TIMESTAMPTZ    | NULL\nsla_warning_sent    | BOOLEAN        | NOT NULL DEFAULT false\nsla_breached        | BOOLEAN        | NOT NULL DEFAULT false\nentry_conditions_met_jsonb | JSONB   | NOT NULL DEFAULT '{}'\nexit_conditions_met_jsonb  | JSONB   | NOT NULL DEFAULT '{}'\nnotes               | TEXT           | NULL\ncreated_at          | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at          | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(case_id, phase)\n  - idx_case_phases_tenant_case(tenant_id, case_id)\n  - idx_case_phases_active(tenant_id, status) WHERE status = 'active'\n```\n\n### 3.8 Document\n\nUploaded documents with processing metadata.\n\n```\nTABLE: documents\n---------------------------------------------------------------\nColumn                | Type           | Constraints\n---------------------------------------------------------------\nid                    | UUID           | PK\ntenant_id             | UUID           | FK tenants(id), NOT NULL\ncase_id               | UUID           | FK cases(id), NOT NULL\nuploaded_by           | UUID           | FK users(id), NOT NULL\noriginal_filename     | VARCHAR(500)   | NOT NULL\nstorage_key           | VARCHAR(1000)  | NOT NULL\nmime_type             | VARCHAR(100)   | NOT NULL\nfile_size_bytes       | BIGINT         | NOT NULL\ndocument_type         | ENUM('tax_return_business','tax_return_personal','bank_statement','financial_statement','articles_of_incorporation','business_license','insurance_certificate','appraisal','environmental_report','personal_financial_statement','debt_schedule','accounts_receivable_aging','accounts_payable_aging','lease_agreement','purchase_agreement','business_plan','other') | NOT NULL DEFAULT 'other'\ndocument_label        | VARCHAR(255)   | NULL\ntax_year              | INTEGER        | NULL\nperiod_start          | DATE           | NULL\nperiod_end            | DATE           | NULL\nprocessing_status     | ENUM('uploaded','queued','ocr_processing','ocr_complete','classifying','classified','extracting','extracted','validation_pending','validated','failed') | NOT NULL DEFAULT 'uploaded'\nocr_confidence        | DECIMAL(5,4)   | NULL\nclassification_confidence | DECIMAL(5,4) | NULL\npage_count            | INTEGER        | NULL\nocr_text_storage_key  | VARCHAR(1000)  | NULL\nvirus_scan_status     | ENUM('pending','clean','infected','error') | NOT NULL DEFAULT 'pending'\nvirus_scan_at         | TIMESTAMPTZ    | NULL\nencryption_key_id     | VARCHAR(255)   | NOT NULL\nis_superseded         | BOOLEAN        | NOT NULL DEFAULT false\nsuperseded_by         | UUID           | FK documents(id), NULL\nnotes                 | TEXT           | NULL\ncreated_at            | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at            | TIMESTAMPTZ    | NOT NULL DEFAULT now()\ndeleted_at            | TIMESTAMPTZ    | NULL\n---------------------------------------------------------------\nINDEXES:\n  - idx_documents_case(tenant_id, case_id)\n  - idx_documents_type(tenant_id, case_id, document_type)\n  - idx_documents_processing(tenant_id, processing_status)\n  - idx_documents_storage(storage_key)\n```\n\n### 3.9 ExtractionResult\n\nAI-extracted structured data from a document, with per-field confidence scores.\n\n```\nTABLE: extraction_results\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ndocument_id             | UUID           | FK documents(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\nextraction_model_version| VARCHAR(50)    | NOT NULL\nextraction_type         | ENUM('tax_return','bank_statement','financial_statement','pfs','debt_schedule','ar_aging','ap_aging','other') | NOT NULL\nfiscal_year             | INTEGER        | NULL\nperiod_label            | VARCHAR(50)    | NULL\nraw_extraction_jsonb    | JSONB          | NOT NULL\nstructured_data_jsonb   | JSONB          | NOT NULL\nfield_confidences_jsonb | JSONB          | NOT NULL DEFAULT '{}'\noverall_confidence      | DECIMAL(5,4)   | NOT NULL\nlow_confidence_fields   | TEXT[]         | NOT NULL DEFAULT '{}'\nvalidation_status       | ENUM('pending','auto_validated','manual_review_needed','manually_validated','rejected') | NOT NULL DEFAULT 'pending'\nvalidated_by            | UUID           | FK users(id), NULL\nvalidated_at            | TIMESTAMPTZ    | NULL\noverride_data_jsonb     | JSONB          | NULL\nprocessing_time_ms      | INTEGER        | NULL\nerror_message           | TEXT           | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_extraction_document(document_id)\n  - idx_extraction_case(tenant_id, case_id)\n  - idx_extraction_validation(tenant_id, validation_status)\n  - idx_extraction_type_year(tenant_id, case_id, extraction_type, fiscal_year)\n```\n\n### 3.10 FinancialSpread\n\nComputed financial analysis data. One row per analysis type per case, potentially per fiscal year.\n\n```\nTABLE: financial_spreads\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\nanalysis_type           | ENUM('business_cash_flow','personal_debt_income','global_cash_flow','balance_sheet','income_statement','operating_cycle','ratio_analysis','collateral_coverage','business_debt_schedule') | NOT NULL\nfiscal_year             | INTEGER        | NULL\nperiod_label            | VARCHAR(50)    | NULL\nguarantor_index         | INTEGER        | NULL\nsource_extraction_ids   | UUID[]         | NOT NULL DEFAULT '{}'\ncomputed_data_jsonb     | JSONB          | NOT NULL\nsummary_metrics_jsonb   | JSONB          | NOT NULL DEFAULT '{}'\nbenchmark_comparisons_jsonb | JSONB      | NULL\ntrend_data_jsonb        | JSONB          | NULL\noverride_data_jsonb     | JSONB          | NULL\ncomputation_version     | VARCHAR(20)    | NOT NULL\ncomputation_notes       | TEXT           | NULL\nstatus                  | ENUM('computed','reviewed','overridden','stale') | NOT NULL DEFAULT 'computed'\nreviewed_by             | UUID           | FK users(id), NULL\nreviewed_at             | TIMESTAMPTZ    | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_spreads_case_type(tenant_id, case_id, analysis_type)\n  - idx_spreads_case_type_year(tenant_id, case_id, analysis_type, fiscal_year)\n```\n\n### 3.11 RiskItem\n\nIdentified risk factors and policy exceptions per case.\n\n```\nTABLE: risk_items\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\nrisk_source             | ENUM('ai_identified','policy_rule','underwriter_added') | NOT NULL\nrisk_category           | ENUM('financial','operational','market','management','collateral','regulatory','concentration','character') | NOT NULL\nseverity                | ENUM('low','moderate','elevated','high','critical') | NOT NULL\ntitle                   | VARCHAR(255)   | NOT NULL\ndescription             | TEXT           | NOT NULL\nevidence_jsonb          | JSONB          | NOT NULL DEFAULT '[]'\nrelated_analysis_type   | VARCHAR(50)    | NULL\nrelated_spread_id       | UUID           | FK financial_spreads(id), NULL\npolicy_rule_reference   | VARCHAR(100)   | NULL\nis_policy_exception     | BOOLEAN        | NOT NULL DEFAULT false\nexception_justification | TEXT           | NULL\nmitigation_strategy     | TEXT           | NULL\nai_narrative            | TEXT           | NULL\nstatus                  | ENUM('open','acknowledged','mitigated','accepted','dismissed') | NOT NULL DEFAULT 'open'\nresolved_by             | UUID           | FK users(id), NULL\nresolved_at             | TIMESTAMPTZ    | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_risk_items_case(tenant_id, case_id)\n  - idx_risk_items_severity(tenant_id, case_id, severity)\n  - idx_risk_items_exceptions(tenant_id, case_id) WHERE is_policy_exception = true\n  - idx_risk_items_status(tenant_id, status)\n```\n\n### 3.12 FollowUpQuestion\n\nAI-generated or underwriter-created follow-up questions for the borrower.\n\n```\nTABLE: follow_up_questions\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\ngenerated_by            | ENUM('ai','underwriter') | NOT NULL\ncreated_by_user_id      | UUID           | FK users(id), NULL\nmemo_section_mapping    | VARCHAR(100)   | NULL\nquestion_text           | TEXT           | NOT NULL\ncontext_description     | TEXT           | NULL\npriority                | ENUM('required','important','optional') | NOT NULL DEFAULT 'important'\ncategory                | ENUM('financial','operational','collateral','management','use_of_funds','projections','other') | NOT NULL\nsort_order              | INTEGER        | NOT NULL DEFAULT 0\nstatus                  | ENUM('draft','approved','sent','answered','withdrawn') | NOT NULL DEFAULT 'draft'\napproved_by             | UUID           | FK users(id), NULL\napproved_at             | TIMESTAMPTZ    | NULL\nsent_at                 | TIMESTAMPTZ    | NULL\nresponse_deadline       | TIMESTAMPTZ    | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_followup_case(tenant_id, case_id)\n  - idx_followup_status(tenant_id, case_id, status)\n  - idx_followup_priority(tenant_id, case_id, priority)\n```\n\n### 3.13 BorrowerResponse\n\nBorrower's response to a follow-up question, with AI narrative conversion.\n\n```\nTABLE: borrower_responses\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\nquestion_id             | UUID           | FK follow_up_questions(id), NOT NULL\nresponse_channel        | ENUM('web_form','email','phone_transcription') | NOT NULL DEFAULT 'web_form'\nraw_response_text       | TEXT           | NOT NULL\nconverted_narrative     | TEXT           | NULL\nnarrative_conversion_status | ENUM('pending','converted','reviewed','edited') | NOT NULL DEFAULT 'pending'\nedited_narrative        | TEXT           | NULL\nedited_by               | UUID           | FK users(id), NULL\nattachments_jsonb       | JSONB          | NOT NULL DEFAULT '[]'\nreviewed_by             | UUID           | FK users(id), NULL\nreviewed_at             | TIMESTAMPTZ    | NULL\nreview_status           | ENUM('pending','satisfactory','needs_followup','insufficient') | NOT NULL DEFAULT 'pending'\nreview_notes            | TEXT           | NULL\nsubmitted_at            | TIMESTAMPTZ    | NOT NULL DEFAULT now()\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_responses_case(tenant_id, case_id)\n  - idx_responses_question(question_id)\n  - idx_responses_review(tenant_id, review_status)\n```\n\n### 3.14 Override\n\nAll manual adjustments to AI-produced data, with mandatory rationale.\n\n```\nTABLE: overrides\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\noverride_type           | ENUM('extraction_field','spread_value','risk_severity','risk_status','score_factor','document_classification','question_edit','narrative_edit') | NOT NULL\ntarget_entity_type      | VARCHAR(50)    | NOT NULL\ntarget_entity_id        | UUID           | NOT NULL\nfield_path              | VARCHAR(255)   | NOT NULL\noriginal_value_jsonb    | JSONB          | NOT NULL\nnew_value_jsonb         | JSONB          | NOT NULL\nrationale               | TEXT           | NOT NULL\nsupporting_document_id  | UUID           | FK documents(id), NULL\ncreated_by              | UUID           | FK users(id), NOT NULL\napproved_by             | UUID           | FK users(id), NULL\napproved_at             | TIMESTAMPTZ    | NULL\nstatus                  | ENUM('pending','applied','rejected','reverted') | NOT NULL DEFAULT 'applied'\nreverted_at             | TIMESTAMPTZ    | NULL\nreverted_by             | UUID           | FK users(id), NULL\nrevert_reason           | TEXT           | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_overrides_case(tenant_id, case_id)\n  - idx_overrides_target(target_entity_type, target_entity_id)\n  - idx_overrides_type(tenant_id, case_id, override_type)\n  - idx_overrides_user(tenant_id, created_by)\n```\n\n### 3.15 ScoringModel\n\nConfigurable scoring algorithm definition. Versioned for audit trail.\n\n```\nTABLE: scoring_models\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\nname                    | VARCHAR(255)   | NOT NULL\nversion                 | INTEGER        | NOT NULL DEFAULT 1\ndescription             | TEXT           | NULL\ntotal_max_score         | DECIMAL(7,2)   | NOT NULL DEFAULT 100.00\npassing_score           | DECIMAL(7,2)   | NOT NULL\nconditional_floor       | DECIMAL(7,2)   | NULL\nscore_ranges_jsonb      | JSONB          | NOT NULL\nstatus                  | ENUM('draft','active','archived') | NOT NULL DEFAULT 'draft'\neffective_from          | TIMESTAMPTZ    | NULL\neffective_until         | TIMESTAMPTZ    | NULL\ncreated_by              | UUID           | FK users(id), NOT NULL\napproved_by             | UUID           | FK users(id), NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_scoring_models_tenant(tenant_id)\n  - idx_scoring_models_active(tenant_id, status) WHERE status = 'active'\n  - UNIQUE(tenant_id, name, version)\n\nscore_ranges_jsonb schema:\n{\n  \"approve\": { \"min\": 75, \"max\": 100, \"label\": \"Approve\" },\n  \"approve_with_conditions\": { \"min\": 60, \"max\": 74.99, \"label\": \"Approve with Conditions\" },\n  \"decline\": { \"min\": 0, \"max\": 59.99, \"label\": \"Decline\" }\n}\n```\n\n### 3.16 ScoringCategory\n\nCategories within a scoring model (e.g., Financial Strength, Management, Collateral).\n\n```\nTABLE: scoring_categories\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\nscoring_model_id        | UUID           | FK scoring_models(id), NOT NULL\nname                    | VARCHAR(255)   | NOT NULL\ndescription             | TEXT           | NULL\nweight_pct              | DECIMAL(5,2)   | NOT NULL\nmax_points              | DECIMAL(7,2)   | NOT NULL\nsort_order              | INTEGER        | NOT NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_scoring_cat_model(scoring_model_id)\n  - UNIQUE(scoring_model_id, name)\n\nCONSTRAINT: SUM(weight_pct) for all categories in a model = 100.00\n```\n\n### 3.17 ScoringFactor\n\nIndividual factors within a scoring category.\n\n```\nTABLE: scoring_factors\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\nscoring_category_id     | UUID           | FK scoring_categories(id), NOT NULL\nname                    | VARCHAR(255)   | NOT NULL\ndescription             | TEXT           | NULL\nmax_points              | DECIMAL(7,2)   | NOT NULL\ndata_source             | VARCHAR(100)   | NOT NULL\nevaluation_rule_jsonb   | JSONB          | NOT NULL\nsort_order              | INTEGER        | NOT NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_scoring_factor_cat(scoring_category_id)\n  - UNIQUE(scoring_category_id, name)\n\nevaluation_rule_jsonb schema:\n{\n  \"type\": \"range_lookup\",\n  \"source_field\": \"summary_metrics_jsonb.debt_service_coverage\",\n  \"ranges\": [\n    { \"min\": 1.50, \"max\": null, \"points\": 10.0, \"label\": \"Strong\" },\n    { \"min\": 1.25, \"max\": 1.49, \"points\": 7.5, \"label\": \"Adequate\" },\n    { \"min\": 1.00, \"max\": 1.24, \"points\": 5.0, \"label\": \"Marginal\" },\n    { \"min\": null, \"max\": 0.99, \"points\": 2.0, \"label\": \"Weak\" }\n  ]\n}\n```\n\n### 3.18 ScoringResult\n\nComputed scores per case. One row per case, with per-category and per-factor breakdowns.\n\n```\nTABLE: scoring_results\n---------------------------------------------------------------\nColumn                      | Type           | Constraints\n---------------------------------------------------------------\nid                          | UUID           | PK\ntenant_id                   | UUID           | FK tenants(id), NOT NULL\ncase_id                     | UUID           | FK cases(id), NOT NULL, UNIQUE\nscoring_model_id            | UUID           | FK scoring_models(id), NOT NULL\nscoring_model_version       | INTEGER        | NOT NULL\ntotal_score                 | DECIMAL(7,2)   | NOT NULL\nmax_possible_score          | DECIMAL(7,2)   | NOT NULL\nscore_pct                   | DECIMAL(5,2)   | NOT NULL\nrecommendation              | ENUM('approve','approve_with_conditions','decline','insufficient_data') | NOT NULL\ncategory_scores_jsonb       | JSONB          | NOT NULL\nfactor_scores_jsonb         | JSONB          | NOT NULL\ndata_completeness_pct       | DECIMAL(5,2)   | NOT NULL\ninsufficient_data_factors   | TEXT[]         | NOT NULL DEFAULT '{}'\nunderwriter_confirmed       | BOOLEAN        | NOT NULL DEFAULT false\nconfirmed_by                | UUID           | FK users(id), NULL\nconfirmed_at                | TIMESTAMPTZ    | NULL\nconfirmation_notes          | TEXT           | NULL\noverride_adjustments_jsonb  | JSONB          | NOT NULL DEFAULT '[]'\ncomputed_at                 | TIMESTAMPTZ    | NOT NULL\ncreated_at                  | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at                  | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(case_id)\n  - idx_scoring_results_tenant(tenant_id)\n  - idx_scoring_results_confirmed(tenant_id, underwriter_confirmed)\n```\n\n### 3.19 CreditMemoPacket\n\nAssembled credit memo with 17 sections.\n\n```\nTABLE: credit_memo_packets\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL, UNIQUE\npacket_version          | INTEGER        | NOT NULL DEFAULT 1\nsections_jsonb          | JSONB          | NOT NULL\nassembly_status         | ENUM('pending','assembling','assembled','reviewed','finalized','exported') | NOT NULL DEFAULT 'pending'\nquality_check_jsonb     | JSONB          | NULL\nassembled_at            | TIMESTAMPTZ    | NULL\nreviewed_by             | UUID           | FK users(id), NULL\nreviewed_at             | TIMESTAMPTZ    | NULL\nfinalized_by            | UUID           | FK users(id), NULL\nfinalized_at            | TIMESTAMPTZ    | NULL\nexport_formats          | TEXT[]         | NOT NULL DEFAULT '{}'\npdf_storage_key         | VARCHAR(1000)  | NULL\nword_storage_key        | VARCHAR(1000)  | NULL\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\n17 sections:\n1. Executive Summary\n2. Borrower Overview\n3. Business Description & History\n4. Management & Ownership\n5. Use of Funds\n6. Loan Structure & Terms\n7. Financial Analysis -- Income Statement\n8. Financial Analysis -- Balance Sheet\n9. Financial Analysis -- Cash Flow Coverage\n10. Financial Analysis -- Ratio Analysis\n11. Personal Financial Analysis (Guarantors)\n12. Collateral Analysis\n13. Business Debt Schedule\n14. Risk Assessment & Policy Exceptions\n15. Follow-Up Questions & Responses\n16. Scoring Summary\n17. Recommendation & Conditions\n```\n\n### 3.20 ReviewDecision\n\nCredit Manager decisions on completed underwriting packages.\n\n```\nTABLE: review_decisions\n---------------------------------------------------------------\nColumn                  | Type           | Constraints\n---------------------------------------------------------------\nid                      | UUID           | PK\ntenant_id               | UUID           | FK tenants(id), NOT NULL\ncase_id                 | UUID           | FK cases(id), NOT NULL\nreviewer_id             | UUID           | FK users(id), NOT NULL\ndecision                | ENUM('approved','approved_with_conditions','returned','declined') | NOT NULL\nconditions_jsonb        | JSONB          | NOT NULL DEFAULT '[]'\nreturn_reasons_jsonb    | JSONB          | NOT NULL DEFAULT '[]'\ndecline_reasons_jsonb   | JSONB          | NOT NULL DEFAULT '[]'\napproved_amount         | DECIMAL(15,2)  | NULL\napproved_rate           | DECIMAL(5,4)   | NULL\napproved_term_months    | INTEGER        | NULL\ninternal_notes          | TEXT           | NULL\ndecision_narrative      | TEXT           | NULL\ndecided_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\ncreated_at              | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_review_decisions_case(tenant_id, case_id)\n  - idx_review_decisions_reviewer(tenant_id, reviewer_id)\n  - idx_review_decisions_decision(tenant_id, decision)\n```\n\n### 3.21-3.24 Supporting Tables\n\nAdditional tables include:\n\n- **AuditEntry** (`audit_entries`) -- Comprehensive, immutable audit trail. Append-only with monthly range partitioning on `created_at`. No UPDATE/DELETE permissions.\n- **Notification** (`notifications`) -- In-app and email notifications per user with read tracking and email delivery status.\n- **IntegrationConfig** (`integration_configs`) -- Per-tenant integration credentials and settings (Salesforce, LOS, email, document storage). Credentials stored in encrypted BYTEA column.\n- **WorkflowConfig** (`workflow_configs`) -- Configurable workflow phase definitions with SLA targets, entry/exit conditions, notification rules, and role-based access per phase.\n\n### 3.25 Entity-Relationship Summary\n\n```\ntenants 1:N users\ntenants 1:N loan_products\ntenants 1:N applications\ntenants 1:N cases\ntenants 1:N scoring_models\ntenants 1:N workflow_configs\ntenants 1:N integration_configs\n\nusers  1:N user_roles\nusers  1:N applications (as borrower)\nusers  1:N cases (as underwriter, reviewer)\n\napplications 1:1 cases\nloan_products 1:N applications\nloan_products N:1 scoring_models\nloan_products N:1 workflow_configs\n\ncases  1:N case_phases\ncases  1:N documents\ncases  1:N extraction_results (via documents)\ncases  1:N financial_spreads\ncases  1:N risk_items\ncases  1:N follow_up_questions\ncases  1:N borrower_responses\ncases  1:N overrides\ncases  1:1 scoring_results\ncases  1:1 credit_memo_packets\ncases  1:N review_decisions\ncases  1:N audit_entries\ncases  1:N notifications\n\ndocuments 1:N extraction_results\nfollow_up_questions 1:1 borrower_responses\nscoring_models 1:N scoring_categories\nscoring_categories 1:N scoring_factors\n```\n\n---\n\n## 4. API Contract Specification\n\n**Base URL:** `https://api.cremologix.com/v1`\n**Content-Type:** `application/json` (except file uploads: `multipart/form-data`)\n**Authentication:** Bearer JWT token in `Authorization` header\n**Tenant Context:** Derived from authenticated user's JWT\n\n### Common Response Envelope\n\n```json\n{\n  \"success\": true,\n  \"data\": { },\n  \"meta\": { \"request_id\": \"req_abc123\", \"timestamp\": \"2026-02-08T14:30:00Z\" }\n}\n```\n\nError responses include `error.code`, `error.message`, and `error.details` array with per-field validation errors.\n\n### Pagination\n\nList endpoints accept `page`, `per_page` (default 25, max 100), `sort_by`, `sort_order`. Response includes `pagination` object with `total_items` and `total_pages`.\n\n### Rate Limits\n\n| Role | Limit |\n|------|-------|\n| Borrower | 60 req/min |\n| Underwriter | 120 req/min |\n| Credit Manager | 120 req/min |\n| Admin | 200 req/min |\n| Unauthenticated | 20 req/min |\n\nRate limit headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`.\n\n### 4.1 Auth API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| POST | `/auth/register` | None | Register new borrower (direct channel) |\n| POST | `/auth/register/referral` | None | Register from Salesforce referral token |\n| POST | `/auth/register/external` | Bearer (employee) | Register borrower via external referral |\n| POST | `/auth/verify-email` | None | Verify email with token |\n| POST | `/auth/resend-verification` | None | Resend verification email |\n| POST | `/auth/login` | None | Authenticate and get tokens |\n| POST | `/auth/refresh` | Refresh token | Refresh access token |\n| POST | `/auth/forgot-password` | None | Request password reset |\n| POST | `/auth/reset-password` | None | Reset password with token |\n| POST | `/auth/logout` | Bearer | Invalidate current session |\n\n### 4.2 Borrower API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/borrower/profile` | Borrower | Get current borrower profile |\n| PUT | `/borrower/profile` | Borrower | Update borrower profile |\n| GET | `/borrower/applications` | Borrower | List borrower's applications |\n| POST | `/borrower/applications` | Borrower | Create new application (draft) |\n| GET | `/borrower/applications/:id` | Borrower | Get application details |\n| PUT | `/borrower/applications/:id` | Borrower | Update draft application |\n| POST | `/borrower/applications/:id/submit` | Borrower | Submit application |\n| GET | `/borrower/applications/:id/status` | Borrower | Get application status & timeline |\n| GET | `/borrower/applications/:id/documents` | Borrower | List application documents |\n| POST | `/borrower/applications/:id/documents` | Borrower | Upload document (multipart/form-data) |\n| DELETE | `/borrower/applications/:id/documents/:docId` | Borrower | Remove uploaded document |\n| GET | `/borrower/applications/:id/questions` | Borrower | Get pending follow-up questions |\n| POST | `/borrower/applications/:id/questions/:qId/respond` | Borrower | Submit response to question |\n| GET | `/borrower/notifications` | Borrower | List notifications |\n\n### 4.3 Case API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases` | UW, CM | List cases (filtered, paginated) |\n| GET | `/cases/unassigned` | UW | List unassigned cases |\n| POST | `/cases` | UW | Create case from application |\n| GET | `/cases/:id` | UW, CM | Get case details with current phase |\n| PUT | `/cases/:id` | UW | Update case metadata |\n| POST | `/cases/:id/assign` | UW, Admin | Assign underwriter/reviewer |\n| POST | `/cases/:id/advance-phase` | UW | Advance to next phase |\n| POST | `/cases/:id/return-phase` | UW, CM | Return to previous phase |\n| GET | `/cases/:id/timeline` | UW, CM | Get phase transition history |\n| GET | `/cases/:id/activity` | UW, CM | Get activity feed |\n| POST | `/cases/:id/withdraw` | UW, Admin | Withdraw/cancel case |\n| POST | `/cases/:id/archive` | UW, Admin | Archive closed case |\n\n### 4.4 Document API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/documents` | UW, CM | List case documents |\n| GET | `/cases/:id/documents/:docId` | UW, CM | Get document details & extraction |\n| POST | `/cases/:id/documents` | UW | Upload additional document |\n| PUT | `/cases/:id/documents/:docId` | UW | Update document metadata |\n| POST | `/cases/:id/documents/:docId/reprocess` | UW | Trigger re-OCR/extraction |\n| GET | `/cases/:id/documents/:docId/extraction` | UW, CM | Get extraction results |\n| PUT | `/cases/:id/documents/:docId/extraction` | UW | Override extraction fields |\n| POST | `/cases/:id/documents/:docId/validate` | UW | Mark extraction as validated |\n| GET | `/cases/:id/documents/:docId/download` | UW, CM | Generate signed download URL |\n| DELETE | `/cases/:id/documents/:docId` | UW | Soft-delete document |\n\n### 4.5 Financial Analysis API\n\n9 sub-analysis endpoints plus recompute and override:\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/financial/summary` | UW, CM | Summary of all 9 analyses |\n| GET | `/cases/:id/financial/cash-flow` | UW, CM | Business cash flow coverage |\n| GET | `/cases/:id/financial/personal-di` | UW, CM | Personal D/I per guarantor |\n| GET | `/cases/:id/financial/global-cash-flow` | UW, CM | Global cash flow coverage |\n| GET | `/cases/:id/financial/balance-sheet` | UW, CM | Balance sheet analysis |\n| GET | `/cases/:id/financial/income-statement` | UW, CM | Income statement analysis |\n| GET | `/cases/:id/financial/operating-cycle` | UW, CM | Operating cycle metrics |\n| GET | `/cases/:id/financial/ratios` | UW, CM | Ratio analysis |\n| GET | `/cases/:id/financial/collateral` | UW, CM | Collateral coverage |\n| GET | `/cases/:id/financial/debt-schedule` | UW, CM | Business debt schedule |\n| POST | `/cases/:id/financial/recompute` | UW | Recompute all analyses |\n| PUT | `/cases/:id/financial/:analysisType/override` | UW | Override a spread value |\n\n### 4.6 Risk API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/risks` | UW, CM | List all risk items |\n| POST | `/cases/:id/risks` | UW | Add manual risk item |\n| PUT | `/cases/:id/risks/:riskId` | UW | Update risk item |\n| PUT | `/cases/:id/risks/:riskId/status` | UW | Change risk status |\n| GET | `/cases/:id/risks/narrative` | UW, CM | Get AI-generated risk narrative |\n| POST | `/cases/:id/risks/narrative/regenerate` | UW | Regenerate risk narrative |\n| GET | `/cases/:id/risks/policy-exceptions` | UW, CM | List policy exceptions |\n| PUT | `/cases/:id/risks/:riskId/exception` | UW | Add exception justification |\n\n### 4.7 Follow-Up API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/follow-ups` | UW, CM | List all follow-up questions |\n| POST | `/cases/:id/follow-ups/generate` | UW | Trigger AI question generation |\n| POST | `/cases/:id/follow-ups` | UW | Add custom question |\n| PUT | `/cases/:id/follow-ups/:qId` | UW | Edit question before sending |\n| POST | `/cases/:id/follow-ups/:qId/approve` | UW | Approve question for sending |\n| POST | `/cases/:id/follow-ups/send-batch` | UW | Send approved questions to borrower |\n| GET | `/cases/:id/follow-ups/:qId/response` | UW, CM | Get response with narrative |\n| PUT | `/cases/:id/follow-ups/:qId/response/review` | UW | Review response (status + notes) |\n| PUT | `/cases/:id/follow-ups/:qId/response/narrative` | UW | Edit converted narrative |\n\n### 4.8 Scoring API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/scoring` | UW, CM | Get scoring results |\n| POST | `/cases/:id/scoring/compute` | UW | Trigger score computation |\n| GET | `/cases/:id/scoring/categories` | UW, CM | Get per-category breakdown |\n| GET | `/cases/:id/scoring/factors` | UW, CM | Get per-factor detail with evidence |\n| POST | `/cases/:id/scoring/confirm` | UW | Confirm scoring (mandatory) |\n| GET | `/cases/:id/overrides` | UW, CM | List all overrides on this case |\n| POST | `/cases/:id/overrides` | UW | Create an override |\n| PUT | `/cases/:id/overrides/:oId` | UW | Update override |\n| DELETE | `/cases/:id/overrides/:oId` | UW | Revert an override |\n\n### 4.9 Packet API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/packet` | UW, CM | Get credit memo packet |\n| POST | `/cases/:id/packet/assemble` | UW | Trigger packet assembly |\n| GET | `/cases/:id/packet/sections` | UW, CM | List all 17 sections |\n| GET | `/cases/:id/packet/sections/:key` | UW, CM | Get single section content |\n| PUT | `/cases/:id/packet/sections/:key` | UW | Edit section content |\n| POST | `/cases/:id/packet/finalize` | UW | Mark packet as finalized |\n| POST | `/cases/:id/packet/export` | UW, CM | Generate PDF or Word export |\n| GET | `/cases/:id/packet/export/:format` | UW, CM | Download exported file |\n| POST | `/cases/:id/packet/push-to-los` | UW | Push packet to LOS |\n| GET | `/cases/:id/packet/quality-check` | UW | Get quality check results |\n\n### 4.10 Review API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/review/queue` | CM | List cases pending review |\n| GET | `/review/cases/:id` | CM | Get full case for review (read-only) |\n| GET | `/review/cases/:id/summary` | CM | Executive summary for review |\n| GET | `/review/cases/:id/financials` | CM | All financial analyses (read-only) |\n| GET | `/review/cases/:id/risks` | CM | Risk assessment (read-only) |\n| GET | `/review/cases/:id/scoring` | CM | Scoring detail (read-only) |\n| GET | `/review/cases/:id/packet` | CM | Full credit memo (read-only) |\n| GET | `/review/cases/:id/documents` | CM | Document list (read-only) |\n| GET | `/review/cases/:id/audit-trail` | CM | Case audit trail |\n| POST | `/review/cases/:id/decision` | CM | Submit review decision |\n\n### 4.11 Admin API\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| **Loan Products** | | | |\n| GET | `/admin/products` | Admin | List loan products |\n| POST | `/admin/products` | Admin | Create loan product |\n| GET/PUT | `/admin/products/:id` | Admin | Get/update product |\n| PUT | `/admin/products/:id/status` | Admin | Activate/deactivate product |\n| **Scoring Config** | | | |\n| GET | `/admin/scoring-models` | Admin | List scoring models |\n| POST | `/admin/scoring-models` | Admin | Create scoring model |\n| GET/PUT | `/admin/scoring-models/:id` | Admin | Get/update model |\n| POST | `/admin/scoring-models/:id/publish` | Admin | Publish model version |\n| POST/PUT/DELETE | `/admin/scoring-models/:id/categories/*` | Admin | CRUD categories |\n| POST/PUT/DELETE | `/admin/scoring-models/:id/categories/:cId/factors/*` | Admin | CRUD factors |\n| **Workflow Config** | | | |\n| GET/POST | `/admin/workflows` | Admin | List/create workflows |\n| GET/PUT | `/admin/workflows/:id` | Admin | Get/update workflow |\n| POST | `/admin/workflows/:id/publish` | Admin | Publish workflow version |\n| **Users & Permissions** | | | |\n| GET/POST | `/admin/users` | Admin | List/create users |\n| GET/PUT | `/admin/users/:id` | Admin | Get/update user |\n| PUT | `/admin/users/:id/status` | Admin | Activate/deactivate user |\n| POST/DELETE | `/admin/users/:id/roles/:role` | Admin | Assign/revoke roles |\n| **Audit & Integrations** | | | |\n| GET | `/admin/audit-log` | Admin | Query audit entries (filtered) |\n| GET | `/admin/audit-log/export` | Admin | Export audit log (CSV) |\n| GET | `/admin/integrations` | Admin | List integration configs |\n| PUT | `/admin/integrations/:type` | Admin | Update integration config |\n| POST | `/admin/integrations/:type/test` | Admin | Test connection |\n| POST | `/admin/integrations/:type/sync` | Admin | Trigger manual sync |\n\n### 4.12 Financial Normalization API\n\nEndpoints for the Financial Normalization Engine (FNE). Full specification in `fne-specification.md`.\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| POST | `/cases/:id/normalization/run` | UW | Trigger normalization for all validated extractions |\n| GET | `/cases/:id/normalization/results` | UW, CM | Get normalized financials (all periods) |\n| GET | `/cases/:id/normalization/results/:period` | UW, CM | Get normalized financials for specific period |\n| GET | `/cases/:id/normalization/audit` | UW, CM | Get normalization audit trail (mapping decisions) |\n| PUT | `/cases/:id/normalization/override` | UW | Override a normalized value (with rationale) |\n| GET | `/cases/:id/normalization/confidence` | UW, CM | Get confidence scores per field |\n\n**Note:** The Financial Analysis Engine (Section 5.2) reads from `normalized_financials` (produced by FNE) rather than raw `extraction_results`. FNE must complete before financial analysis can run.\n\n### 4.13 Deal Health API\n\nEndpoints for the Deal Health Score engine. Full specification in `deal-health-specification.md`.\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/cases/:id/deal-health` | UW, CM | Get current Deal Health Score with factor breakdown |\n| POST | `/cases/:id/deal-health/compute` | UW | Trigger Deal Health Score (re)computation |\n| GET | `/cases/:id/deal-health/history` | UW, CM | Get score progression over time |\n| GET | `/cases/:id/deal-health/factors` | UW, CM | Get per-factor detail with evidence |\n| GET | `/admin/deal-health/config` | Admin | Get Deal Health Score configuration |\n| PUT | `/admin/deal-health/config` | Admin | Update weights and ranges (via AD-03) |\n\n### 4.14 Pre-Qualification API\n\nEndpoints for the pre-qualification pipeline (before case creation). See Section 8.1.1 for workflow.\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| POST | `/prequalification/:appId/credit-check` | System | Trigger credit bureau soft pull |\n| POST | `/prequalification/:appId/kyc/initiate` | None | Generate KYC verification session |\n| POST | `/prequalification/:appId/kyc/callback` | Webhook | KYC provider result callback |\n| POST | `/prequalification/:appId/background/initiate` | System | Trigger background check |\n| POST | `/prequalification/:appId/background/callback` | Webhook | Background check result callback |\n| GET | `/prequalification/:appId/status` | Borrower, UW | Get all gate statuses |\n| POST | `/prequalification/:appId/background/review` | Intake Agent | Approve/reject background results |\n\n### 4.15 Notification & Webhook APIs\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/notifications` | Any auth | List user notifications |\n| GET | `/notifications/unread-count` | Any auth | Get unread count |\n| PUT | `/notifications/:id/read` | Any auth | Mark as read |\n| PUT | `/notifications/read-all` | Any auth | Mark all as read |\n| PUT | `/notifications/preferences` | Any auth | Update preferences |\n| POST | `/webhooks/salesforce` | Webhook secret | Receive Salesforce referral events |\n| POST | `/webhooks/email-status` | Webhook secret | Email delivery status callbacks |\n\n---\n\n## 5. AI/ML Pipeline Specification\n\nAll AI pipelines are implemented as Python microservices behind FastAPI, invoked by the Core API via internal HTTP calls and/or async job queues.\n\n### 5.1 Document Processing Pipeline\n\n```\n[Upload] -> [Virus Scan] -> [Queue] -> [OCR] -> [Classification] -> [Extraction] -> [Validation] -> [Ready]\n```\n\n**Step 1 -- Virus Scan:** ClamAV scan. Infected files quarantined.\n\n**Step 2 -- OCR:** Text-based PDFs use PyPDF2/pdfplumber. Scanned/image PDFs use Tesseract OCR or Azure Document Intelligence. Complex layouts (tax returns) use Textract AnalyzeDocument with FORMS and TABLES features. Confidence < 0.60 flags for manual review.\n\n**Step 3 -- Classification:** Fine-tuned DistilBERT classifier. Thresholds: >= 0.85 auto-accept, 0.60-0.84 flag for review, < 0.60 require manual classification.\n\n**Step 4 -- Extraction:** Document-type-specific LLM prompts (GPT-4 or Claude) with structured output via function calling. Tax returns extract ~40 line items per return type. Per-field confidence scoring based on OCR clarity, cross-field consistency, and cross-document validation. Thresholds: >= 0.90 auto-validated, 0.70-0.89 flagged, < 0.70 manual review needed.\n\n**Step 5 -- Validation:** Internal consistency checks, cross-document reconciliation, year-over-year reasonableness checks, missing field detection.\n\n### 5.2 Financial Analysis Engine\n\n> **Dependency:** The Financial Analysis Engine reads from `normalized_financials` (produced by the FNE — see `fne-specification.md`), NOT from raw `extraction_results`. The FNE must complete normalization before financial analysis can run. This ensures apples-to-apples comparison across entity types.\n\n```\n[Validated Extractions] -> [FNE Normalization] -> [Spread Computation] -> [Ratio Calculation] -> [Trend Analysis] -> [Benchmark Comparison] -> [Complete]\n```\n\nNine sub-analyses:\n\n1. **Business Cash Flow Coverage** -- Net income + addbacks - deductions = Cash Flow Available / Annual Debt Service = CFC Ratio (multi-year)\n2. **Personal Debt/Income** -- Gross personal income less personal debt obligations per guarantor\n3. **Global Cash Flow Coverage** -- Combined business + personal available cash flow / total debt service\n4. **Balance Sheet** -- Common-size analysis (% of total assets), year-over-year change\n5. **Income Statement** -- Common-size (% of revenue), gross/operating/net margins, YoY change\n6. **Operating Cycle** -- DSO, DIO, DPO, Cash Conversion Cycle\n7. **Ratio Analysis** -- 7 ratios (Current, Quick, D/E, DSCR, ROA, ROE, Working Capital) with benchmarks\n8. **Collateral Coverage** -- Collateral value x advance rate / loan amount. Advance rates: Real estate 80%, equipment 70%, inventory 50%, AR 80%\n9. **Business Debt Schedule** -- Consolidated debts with creditor, balance, payment, rate, maturity, collateral\n\n### 5.3 Risk Assessment Engine\n\n```\n[Financial Data] + [Policy Rules] -> [Risk Identification] -> [Severity Scoring] -> [Narrative Generation]\n```\n\nRule-based identification: DSCR below policy minimum, collateral below 100%, declining revenue > 10%, negative working capital, D/E above policy max, concentration risk, management tenure < 2 years, business age < 3 years, industry-specific risks.\n\nAI-augmented identification: LLM reviews all data for risks not caught by rules (unusual related-party transactions, contingent liabilities, litigation).\n\nSeverity scale: critical, high, elevated, moderate, low.\n\nNarrative generation: LLM synthesizes all risks into cohesive professional narrative with evidence references.\n\n### 5.4 Question Generation Engine\n\nIdentifies information gaps per credit memo section. Generates context-aware open-ended questions with specific data references. Assigns priority (required/important/optional). Maps each question to target memo section.\n\n### 5.5 Narrative Conversion Engine\n\nConverts first-person borrower responses to professional third-person credit memo narrative. Quality checks: no first-person pronouns, cross-reference factual claims with financial data, professional tone.\n\n**Example:**\n- **Input:** \"We had a big order from Home Depot that bumped up our COGS.\"\n- **Output:** \"Management attributes the year-over-year increase in cost of goods sold primarily to a large-volume order from a national retail client.\"\n\n### 5.6 Credit Memo Assembly Engine\n\nGenerates all 17 sections from their respective data sources:\n\n| # | Section | Primary Data Sources |\n|---|---------|---------------------|\n| 1 | Executive Summary | Application, scoring result, recommendation |\n| 2 | Borrower Overview | Application, user profile |\n| 3 | Business Description & History | Application, borrower Q&A responses |\n| 4 | Management & Ownership | Application (guarantors), Q&A |\n| 5 | Use of Funds | Application (use_of_funds) |\n| 6 | Loan Structure & Terms | Loan product, recommended terms |\n| 7 | Financial Analysis -- Income Statement | Income statement spread |\n| 8 | Financial Analysis -- Balance Sheet | Balance sheet spread |\n| 9 | Financial Analysis -- Cash Flow Coverage | CFC + Global CFC spreads |\n| 10 | Financial Analysis -- Ratio Analysis | Ratio analysis spread |\n| 11 | Personal Financial Analysis | Personal D/I spread, PFS data |\n| 12 | Collateral Analysis | Collateral coverage spread |\n| 13 | Business Debt Schedule | Debt schedule spread |\n| 14 | Risk Assessment & Policy Exceptions | Risk items, exception justifications |\n| 15 | Follow-Up Questions & Responses | Q&A pairs with converted narratives |\n| 16 | Scoring Summary | Scoring result, category/factor breakdown |\n| 17 | Recommendation & Conditions | AI recommendation, underwriter notes |\n\nPacket-level quality check: all 17 sections present, financial figures match spread data, no placeholder text, consistent names/amounts, all overrides reflected.\n\n### 5.7 Scoring Engine\n\n```\n[Scoring Model Config] -> [Factor Data Collection] -> [Factor Evaluation] -> [Score Computation] -> [Recommendation]\n```\n\nPer factor: resolve data source, apply evaluation rule (range lookup, boolean, or custom formula), compute points, check for overrides. Per category: sum factors, apply weight. Total = sum of weighted categories. Map to recommendation via score ranges. If data completeness < 70%, override to `insufficient_data`.\n\n---\n\n## 6. Integration Specifications\n\n### 6.1 Salesforce Integration\n\n**Authentication:** OAuth 2.0 Web Server Flow with stored refresh token.\n\n**Inbound:** Salesforce outbound message triggers `POST /webhooks/salesforce` with HMAC-SHA256 validation. Creates/matches borrower user, creates application with `intake_channel = 'salesforce_referral'`.\n\n**Outbound:** Status sync on key events (application submitted, case created, documents complete, analysis complete, approved, declined, exported). Uses `PATCH /sobjects/Opportunity/{id}` with 3-retry exponential backoff.\n\n**Field Mappings:** Configurable per tenant. Covers application ID, case number, status, amount, borrower contact info, approved amount.\n\n### 6.2 LOS Integration (Sidecar API)\n\nRESTful API push from CremoLogix to LOS on export. Payload includes borrower info, loan details, scoring summary, conditions, key metrics, and base64-encoded PDF/Word documents. 3-retry with backoff. Optional webhook from LOS for loan booked/funded events.\n\n### 6.3 Email Service\n\nSendGrid (primary) or Azure Communication Services (fallback). 15+ templates covering borrower lifecycle, underwriter notifications, reviewer alerts, and admin error notifications. All templates use `{{variable}}` merge fields. Delivery tracking via SendGrid webhook events.\n\n### 6.4 Credit Bureau Integration\n\n**Purpose:** Soft pull for pre-qualification Gate 1 (B-01 Easy Apply flow).\n\n**Provider:** Configurable per tenant. Default: Experian (soft pull). Alternative: TransUnion, Equifax.\n\n**Authentication:** OAuth 2.0 client credentials or API key (provider-dependent). Credentials stored in `integration_configs` table (encrypted).\n\n**Flow:**\n1. Borrower submits Easy Apply (B-01) with SSN and consent checkbox\n2. System calls credit bureau API for soft pull (no hard inquiry)\n3. Response includes: credit score, trade lines summary, derogatory marks, public records\n4. Score compared to tenant-configurable threshold (default 580, set in AD-04)\n5. Pass: proceed to KYC gate. Fail: B-03 holding message + ECOA-compliant adverse action notice\n\n**Data Captured:**\n```json\n{\n  \"provider\": \"experian\",\n  \"pull_type\": \"soft\",\n  \"score\": 720,\n  \"score_model\": \"FICO 8\",\n  \"trade_lines_count\": 12,\n  \"derogatory_count\": 0,\n  \"public_records_count\": 0,\n  \"total_revolving_balance\": 4500,\n  \"total_installment_balance\": 125000,\n  \"oldest_trade_line_months\": 96,\n  \"inquiries_last_12_months\": 2,\n  \"pull_date\": \"2026-02-09T10:30:00Z\",\n  \"report_reference_id\": \"EXP-12345\"\n}\n```\n\n**Manual Entry Fallback:** If API is unavailable or borrower provides a recent credit report, underwriter can manually enter credit score and key metrics via the case detail screen. Manual entries are flagged with `extraction_method = 'manual'` in the audit trail.\n\n**Retry:** 3 attempts with exponential backoff (1s, 5s, 15s). On persistent failure, application is held for manual processing.\n\n**Compliance:** Soft pull only (no FCRA permissible purpose inquiry at this stage). Hard pull may be added post-MVP for final underwriting. Adverse action notices generated per ECOA/FCRA requirements.\n\n### 6.5 KYC Identity Verification\n\n**Purpose:** Identity verification for pre-qualification Gate 2 (B-04 screen).\n\n**Provider:** Configurable per tenant. Options: Persona, Jumio, Onfido, Socure.\n\n**Authentication:** API key with webhook secret for callbacks.\n\n**Flow:**\n1. After credit check passes, borrower receives SMS/email link to B-04\n2. System creates verification session via provider API\n3. Borrower completes: photo ID (front + back) + selfie with liveness detection\n4. Provider processes and sends result via webhook callback\n5. Pass (confidence >= 0.85): proceed to background check. Fail: B-03 holding + manual review queue\n\n**Data Captured:**\n```json\n{\n  \"provider\": \"persona\",\n  \"verification_id\": \"inq_abc123\",\n  \"status\": \"passed\",\n  \"confidence\": 0.95,\n  \"document_type\": \"drivers_license\",\n  \"document_country\": \"US\",\n  \"document_state\": \"TX\",\n  \"name_match\": true,\n  \"dob_match\": true,\n  \"address_match\": true,\n  \"liveness_check\": \"passed\",\n  \"fraud_signals\": [],\n  \"verified_at\": \"2026-02-09T11:00:00Z\"\n}\n```\n\n**Retry:** Borrower may retry up to 3 times. After 3 failures, flagged for manual review by Intake Agent.\n\n**Expiry:** KYC verification expires after 90 days (configurable). Re-verification required if expired before case creation.\n\n### 6.6 Background Check Integration\n\n**Purpose:** Criminal, civil, bankruptcy, and regulatory screening for pre-qualification Gate 3.\n\n**Provider:** Configurable per tenant. Options: Checkr, Sterling, GoodHire.\n\n**Authentication:** API key with webhook for async results.\n\n**Flow:**\n1. After KYC passes, system triggers background check via provider API\n2. Provider runs checks asynchronously (typical turnaround: 1-3 business days)\n3. Results delivered via webhook to `/prequalification/:appId/background/callback`\n4. Results displayed on IA-02 (Intake Agent review screen) with AI business intelligence\n5. Intake Agent reviews and decides: Approve to Proceed / Reject (with mandatory reason)\n\n**Checks Performed:**\n- Criminal records (federal + state)\n- Civil litigation history\n- Bankruptcy filings\n- Regulatory sanctions (OFAC, SAM, state debarment)\n- Business entity verification\n\n**Data Captured:**\n```json\n{\n  \"provider\": \"checkr\",\n  \"report_id\": \"rpt_xyz789\",\n  \"status\": \"complete\",\n  \"criminal_records\": [],\n  \"civil_records\": [],\n  \"bankruptcy_records\": [],\n  \"regulatory_flags\": [],\n  \"business_verification\": {\n    \"entity_confirmed\": true,\n    \"registration_state\": \"TX\",\n    \"registration_status\": \"active\",\n    \"registered_agent\": \"Jane Doe\"\n  },\n  \"overall_assessment\": \"clear\",\n  \"completed_at\": \"2026-02-10T14:00:00Z\"\n}\n```\n\n**Manual Override:** Intake Agent can approve despite flagged findings with mandatory rationale (logged in audit trail). Requires Intake Agent role permission.\n\n### 6.7 Document Storage\n\nAzure Blob Storage (production), Azurite (development). Container structure: `{tenant_id}/{case_id}/uploads|ocr|exports/`. Upload via SAS URLs (5 min expiry, 50MB max). Server-side AES-256 encryption. Virus scanning via Azure Function + ClamAV. Retention: 7 years post-closeout for active, 3 years for declined.\n\n---\n\n## 7. Security Architecture\n\n### 7.1 Authentication\n\n- **Access Token:** RS256-signed JWT, 15-minute expiry with `sub`, `tenant_id`, `roles`, `email`, `jti`\n- **Refresh Token:** Opaque token in Redis, 7-day expiry\n- **Max 5 concurrent sessions per user**\n- **Failed login lockout:** 5 attempts -> 15-minute lock\n\n### 7.2 Authorization (RBAC)\n\n**Screen Access:**\n\n| Screen Group | Borrower | Underwriter | Credit Manager | Admin |\n|-------------|----------|-------------|----------------|-------|\n| Borrower screens (B-*) | Yes | -- | -- | -- |\n| Underwriter screens (U-*) | -- | Yes | Read-only (select) | Yes |\n| Review screens (C-*) | -- | -- | Yes | Yes |\n| Admin screens (D-*) | -- | -- | -- | Yes |\n\n**Key Action Permissions:** Borrowers create applications and submit responses. Underwriters manage cases, override AI data, confirm scoring, finalize packets. Credit Managers submit review decisions. Admins configure products, scoring models, users, and integrations.\n\n**Enforcement:** API middleware checks JWT roles. Case-level authorization restricts underwriters to assigned cases. Row-Level Security as defense-in-depth.\n\n### 7.3 Multi-Tenant Data Isolation\n\nPostgreSQL RLS with `tenant_id = current_setting('app.current_tenant_id')`. NestJS middleware sets session variable from JWT. Application code includes `WHERE tenant_id = ?` as defense-in-depth.\n\n### 7.4 Encryption\n\n- **At rest:** Azure Blob SSE (AES-256), PostgreSQL Flexible Server encryption, integration secrets encrypted with AES-256-GCM via Azure Key Vault\n- **In transit:** TLS 1.3 (minimum 1.2) for all communication\n\n### 7.5 PII Handling\n\nSSN encrypted at application level, masked in UI (last 4 only), never logged. Email masked in audit logs. Right to deletion with PII anonymization while retaining financial data for regulatory compliance.\n\n### 7.6 API Security\n\nRate limiting, JSON Schema validation, parameterized queries (no raw SQL), Content-Security-Policy headers, CORS whitelist, 10MB JSON / 50MB file upload limits, MIME type validation, automated dependency scanning in CI.\n\n### 7.7 Compliance\n\n**ECOA:** No protected-class data in scoring. All scoring factors have documented business justification. **Fair Lending:** Complete audit trail of every scoring factor evaluation. Override rationale mandatory. **CDFI Fund:** Case data structured for annual reporting requirements.\n\n---\n\n## 8. Workflow Engine Design\n\n### 8.1 Phase State Machine\n\n13-phase linear workflow with controlled return paths:\n\n```\nconfiguration -> intake -> document_collection -> data_extraction -> financial_analysis\n-> risk_assessment -> follow_up_questions -> response_collection -> override_management\n-> scoring -> packet_assembly -> credit_review -> export_closeout\n\ncredit_review -> override_management (return -- revision cycle)\ncredit_review -> follow_up_questions (return -- additional info)\nAny phase -> withdrawn (case withdrawal)\nexport_closeout -> archived\n```\n\n### 8.1.1 Pre-Qualification Pipeline (Before Phase 1)\n\nThe pre-qualification pipeline runs BEFORE case creation. It operates on the `applications` table (not `cases`) and governs the B-01 through B-06 borrower flow.\n\n```\n[B-01 Easy Apply]\n      |\n      v\n+---------------------+\n| GATE 1: Credit Check |  (credit bureau soft pull — automated)\n| Soft pull via API    |\n| Pass: score >= threshold (configurable via AD-04, default 580)\n| Fail: -> B-03 Holding Message + compliant denial email\n+---------------------+\n      |  PASS\n      v\n+---------------------+\n| GATE 2: KYC          |  (identity verification — borrower action)\n| B-04: Photo ID + selfie with liveness\n| Provider: configurable (e.g., Persona, Jumio, Onfido)\n| Pass: identity confirmed with acceptable confidence\n| Fail: -> B-03 Holding Message (manual review option)\n+---------------------+\n      |  PASS\n      v\n+---------------------+\n| GATE 3: Background   |  (background check — automated)\n| Provider: configurable (e.g., Checkr, Sterling)\n| Checks: criminal, civil, bankruptcy, regulatory\n| Result: -> IA-02 for Intake Agent review\n| Intake Agent decides: Approve to Proceed / Reject\n+---------------------+\n      |  APPROVED\n      v\n+---------------------+\n| GATE 4: Deal Health   |  (initial score — automated)\n| Compute initial Deal Health Score from available data\n| (credit score, KYC pass/fail, background pass/fail)\n| Score < auto-exit threshold (configurable, default 20) -> flag for review\n| Score >= threshold -> proceed\n+---------------------+\n      |  PASS\n      v\n[Case Created -> Phase 1: Configuration]\n```\n\n**Pre-qualification data model:**\n\n```\nTABLE: prequalification_checks\n---------------------------------------------------------------\nColumn                | Type           | Constraints\n---------------------------------------------------------------\nid                    | UUID           | PK\ntenant_id             | UUID           | FK tenants(id), NOT NULL\napplication_id        | UUID           | FK applications(id), NOT NULL\ncheck_type            | ENUM('credit_bureau','kyc','background') | NOT NULL\nprovider              | VARCHAR(100)   | NOT NULL\nprovider_reference_id | VARCHAR(255)   | NULL\nstatus                | ENUM('pending','in_progress','passed','failed','manual_review','expired') | NOT NULL DEFAULT 'pending'\nresult_data_jsonb     | JSONB          | NOT NULL DEFAULT '{}'\nconfidence_score      | DECIMAL(5,4)   | NULL\nfailure_reason        | TEXT           | NULL\nreviewed_by           | UUID           | FK users(id), NULL\nreviewed_at           | TIMESTAMPTZ    | NULL\nexpires_at            | TIMESTAMPTZ    | NULL\ncreated_at            | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at            | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - idx_preq_application(tenant_id, application_id)\n  - idx_preq_type_status(tenant_id, check_type, status)\n```\n\n**Pre-qualification API endpoints:**\n\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| POST | `/prequalification/:appId/credit-check` | System | Trigger credit bureau soft pull |\n| POST | `/prequalification/:appId/kyc/initiate` | None | Generate KYC verification session |\n| POST | `/prequalification/:appId/kyc/callback` | Webhook | KYC provider result callback |\n| POST | `/prequalification/:appId/background/initiate` | System | Trigger background check |\n| POST | `/prequalification/:appId/background/callback` | Webhook | Background check result callback |\n| GET | `/prequalification/:appId/status` | Borrower, UW | Get all gate statuses |\n| POST | `/prequalification/:appId/background/review` | Intake Agent | Approve/reject background results |\n\n### 8.2 Entry and Exit Conditions\n\n| Phase | Entry Conditions | Exit Conditions |\n|-------|-----------------|-----------------|\n| configuration | Tenant setup complete | Active loan product and scoring model |\n| intake | Application exists | Application submitted, minimum docs uploaded |\n| document_collection | Case created | All required document types present |\n| data_extraction | Documents ready | All documents have extraction results |\n| financial_analysis | Extractions validated | All 9 sub-analyses computed |\n| risk_assessment | Analysis complete | Risk items generated, narrative present |\n| follow_up_questions | Risks identified | Questions reviewed (approved/sent/withdrawn) |\n| response_collection | Questions sent | All required questions answered |\n| override_management | Responses collected | No pending overrides |\n| scoring | Overrides resolved | Score computed, underwriter confirmed |\n| packet_assembly | Scoring confirmed | All 17 sections generated, quality check passed |\n| credit_review | Packet finalized | Review decision submitted |\n| export_closeout | Decision recorded | Export generated, case archived or LOS push confirmed |\n\n### 8.3 SLA Timer Management\n\nDefault SLA targets (configurable per phase):\n\n| Phase | Default SLA (hours) |\n|-------|-------------------|\n| intake | 24 |\n| document_collection | 72 |\n| data_extraction | 4 (automated) |\n| financial_analysis | 4 (automated) |\n| risk_assessment | 4 (automated) |\n| follow_up_questions | 8 |\n| response_collection | 120 (borrower dependent) |\n| override_management | 8 |\n| scoring | 4 |\n| packet_assembly | 4 (automated) |\n| credit_review | 48 |\n| export_closeout | 8 |\n\nWarning at 80% of SLA duration. Breach triggers notification to underwriter AND admin.\n\n### 8.4 Auto-Advance Rules\n\nAutomated transitions (no human review required):\n- document_collection -> data_extraction (all docs uploaded + OCR complete)\n- data_extraction -> financial_analysis (all extractions validated)\n- financial_analysis -> risk_assessment (all analyses computed)\n\nHuman-required phases (no auto-advance): follow_up_questions, override_management, scoring, packet_assembly, credit_review.\n\n---\n\n## 9. Audit Trail Architecture\n\n### What Gets Logged\n\nSix categories: (1) Data changes (INSERT/UPDATE/DELETE with old/new values), (2) User actions (login/logout, screen navigation, downloads, exports, decisions), (3) Phase transitions with timestamps and SLA events, (4) AI pipeline events (OCR, classification, extraction, analysis, scoring, memo generation -- all with confidence scores), (5) Override events (created/approved/rejected/reverted with rationale), (6) Integration events (Salesforce webhooks, LOS pushes, email delivery).\n\n### Immutability Guarantees\n\n- Append-only table: no UPDATE or DELETE permissions for application role\n- Monthly range partitioning on `created_at`\n- Application role has INSERT-only access; table owner is separate admin role\n- Optional hash chain post-MVP for tamper detection\n\n### Retention\n\nActive retention: 2 years in primary database. Archive: years 2-7 in S3 as Parquet. Deletion: after 7 years (configurable per tenant).\n\n---\n\n## 10. Non-Functional Requirements\n\n### 10.1 Performance\n\n| Metric | Target |\n|--------|--------|\n| Page load (SPA initial) | < 2.0s |\n| Page navigation (SPA route) | < 500ms |\n| API response (simple reads) | < 200ms p95 |\n| API response (complex queries) | < 500ms p95 |\n| Document upload (50MB) | < 10s |\n| OCR processing (single doc) | < 60s |\n| AI extraction (single doc) | < 30s |\n| Financial analysis (full case) | < 45s |\n| Score computation | < 5s |\n| Credit memo assembly (17 sections) | < 120s |\n| PDF export generation | < 30s |\n\n### 10.2 Scalability\n\n| Dimension | MVP Target | Year 2 Target |\n|-----------|-----------|--------------|\n| Concurrent users | 50 | 500 |\n| Active cases | 200 | 5,000 |\n| API requests/second | 50 | 500 |\n| Document storage | 50 GB | 5 TB |\n\n### 10.3 Availability\n\n| Metric | Target |\n|--------|--------|\n| Uptime | 99.9% |\n| RTO | 1 hour |\n| RPO | 5 minutes |\n| Maintenance window | Sundays 02:00-06:00 ET |\n\n### 10.4 Monitoring\n\nInfrastructure (Azure Monitor): CPU, memory, disk, PostgreSQL metrics, Redis metrics, Container Apps health. Application (Application Insights): API response times per endpoint, error rates, queue depth, AI pipeline times. Business: cases/day, cycle time, SLA breach rate, extraction confidence distribution.\n\n---\n\n## 11. MVP Scope Boundaries\n\n### Human Decision Mandate\n\n> **All credit decisions require explicit Credit Manager action. The system generates recommendations and scores but never approves, denies, or commits to terms without human authorization.**\n\nThis is a non-negotiable architectural constraint. No automated decisioning logic may be implemented without explicit regulatory review and client authorization. Every workflow path that results in a loan approval, denial, or term commitment must pass through a human gate.\n\n### In MVP\n\n| Feature | Detail |\n|---------|--------|\n| Single tenant | Siura Capital pilot |\n| 4 core user roles | Borrower, Underwriter, Credit Manager, Admin |\n| 60 MVP + 1 MVP-LITE screens | See Section 14 for build scope tags (84 total in prototype) |\n| 13-phase workflow | Complete with all transitions |\n| 3 intake channels | Direct, Salesforce referral, external referral |\n| Document processing | OCR, classification, extraction with confidence |\n| 9 financial analyses | Full spread computation suite |\n| Risk assessment | Rule-based + AI-augmented |\n| Follow-up Q&A | AI generation, narrative conversion |\n| Configurable scoring | Weighted multi-factor with categories |\n| Credit memo (17 sections) | AI-assembled with manual editing |\n| PDF/Word export | Credit memo package |\n| Salesforce integration | Inbound referrals + outbound status |\n| Basic LOS export | API push of underwriting package |\n| Credit bureau integration | Soft pull for pre-qualification gate + manual entry fallback |\n| Full notification suite | 15+ email templates + in-app |\n| Comprehensive audit trail | Immutable, append-only |\n| RBAC | Role-based with screen and action permissions |\n| Multi-tenant data layer | tenant_id isolation (ready for multi-tenant) |\n| CDFI reporting (AD-11) | TLR, Impact Metrics, Section 1071 — tenant-configurable (all enabled for Siura Capital) |\n\n### Section 1071 Data Collection Fields\n\nPer CFPB Section 1071 (Small Business Lending Data Collection), the following data points must be captured during the application process and stored for reporting via AD-11:\n\n**Application-Level (auto-populated from application data):**\n\n| Field | Source | Type |\n|-------|--------|------|\n| Unique loan/application ID | `applications.id` | Auto |\n| Application date | `applications.submitted_at` | Auto |\n| Loan/credit type | `loan_products.loan_type` | Auto |\n| Loan/credit purpose | `applications.loan_purpose` | Auto |\n| Amount applied for | `applications.requested_amount` | Auto |\n| Amount approved | `review_decisions.approved_amount` | Auto |\n| Action taken | `cases.status` (mapped) | Auto |\n| Action taken date | `review_decisions.decided_at` | Auto |\n| Denial reasons (up to 4) | `review_decisions.decline_reasons_jsonb` | Auto |\n| Pricing (interest rate) | `review_decisions.approved_rate` | Auto |\n| Census tract (borrower address) | Derived from `applications.business_address_jsonb` | Computed |\n| NAICS code | `applications.naics_code` | Auto |\n| Gross annual revenue | `applications.annual_revenue` | Auto |\n| Number of employees | `applications.employee_count` | Auto |\n| Time in business | `applications.years_in_business` | Auto |\n\n**Demographic (collected via optional borrower self-report — separate from credit decision):**\n\n```\nTABLE: section_1071_demographics\n---------------------------------------------------------------\nColumn                    | Type           | Constraints\n---------------------------------------------------------------\nid                        | UUID           | PK\ntenant_id                 | UUID           | FK tenants(id), NOT NULL\napplication_id            | UUID           | FK applications(id), NOT NULL, UNIQUE\nminority_owned_status     | ENUM('yes','no','not_provided') | NOT NULL DEFAULT 'not_provided'\nminority_ethnicity        | TEXT[]         | NOT NULL DEFAULT '{}'\nwomen_owned_status        | ENUM('yes','no','not_provided') | NOT NULL DEFAULT 'not_provided'\nlgbtqi_owned_status       | ENUM('yes','no','not_provided') | NOT NULL DEFAULT 'not_provided'\nveteran_owned_status      | ENUM('yes','no','not_provided') | NOT NULL DEFAULT 'not_provided'\nprincipal_owner_count     | INTEGER        | NULL\nprincipal_owners_jsonb    | JSONB          | NOT NULL DEFAULT '[]'\ncollection_method         | ENUM('web_form','verbal','paper','not_collected') | NOT NULL\ncollected_at              | TIMESTAMPTZ    | NULL\ncreated_at                | TIMESTAMPTZ    | NOT NULL DEFAULT now()\nupdated_at                | TIMESTAMPTZ    | NOT NULL DEFAULT now()\n---------------------------------------------------------------\nINDEXES:\n  - UNIQUE(application_id)\n  - idx_1071_tenant(tenant_id)\n\nprincipal_owners_jsonb schema (per owner):\n{\n  \"ethnicity\": [\"hispanic_or_latino\"] | [\"not_hispanic_or_latino\"] | [\"not_provided\"],\n  \"race\": [\"american_indian\",\"asian\",\"black\",\"hawaiian_pacific\",\"white\",\"not_provided\"],\n  \"sex\": \"male\" | \"female\" | \"not_provided\"\n}\n```\n\n**Collection Rules:**\n- Demographic data MUST be collected on a separate screen from the loan application (firewall)\n- Borrower may select \"I do not wish to provide this information\" for any field\n- Demographic data is NEVER used in credit decisions, scoring, or underwriting\n- Demographic data is NEVER visible on underwriter or credit manager screens\n- Data is stored in a separate table with restricted access (Admin + reporting only)\n- Fair Lending Analytics (AD-12) uses this data for disparate impact monitoring\n\n### NOT in MVP (Deferred)\n\n| Feature | Target Release |\n|---------|----------------|\n| Vendor Marketplace (B-14) | Phase 2 — in prototype for demos |\n| Denied Applicant Nurture (D-01–D-05) | Phase 2 — pending legal opinion on FCRA re-qualification |\n| External Funding Portal (EF-01–EF-04) | Phase 2 — PDF packet approach for MVP |\n| FinOps Resource Portal (FO-01–FO-08) | Phase 2 — Borrower Success Ecosystem |\n| Cross-tenant intelligence | v2.0 |\n| Mobile application | v2.0 |\n| Advanced analytics/reporting | v1.5 |\n| SSO / SAML | v1.5 |\n| Real-time collaboration | v2.0 |\n| Chat-based borrower responses | v1.5 |\n| Phone transcription | v2.0 |\n| Batch document upload (ZIP) | v1.5 |\n| Custom report builder | v2.0 |\n| Multi-language support | v2.0 |\n| Automated decisioning | Regulatory review required — see Human Decision Mandate |\n| Third-party data enrichment | v2.0 |\n\n---\n\n## 12. Dependency Matrix\n\n### External Services\n\n| Service | Purpose | Criticality | Fallback |\n|---------|---------|-------------|----------|\n| Azure PostgreSQL Flexible Server | Primary database | Critical | Zone-redundant HA |\n| Azure Blob Storage | Document/export storage | Critical | GRS replication |\n| Azure Cache for Redis 7 | Cache, queues, sessions | High | Zone-redundant |\n| Azure Container Apps | Container orchestration | Critical | Multi-zone replicas |\n| Azure Key Vault | Encryption keys + secrets | Critical | Managed service SLA |\n| Azure Document Intelligence | OCR for complex documents | High | Tesseract (self-hosted) |\n| OpenAI/Anthropic API | LLM for extraction, analysis, generation | Critical | Secondary provider |\n| Salesforce API | TOS integration | Medium | Manual referral entry |\n| SendGrid / Azure Comm Services | Email delivery | High | Azure Comm Services as fallback |\n| ClamAV | Virus scanning | High | Self-hosted container |\n\n### Estimated Monthly Infrastructure Cost (MVP)\n\n| Resource | Cost |\n|----------|------|\n| Azure infrastructure (Container Apps, PostgreSQL, Redis, Blob, Front Door, etc.) | ~$615/month |\n| LLM API (OpenAI/Anthropic, ~2000 docs/month) | ~$500/month |\n| SendGrid (5000 emails/month) | $90/month |\n| GitHub Team | $44/month |\n| **Total** | **~$1,485/month** |\n\n### Screen-to-API Mapping (Appendix)\n\n| Screen ID | Screen Name | Primary API Endpoints |\n|-----------|-------------|----------------------|\n| B-1 | Landing Page | (Static) |\n| B-2/3/4 | Register variants | `POST /auth/register*` |\n| B-5 | Verify Email | `POST /auth/verify-email` |\n| B-6 | Login | `POST /auth/login` |\n| B-7 | Borrower Dashboard | `GET /borrower/applications`, `GET /notifications` |\n| B-8 | Application Intake | `POST /borrower/applications`, documents |\n| B-9 | Application Status | `GET .../applications/:id/status` |\n| B-10 | Clarification Q&A | `GET/POST .../questions` |\n| U-1 | Underwriter Dashboard | `GET /cases`, `GET /notifications` |\n| U-2 | Unassigned Queue | `GET /cases/unassigned` |\n| U-3 | Case Creation | `POST /cases` |\n| U-4 | Case Overview | `GET /cases/:id`, timeline |\n| U-5 | Documents | `GET /cases/:id/documents` |\n| U-6a-i | Financial Analysis (9 tabs) | `GET /cases/:id/financial/*` |\n| U-7 | Risk & Exceptions | `GET /cases/:id/risks` |\n| U-8/9 | Follow-Up / Response Review | `GET/POST /cases/:id/follow-ups` |\n| U-10 | Override Mgmt | `GET/POST /cases/:id/overrides` |\n| U-11 | Scoring Review | `GET/POST /cases/:id/scoring` |\n| U-12 | Packet Preview | `GET /cases/:id/packet` |\n| U-14 | Closeout | `POST .../export`, `POST .../push-to-los` |\n| C-1 | Review Dashboard | `GET /review/queue` |\n| C-2a-g | Case Review (7 tabs) | `GET /review/cases/:id/*` |\n| D-1 through D-7 | Admin screens | `/admin/*` endpoints |\n\n---\n\n## 13. Prototype Design System\n\n> Source: `C:/projects/CremoLogix_Prototype_Spec_v2.md`\n\n### Brand\n\n- **Product Name:** CremoLogix\n- **Tagline:** \"Intelligent Lending. Lasting Impact.\"\n- **Primary Color:** #1B4D7A (deep blue)\n- **Secondary Color:** #2E8B57 (sea green -- success/growth)\n- **Accent Color:** #E8943A (warm amber -- alerts/CTAs)\n- **Error/Danger:** #DC3545\n- **Warning:** #FFC107\n- **Background:** #F5F7FA (light gray)\n- **Card Background:** #FFFFFF\n- **Text Primary:** #1A1A2E\n- **Text Secondary:** #6C757D\n- **Font:** Inter (headings), system sans-serif fallback\n\n### Layout Patterns\n\n- **Public Pages** (landing, KYC): Full-width, centered content, no sidebar\n- **Portal Pages** (all authenticated): Left sidebar navigation (240px) + main content area\n- **Mobile Screens** (KYC): Responsive, single-column, large touch targets\n\n### Common Components\n\n- **Sidebar:** Logo, user name/role, navigation links, logout. Color-coded by role (blue=borrower, green=staff, orange=broker, purple=finops)\n- **Top Bar:** Page title, breadcrumbs, notification bell, user avatar\n- **Cards:** White background, subtle shadow, 8px border-radius, 24px padding\n- **Status Badges:** Green=Active/Complete, Yellow=Pending/Warning, Red=Denied/Overdue, Blue=In Progress, Gray=Not Started\n- **Tables:** Striped rows, sortable columns, pagination\n- **Modals:** Centered overlay, dark backdrop, max-width 600px\n- **Deal Health Indicator:** Circular gauge (0-100) with color gradient (red -> yellow -> green)\n- **Three-Layer Commentary:** Tabbed panel with Borrower Footnotes | System Observations | Staff Notes\n\n---\n\n## 14. Prototype Screen Inventory\n\n### Build Scope vs. Demo Scope\n\nThe prototype contains **84 total screens** representing the full product vision. Not all screens are built in MVP. Each screen is tagged with a build scope:\n\n- **MVP** — Built and functional in the first release\n- **POST-MVP** — Designed in prototype for client demos and vision alignment; built in a later phase\n- **MVP-LITE** — Included in MVP with reduced scope (e.g., curated content instead of full CMS)\n\nThe prototype is a **sales and alignment tool** — it tells the full story. The build plan only includes MVP and MVP-LITE screens.\n\n### Screen Count Summary\n\n| User Type | Total Screens | MVP | MVP-LITE | POST-MVP | Prefix |\n|---|---|---|---|---|---|\n| Borrower (Direct + Broker-Referred) | 17 | 14 | 1 | 2 | B- |\n| Denied Applicant (Borrower State) | 5 | 0 | 0 | 5 | D- |\n| Broker | 7 | 7 | 0 | 0 | BK- |\n| Intake Agent | 4 | 4 | 0 | 0 | IA- |\n| Underwriter | 10 | 10 | 0 | 0 | UW- |\n| Credit Manager | 6 | 6 | 0 | 0 | CM- |\n| External Funding Stakeholder | 4 | 0 | 0 | 4 | EF- |\n| FinOps Resource | 8 | 0 | 0 | 8 | FO- |\n| Administrator | 14 | 14 | 0 | 0 | AD- |\n| SPA Demo Shells | 9 | 5 | 0 | 4 | demo- |\n| **TOTAL** | **84** | **60** | **1** | **23** | |\n\n### Per-Screen Build Scope Tags\n\n---\n\n### Section 1: Borrower Screens (B-01 through B-17)\n\n**B-01: Landing Page & Easy Apply**\n- **Purpose:** Public-facing entry point. Hero section + Easy Apply form.\n- **Key Components:** Full-width hero with headline, Easy Apply form (name, DOB, SSN, addresses, loan amount, use of funds, consent checkbox), 3-step \"How It Works\" strip, footer.\n- **Navigation:** Submit -> B-02 (success) or B-03 (holding message if denied)\n\n**B-02: Application Confirmation / Processing**\n- **Purpose:** Shown immediately after form submission during credit check.\n- **Key Components:** Processing spinner (3-5 seconds), then success state with green checkmark and \"check your phone\" message for KYC link.\n- **Navigation:** Credit PASS -> This screen; Credit FAIL -> B-03\n\n**B-03: Generic Holding Message**\n- **Purpose:** Neutral message for denied applicants. Denial notification comes separately via compliant email.\n- **Key Components:** Neutral icon (NOT a warning), \"Thank You\" headline, \"team member is reviewing\" message.\n- **Design Principle:** Must feel neutral and professional, NOT negative. No red colors, no warning icons.\n\n**B-04: KYC Identity Verification**\n- **Purpose:** Mobile-optimized identity verification (photo ID front/back + selfie with liveness).\n- **Key Components:** Step 1 (photo ID front/back), Step 2 (selfie with liveness), submission button.\n- **Navigation:** KYC PASS -> B-05; KYC FAIL -> B-03\n- **Broker-Referred Variation:** Welcome message explaining who submitted the application.\n\n**B-05: KYC Confirmation**\n- **Purpose:** Confirms identity verification success with \"What happens next\" steps.\n- **Navigation:** -> B-06 (login/account creation)\n\n**B-06: Borrower Login**\n- **Purpose:** Authenticated entry point. Login card + first-time account creation flow.\n- **Navigation:** -> B-07 (dashboard)\n\n**B-07: Borrower Dashboard**\n- **Purpose:** Central hub showing application status, documents, timeline, and next steps.\n- **Key Components:** Application status pipeline banner, Next Steps card with CTA to B-09, Document Status card with progress bar, Timeline card, Messages preview.\n- **State Variations:** Pre-Background, During Due Diligence, Under Review, Approved, Post-Closing.\n- **Sidebar:** Dashboard, My Application, Documents, Messages, Term Sheet (after Stage 4), My Loan (post-closing), Education, Marketplace, Settings.\n\n**B-08: Preliminary Term Sheet**\n- **Purpose:** Estimated loan terms shown after entering Stage 4 (Due Diligence).\n- **Key Components:** Disclaimer banner (amber), term details (amount, rate range, term, fees, repayment type).\n\n**B-09: Conversational Document Collection**\n- **Purpose:** Primary interaction screen during Stage 4. Chat-style guided document submission and Q&A.\n- **Key Components:** Chat container with system/borrower bubbles, document upload zones within chat flow, integration connection prompts (Plaid, QuickBooks, IRS), conditional collateral request, progress indicator, fixed chat input area.\n\n**B-10: Final Term Sheet & Closing Review**\n- **Purpose:** Final approved terms and closing documents for e-signature.\n- **Key Components:** Congratulations banner, final term details, closing documents list with view/sign status, e-signature CTA.\n\n**B-11: E-Signature**\n- **Purpose:** Embedded DocuSign (or similar) flow for closing documents.\n- **Key Components:** Document viewer with signature fields, progress tracking, completion confirmation.\n\n**B-12: Post-Closing Borrower Dashboard**\n- **Purpose:** Replaces B-07 after loan closing. Loan management hub.\n- **Key Components:** Loan summary card, covenant calendar, integration status, AI financial insights feed, quick access grid (Education, Marketplace, Messages, Loan Documents).\n- **Updated Sidebar:** Dashboard, Loan Details, Covenant Calendar, Financial Insights, Messages, Education Portal, Vendor Marketplace, Settings.\n\n**B-13: Education Portal** `MVP-LITE`\n- **Purpose:** Financial literacy courses and content library.\n- **Key Components:** Course catalog with category filters, featured course card, course grid (3-column), My Courses section with progress tracking.\n- **MVP-LITE Scope:** Launch with curated external links and partner content only. No original content creation. No CMS. Upgrade to full CMS in Phase 2.\n\n**B-14: Vendor Marketplace** `POST-MVP`\n- **Purpose:** Partner discounts and business services.\n- **Key Components:** Category-filtered vendor grid (3-column), featured partners carousel, offer detail modals.\n- **Deferred:** Phase 2. Requires vendor onboarding, curation, and commission model. Retained in prototype for client vision demos.\n\n**B-15: Messaging Interface**\n- **Purpose:** In-platform communication with FinOps Resource or support.\n- **Key Components:** Conversation list panel (left), chat panel (right), optional context panel.\n\n**B-16: Profile & Settings**\n- **Purpose:** Account management.\n- **Key Components:** Personal info, business info, notification preferences, integration management, security (password, 2FA), data & privacy.\n\n**B-17: Broker-Referred Welcome Screen**\n- **Purpose:** First screen for broker-referred borrowers before KYC.\n- **Key Components:** Welcome card explaining who submitted their application, company introduction, \"Verify My Identity\" CTA -> B-04.\n\n---\n\n### Section 2: Denied Applicant Screens (D-01 through D-05) `ALL POST-MVP`\n\n> **All 5 screens are POST-MVP.** Retained in prototype for client vision demos. Build deferred pending legal opinion on FCRA-compliant re-qualification monitoring (Discovery Condition 4). Re-qualification mechanism must be specified and legally validated before development begins.\n\n**D-01: Denied Applicant Dashboard** `POST-MVP`\n- **Purpose:** Central hub showing denial reason, resources, and re-qualification progress.\n- **Key Components:** Denial summary card (consumer-friendly reason), recommended resources (path-specific: credit denial vs. financial performance vs. background), re-qualification progress card (if on nurture path with visual progress bars per metric), reapply card.\n- **Sidebar:** Dashboard, My Resources, Progress Tracker, Education Portal, Vendor Marketplace, Messages, Subscription, Settings.\n\n**D-02: Subscription Management** `POST-MVP`\n- **Purpose:** Paid advisory services for denied applicants on financial performance nurture path.\n- **Key Components:** Current plan card, plan comparison table (Basic free / Growth $XX/mo / Premium $XX/mo), billing history.\n\n**D-03: Credit Repair Resources** `POST-MVP`\n- **Purpose:** Curated credit improvement resources for credit-denied applicants.\n- **Key Components:** Step-by-step improvement guide, partner referrals, credit building tools.\n\n**D-04: Re-Qualification Progress & Soft Term Sheet** `POST-MVP`\n- **Purpose:** Detailed progress toward re-qualification with soft term sheet when criteria met.\n- **Key Components:** Progress metrics cards with visual bars per metric, data source status, soft term sheet (shown only when ALL thresholds met) with celebration banner and \"Apply Now\" CTA.\n\n**D-05: Reapply Call-to-Action** `POST-MVP`\n- **Purpose:** Simple reapplication encouragement page.\n- **Key Components:** \"Ready for Another Look?\" card with \"Start New Application\" CTA -> B-01.\n\n---\n\n### Section 3: Broker Screens (BK-01 through BK-07)\n\n**BK-01: Broker Login** -- Orange/amber accent theme. Standard login card.\n\n**BK-02: Broker Dashboard** -- Summary stats bar (total deals, active, approved, denied, pending action), deals table (sortable/filterable), action required banner.\n\n**BK-03: New Submission -- Packet Upload** -- Borrower information form (required fields) + packet upload zone (drag-and-drop, multi-file). Auto-processes and begins credit check.\n\n**BK-04: Packet Incomplete -- Missing Items** -- Alert banner, missing items list with per-item upload zones, submit supplement button.\n\n**BK-05: Deal Detail View** -- Deal header with status badge, vertical status timeline with stage-by-stage progress, current stage details card, outcome card (when decided).\n\n**BK-06: Notification Center** -- Notification list with type icons (status change, incomplete, approval, denial, stall alert), notification preferences toggles.\n\n**BK-07: Broker Profile & Settings** -- Company info, personal info, notification preferences, security, submission history.\n\n---\n\n### Section 4: Intake Agent Screens (IA-01 through IA-04)\n\n**IA-01: Review Queue Dashboard** -- Queue stats (pending, avg time, completed today), review queue table sorted by priority.\n\n**IA-02: Deal Review Screen** -- Two-column layout. Left: Clear Report results (criminal, civil, bankruptcy, regulatory findings with flags). Right: AI business intelligence (website validation, online reviews, public profile, business registration, news/media). Bottom: System recommendation card (PROCEED green or CONCERN amber/red). Action buttons: \"Approve to Proceed\" / \"Reject\" (with mandatory reason modal).\n\n**IA-03: Completed Reviews History** -- Filterable table of past reviews with date, outcome, and reason.\n\n**IA-04: Settings** -- Notification and security preferences.\n\n---\n\n### Section 5: Underwriter Screens (UW-01 through UW-10)\n\n**UW-01: Underwriter Dashboard** -- Summary stats (active cases, escalations, ready for review, avg deal health), active cases table with deal health gauge per case, escalation alerts banner.\n\n**UW-02: Deal Detail -- Real-Time Feed** -- Deal header with health gauge, chronological activity feed (documents received, analyses complete, borrower footnotes, health score changes, integration events), document tracker panel, deal health history mini chart. Navigation to UW-03 through UW-09.\n\n**UW-03: Financial Analysis Workspace** -- 4-tab interface. Tab 1: Financial Spreading (multi-year income statement, balance sheet, cash flow with editable override fields). Tab 2: Ratio Analysis (key ratios in cards with trends, benchmarks, pass/fail, three-layer commentary). Tab 3: Trend Analysis (multi-year charts with system narrative). Tab 4: Manual Analysis (structured forms for collateral, lien search, UCC filings, industry analysis).\n\n**UW-04: Manual Analysis Input Form** -- Analysis type selector (Collateral, Lien Search, UCC, Industry, Site Visit, Other), type-specific form fields with impact/severity assessment and document upload.\n\n**UW-05: Escalation -- Create** -- Escalation form (component dropdown, item being escalated, context/question, urgency), active escalations list below.\n\n**UW-06: Escalation -- View Response** -- Escalation thread (original + manager response + back-and-forth), action buttons (Mark Resolved, Reply, Return to Deal).\n\n**UW-07: Credit Memo Review** -- Two-column layout. Left: system-generated credit memo (read-only, professional format with sections: Executive Summary, Borrower Profile, Financial Analysis, Risk Assessment, Collateral, Recommendation). Right: Three-Layer Commentary (Borrower Footnotes | System Observations | Staff Notes). Bottom: Underwriter's Assessment (rich text), Recommendation (Approve/Deny), \"Advance to Credit Manager\" CTA.\n\n**UW-08: Route Borrower Questions** -- Question form (context, question text, priority), pending questions list with borrower responses.\n\n**UW-09: Virtual Workpapers Viewer** -- Filterable chronological timeline of all notes, comments, escalations, reviews, and decisions. Immutable audit trail with expandable entries.\n\n**UW-10: Case History** -- Archive of completed cases with outcome, recommendation, and date filters.\n\n---\n\n### Section 6: Credit Manager Screens (CM-01 through CM-06)\n\nThe Credit Manager has access to ALL underwriter screens (UW-01 through UW-10) plus:\n\n**CM-01: Manager Dashboard** -- Key metrics bar (active deals, unassigned, escalations, pending reviews, avg pipeline days), team workload grid (cards per underwriter with caseload and health gauge), urgent items panel, pipeline funnel chart.\n\n**CM-02: Case Assignment Interface** -- Left: unassigned cases list with system suggestion (\"Suggested: [name] -- lowest caseload\"). Right: underwriter workload panel with capacity indicators. Assignment history below.\n\n**CM-03: Escalation Review & Response** -- Left: pending escalations list. Right: escalation detail with supporting data and response section (rich text + submit).\n\n**CM-04: Final Review Screen** -- Deal summary header with health score history, credit memo (left column), underwriter recommendation panel (right), three-layer commentary, workpapers access, decision panel: Approve (green), Deny (red with mandatory reason), Flag Concerns (amber -- routes back to underwriter).\n\n**CM-05: All Deals View** -- Advanced filter bar (stage, underwriter, health range, date, status, source, amount range), all-deals table with full columns.\n\n**CM-06: Team Performance** -- Performance metrics grid per underwriter (cases completed, avg cycle time, escalation rate, approval/denial ratio), trend charts, escalation analytics.\n\n---\n\n### Section 7: External Funding Stakeholder Screens (EF-01 through EF-04) `ALL POST-MVP`\n\n> **All 4 screens are POST-MVP.** Near-term approach uses PDF credit packet via email + manual decision logging by Credit Manager. Self-service external portal built in Phase 2. Retained in prototype for client vision demos.\n\n**EF-01: External Reviewer Login** `POST-MVP` -- Standard login card with \"External Review Portal\" subtitle.\n\n**EF-02: Review Dashboard** `POST-MVP` -- Pending reviews table (borrower, business, amount, CDFI approval date, days pending), completed reviews history.\n\n**EF-03: Deal Review Screen** `POST-MVP` -- Deal summary header with internal approval status, full credit memo, supporting analysis panel (tabbed: Financial, Ratios, Risk, Collateral), supporting documents list, internal notes summary.\n\n**EF-04: Decision Actions** `POST-MVP` -- Approve (green), Conditional Approval (amber with conditions form), Deny (red with mandatory reason), comments field, submit button.\n\n---\n\n### Section 8: FinOps Resource Screens (FO-01 through FO-08) `ALL POST-MVP`\n\n> **All 8 screens are POST-MVP.** The FinOps Resource portal is a Phase 2 feature within the Borrower Success Ecosystem. Retained in prototype for client vision demos to show the full post-closing support model.\n\n**FO-01: FinOps Login** `POST-MVP` -- Purple accent theme with \"Financial Advisor Portal\" subtitle.\n\n**FO-02: FinOps Dashboard** `POST-MVP` -- Summary stats (active cases, active borrowers, denied applicants, unread messages), cases table with case type badges (Active Borrower green / Denied Applicant amber), recent activity feed.\n\n**FO-03: Case Detail -- Client Profile** `POST-MVP` -- Tabbed interface. Profile tab: client info, case type, loan details or denial reason. Links to FO-04 through FO-08.\n\n**FO-04: Financial Data Viewer** `POST-MVP` -- Read-only financial summary cards, historical trend charts, system observations feed, AI Financial Advisor recommendations.\n\n**FO-05: Covenant Compliance (Active Borrowers)** `POST-MVP` -- Covenant status grid with compliance badges, compliance timeline, data source status.\n\n**FO-06: Qualification Gap Analysis (Denied Applicants)** `POST-MVP` -- Gap analysis cards per metric (current value vs. required threshold with progress bar and trend), recommended actions, progress history chart.\n\n**FO-07: Messaging Interface** `POST-MVP` -- Threaded communication with data reference tool (insert live data points into messages), file sharing.\n\n**FO-08: Internal Notes & Recommendations Log** `POST-MVP` -- Chronological notes timeline, formal recommendations log with status tracking and \"Share with Client\" option.\n\n---\n\n### Section 9: Administrator Screens (AD-01 through AD-14)\n\n**AD-01: Admin Dashboard** -- System health cards, pipeline funnel with conversion rates, KPIs (avg cycle time, approval rate, denial rate by reason, integration adoption), recent activity log.\n**Sidebar:** Dashboard, Loan Products, Scoring Configuration, Workflow Configuration, Document Checklists, Notification Templates, User Management, Integration Management, System Parameters, Credit Memo Templates, CDFI Reporting, Fair Lending Analytics, Audit Trail, Settings.\n\n**AD-02: Loan Product Configuration** -- Products table, product detail/edit form (name, type, amount/rate/term ranges, fee structure, collateral requirements, eligible entities, required documents, covenant template, status).\n\n**AD-03: Scoring Configuration** -- Deal Health Score: factors and weights with sliders, threshold configuration (green/yellow/red/auto-exit). Custom Scoring Models: factors, point ranges, passing threshold.\n\n**AD-04: Workflow & Approval Gate Configuration** -- Visual pipeline editor with drag-and-drop, per-gate configuration (credit threshold, KYC, background, deal health, inactivity timeout), external funding trigger rules.\n\n**AD-05: Document Checklist Configuration** -- Master checklist table (type, stage, priority, required/conditional, trigger condition, formats, source options), drag-and-drop sequencing, document edit form with rule builder for conditional triggers.\n\n**AD-06: Notification Template Management** -- Templates table by type, template editor with channel toggles (email/text/in-app), rich text with merge fields, preview, timing configuration.\n\n**AD-07: User & Role Management** -- Users table with role/status, invite user flow, user detail/edit with permissions and activity history.\n\n**AD-08: Integration Management** -- Integration cards grid (Credit Bureau, KYC, CLEAR, Plaid, QuickBooks, IRS, DocuSign, SMS, Email, Salesforce), per-service configuration with credentials, environment toggle, connection logs, error history, fallback configuration. All integrations optional.\n\n**AD-09: System Parameters Configuration** -- Parameters grouped by category (Intake, Due Diligence, Servicing, Assignment, Incentives, Re-qualification, Inactivity) with current values, edit fields, defaults, and descriptions.\n\n**AD-10: Credit Memo Template Configuration** -- Reorderable section list with include toggles, per-section configuration (title, content sources, formatting, AI generation instructions), live preview.\n\n**AD-11: CDFI Reporting** -- 3 tabs. TLR Report Generator (date range, generate, preview, download). Impact Metrics Dashboard (loans, jobs, businesses, geography map, target market activity). Section 1071 Data (collection status, quality indicators, export).\n\n**AD-12: Fair Lending Analytics Dashboard** -- Approval rate analysis by protected class, per-gate pass/fail rates by demographic, pricing analysis by demographic group, model performance metrics with drift detection.\n\n**AD-13: Audit Trail & System Logs** -- Filter bar (date, user, action type, entity type, search), audit log table with expandable rows, export button.\n\n**AD-14: Admin Settings** -- Company information, branding, security policies (password requirements, session timeout, 2FA enforcement), data retention policies, backup settings.\n\n---\n\n## 15. Screen Navigation Map\n\n```\nPUBLIC ENTRY POINTS\n+-- B-01 Landing Page -> B-02 Confirmation -> (wait for KYC link)\n|                     -> B-03 Holding Message (if denied)\n+-- BK-01 Broker Login -> BK-02 Dashboard\n+-- B-17 Broker-Referred Welcome -> B-04 KYC\n\nBORROWER FLOW\n+-- B-04 KYC -> B-05 KYC Confirmation -> B-06 Login -> B-07 Dashboard\n+-- B-07 Dashboard -> B-09 Conversational Collection\n|                  -> B-08 Preliminary Term Sheet\n|                  -> B-15 Messages\n|                  -> B-16 Settings\n+-- B-09 Conversational -> (completes) -> B-07 Dashboard (waiting state)\n+-- B-10 Final Term Sheet -> B-11 E-Signature -> B-12 Post-Closing Dashboard\n+-- B-12 Post-Closing -> B-13 Education\n|                     -> B-14 Marketplace\n|                     -> B-15 Messages\n|                     -> B-16 Settings\n\nDENIED APPLICANT FLOW (borrower state)\n+-- B-07 Dashboard -> D-01 Denied Dashboard\n+-- D-01 -> D-02 Subscription Management\n|        -> D-03 Credit Repair Resources\n|        -> D-04 Re-Qualification Progress\n|        -> D-05 Reapply CTA -> B-01\n|        -> B-13 Education\n|        -> B-14 Marketplace\n|        -> B-15 Messages (if subscribed)\n\nBROKER FLOW\n+-- BK-02 Dashboard -> BK-03 New Submission -> BK-04 Incomplete -> BK-02\n|                   -> BK-05 Deal Detail\n|                   -> BK-06 Notifications\n|                   -> BK-07 Settings\n\nINTAKE AGENT FLOW\n+-- IA-01 Queue -> IA-02 Deal Review -> IA-01 (approved/rejected)\n+-- IA-03 Completed Reviews\n+-- IA-04 Settings\n\nUNDERWRITER FLOW\n+-- UW-01 Dashboard -> UW-02 Deal Detail -> UW-03 Financial Analysis\n|                                        -> UW-04 Manual Analysis\n|                                        -> UW-05 Escalation Create\n|                                        -> UW-06 Escalation Response\n|                                        -> UW-07 Credit Memo Review -> (advance to CM)\n|                                        -> UW-08 Route Questions\n|                                        -> UW-09 Workpapers\n+-- UW-10 Case History\n\nCREDIT MANAGER FLOW\n+-- CM-01 Dashboard -> CM-02 Case Assignment\n|                   -> CM-03 Escalation Response\n|                   -> CM-04 Final Review -> (approve/deny/flag)\n|                   -> CM-05 All Deals\n|                   -> CM-06 Team Performance\n|                   -> (All UW screens for direct deal work)\n\nEXTERNAL STAKEHOLDER FLOW\n+-- EF-01 Login -> EF-02 Dashboard -> EF-03 Deal Review -> EF-04 Decision\n\nFINOPS FLOW\n+-- FO-01 Login -> FO-02 Dashboard -> FO-03 Client Profile\n|                                   -> FO-04 Financial Data\n|                                   -> FO-05 Covenant Compliance\n|                                   -> FO-06 Gap Analysis\n|                                   -> FO-07 Messaging\n|                                   -> FO-08 Notes\n\nADMIN FLOW\n+-- AD-01 Dashboard -> AD-02 through AD-14 (all accessible from sidebar)\n```\n\n---\n\n## Glossary\n\n| Term | Definition |\n|------|-----------|\n| **CDFI** | Community Development Financial Institution -- mission-driven lender |\n| **TOS** | Top of Stack -- the CDFI's primary CRM (Salesforce for Siura Capital) |\n| **LOS** | Loan Origination System -- system of record for loan lifecycle |\n| **Sidecar** | Architecture pattern where CremoLogix operates alongside (not inside) the LOS |\n| **CFC** | Cash Flow Coverage -- ratio of available cash flow to debt service |\n| **DSCR** | Debt Service Coverage Ratio -- synonym for CFC in many contexts |\n| **D/I** | Debt-to-Income ratio -- personal obligation measure |\n| **PFS** | Personal Financial Statement -- individual net worth disclosure |\n| **DSO** | Days Sales Outstanding -- AR collection speed |\n| **DIO** | Days Inventory Outstanding -- inventory turnover speed |\n| **DPO** | Days Payable Outstanding -- AP payment speed |\n| **NAICS** | North American Industry Classification System -- industry code |\n| **ECOA** | Equal Credit Opportunity Act -- federal fair lending law |\n| **RLS** | Row-Level Security -- PostgreSQL feature for tenant isolation |\n| **SLA** | Service Level Agreement -- time target for phase completion |\n\n---\n\n*End of Specification*\n";
  document.getElementById('content').innerHTML = marked.parse(md);
</script>
</body>
</html>