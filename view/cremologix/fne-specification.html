<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CremoLogix — Fne Specification</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --navy: #1E3A5F; --blue: #2D7DD2; --green: #28A745; --amber: #F4A261;
  --red: #E63946; --light-bg: #F8F9FA; --text: #333333; --text-light: #666666;
  --border: #DEE2E6; --white: #FFFFFF;
}
@page { size: letter; margin: 0.75in; }
html { font-size: 10.5pt; }
body { font-family: system-ui, 'Segoe UI', sans-serif; color: var(--text); line-height: 1.6; background: var(--white); }
@media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .cover { box-shadow: none !important; } .no-print { display: none !important; } }
.cover { background: linear-gradient(135deg, #1E3A5F 0%, #0F1F33 60%, #162D4A 100%); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 100vh; position: relative; overflow: hidden; }
.cover::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(ellipse at 30% 20%, rgba(45,125,210,0.12) 0%, transparent 50%), radial-gradient(ellipse at 70% 80%, rgba(45,125,210,0.08) 0%, transparent 50%); pointer-events: none; }
.cover-content { position: relative; z-index: 1; max-width: 700px; }
.cover .brand-mark { font-size: 1.4rem; font-weight: 300; letter-spacing: 0.35em; text-transform: uppercase; color: rgba(255,255,255,0.7); margin-bottom: 60px; border: 1px solid rgba(255,255,255,0.2); display: inline-block; padding: 10px 28px; border-radius: 4px; }
.cover h1 { font-size: 3rem; color: white; margin-bottom: 20px; font-weight: 700; letter-spacing: -0.02em; }
.cover .subtitle { font-size: 1.3rem; color: rgba(255,255,255,0.8); font-weight: 300; margin-bottom: 60px; line-height: 1.5; }
.cover .divider-line { width: 80px; height: 2px; background: var(--blue); margin: 0 auto 40px; }
.cover .meta { font-size: 0.95rem; color: rgba(255,255,255,0.6); line-height: 2; }
.cover .confidential { position: absolute; bottom: 40px; left: 0; right: 0; text-align: center; font-size: 0.8rem; letter-spacing: 0.15em; text-transform: uppercase; color: rgba(255,255,255,0.35); }
.page-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 56px; border-bottom: 2px solid var(--navy); font-size: 0.78rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.08em; }
.page-header .logo-text { font-weight: 700; color: var(--navy); letter-spacing: 0.15em; }
.content { padding: 48px 56px; max-width: 900px; margin: 0 auto; }
h1 { font-size: 2.4rem; color: var(--navy); font-weight: 700; letter-spacing: -0.02em; line-height: 1.2; margin: 36px 0 16px; }
h2 { font-size: 1.6rem; color: var(--navy); font-weight: 700; letter-spacing: -0.01em; line-height: 1.3; margin: 32px 0 14px; border-bottom: 2px solid var(--blue); padding-bottom: 8px; }
h3 { font-size: 1.2rem; color: var(--navy); font-weight: 600; line-height: 1.3; margin: 24px 0 10px; }
h4 { font-size: 1.05rem; color: var(--navy); font-weight: 600; margin: 18px 0 8px; }
p { margin-bottom: 14px; line-height: 1.7; }
strong { color: var(--navy); }
ul, ol { margin-bottom: 16px; padding-left: 0; list-style: none; }
ul li, ol li { padding: 6px 0 6px 26px; position: relative; line-height: 1.6; }
ul li::before { content: '\25B6'; position: absolute; left: 0; color: var(--blue); font-size: 0.55rem; top: 12px; }
ol { counter-reset: item; }
ol li { counter-increment: item; }
ol li::before { content: counter(item); position: absolute; left: 0; width: 22px; height: 22px; background: var(--navy); color: #fff; border-radius: 50%; font-size: 0.7rem; font-weight: 700; display: flex; align-items: center; justify-content: center; top: 8px; }
table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.92rem; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
thead th { background: var(--navy); color: white; padding: 12px 16px; text-align: left; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.04em; border: 1px solid #15304D; }
tbody td { padding: 11px 16px; border: 1px solid var(--border); vertical-align: top; line-height: 1.5; }
tbody tr:nth-child(even) { background: #F8F9FA; }
tbody tr:hover { background: #EBF3FB; }
blockquote { border-left: 4px solid var(--blue); background: #EBF3FB; padding: 20px 24px; border-radius: 0 8px 8px 0; margin: 20px 0; }
blockquote p:last-child { margin-bottom: 0; }
code { background: rgba(45,125,210,0.08); padding: 2px 7px; border-radius: 4px; font-size: 0.88rem; color: var(--blue); font-weight: 500; }
pre { background: #1b2e4a; color: #e2e8f0; padding: 20px 24px; border-radius: 10px; overflow-x: auto; margin: 20px 0; box-shadow: 0 4px 12px rgba(26,43,74,0.12); }
pre code { background: none; padding: 0; color: #e2e8f0; font-size: 0.85rem; }
hr { border: none; height: 2px; background: linear-gradient(90deg, var(--blue), transparent); margin: 32px 0; }
a { color: var(--blue); text-decoration: none; font-weight: 500; }
a:hover { text-decoration: underline; }
img { max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin: 16px 0; }
.back-link { position: fixed; top: 16px; right: 20px; z-index: 100; background: var(--navy); color: white; padding: 8px 18px; border-radius: 6px; font-size: 0.82rem; font-weight: 600; text-decoration: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: background 0.15s; }
.back-link:hover { background: #264E7A; text-decoration: none; color: white; }
</style>
</head>
<body>
<a class="back-link no-print" href="../..">&#8592; Dashboard</a>
<div class="cover">
  <div class="cover-content">
    <div class="brand-mark">CremoLogix</div>
    <h1>Fne Specification</h1>
    <div class="subtitle">AI-assisted underwriting platform for CDFIs — automates financial analysis while maintaining full human control over credit decisions</div>
    <div class="divider-line"></div>
    <div class="meta">February 13, 2026<br>Crucible Product Development Pipeline</div>
  </div>
  <div class="confidential">Confidential</div>
</div>
<div class="page-header no-print">
  <span class="logo-text">CremoLogix</span>
  <span>Fne Specification</span>
</div>
<div class="content" id="content"></div>
<script>
  const md = "# Financial Normalization Engine (FNE) -- Specification Addendum\n\n**Document Type:** Specification Addendum\n**Parent Document:** `C:/projects/pmo/cremologix/docs/specification.md`\n**Status:** Implementation-Ready\n**Date:** February 9, 2026\n**Gap Addressed:** Discovery Document Gap 1 (Section 6, Recommendation 1)\n\n---\n\n## Table of Contents\n\n1. [Purpose](#1-purpose)\n2. [Input Sources](#2-input-sources)\n3. [Entity Type Handling](#3-entity-type-handling)\n4. [Standardized Output Buckets](#4-standardized-output-buckets)\n5. [Cross-Validation Rules](#5-cross-validation-rules)\n6. [Confidence Scoring](#6-confidence-scoring)\n7. [Entity-Specific Normalization Rules](#7-entity-specific-normalization-rules)\n8. [Multi-Period Handling](#8-multi-period-handling)\n9. [Global Cash Flow (Personal + Business Combined)](#9-global-cash-flow-personal--business-combined)\n10. [Database Schema](#10-database-schema)\n11. [API Endpoints](#11-api-endpoints)\n12. [Phasing](#12-phasing)\n13. [Acceptance Criteria](#13-acceptance-criteria)\n\n---\n\n## 1. Purpose\n\nThe Financial Normalization Engine (FNE) is the core analytical component of CremoLogix responsible for transforming raw financial data from diverse sources and entity types into a standardized format that enables apples-to-apples comparison regardless of how the borrower's business is structured.\n\n### Problem Statement\n\nSmall businesses present financial data in radically different formats depending on their entity type. A sole proprietor reports business income on Schedule C of their personal Form 1040. An S-Corp reports on Form 1120-S with officer compensation on a separate line. A nonprofit reports on Form 990 with entirely different terminology. A CDFI underwriter must mentally normalize all of these into comparable metrics -- a process that is slow, error-prone, and inconsistent across underwriters.\n\n### What the FNE Does\n\n1. **Ingests** extracted financial data from multiple document types (tax returns, financial statements, bank statements, accounting software exports, Plaid data).\n2. **Maps** source-specific line items to standardized buckets using entity-type-aware rules.\n3. **Applies add-backs** to arrive at Adjusted Cash Flow -- the key number for debt service coverage ratio (DSCR) calculation.\n4. **Cross-validates** data across sources to identify discrepancies and assign confidence scores.\n5. **Outputs** a normalized financial profile that feeds directly into the Financial Analysis Engine (specification.md Section 5.2), the Scoring Engine (Section 5.7), and the Credit Memo Assembly Engine (Section 5.6).\n\n### Position in the Pipeline\n\n```\n[Document Upload] -> [OCR/Extraction Pipeline (spec 5.1)] -> [Extraction Results]\n                                                                     |\n                                                                     v\n                                                          +---------------------+\n                                                          | FINANCIAL           |\n                                                          | NORMALIZATION       |\n                                                          | ENGINE (this spec)  |\n                                                          +---------------------+\n                                                                     |\n                                                                     v\n                                                          [Normalized Financials]\n                                                                     |\n                                          +-------------+------------+------------+\n                                          |             |                         |\n                                          v             v                         v\n                                   [Financial    [Scoring Engine     [Credit Memo Assembly\n                                    Analysis      (spec 5.7)]         (spec 5.6)]\n                                    Engine\n                                    (spec 5.2)]\n```\n\n### Design Principles\n\n- **Entity-agnostic output:** The normalized output format is identical regardless of whether the borrower is a sole proprietor or a C-Corp. Downstream consumers never need to know the entity type.\n- **Transparent mappings:** Every normalized value traces back to a specific source field, source document, and mapping rule. The underwriter can see exactly how each number was derived.\n- **Conservative add-backs:** Add-backs default to the most conservative interpretation. The underwriter can override with justification.\n- **Source hierarchy:** When the same data point exists in multiple sources, the FNE uses the most reliable source (tax return > audited financials > compiled financials > internal financials > bank statements > manual entry).\n\n---\n\n## 2. Input Sources\n\nThe FNE accepts extracted data from the following source types. Each source feeds into the normalization pipeline through the Extraction Results table (specification.md Section 3.9) with `extraction_type` and `structured_data_jsonb` fields.\n\n### 2.1 Business Tax Returns\n\n| Form | Entity Type | Key Data Extracted |\n|------|------------|-------------------|\n| **Form 1120** | C-Corporation | Gross receipts, COGS, officer compensation, salaries/wages, rents, taxes, interest, depreciation, depletion, advertising, pension plans, employee benefits, other deductions, taxable income, tax paid, net income |\n| **Form 1120-S** | S-Corporation | Gross receipts, COGS, officer compensation, salaries/wages, rents, taxes, interest, depreciation, advertising, pension plans, employee benefits, other deductions, ordinary business income, Schedule K items (distributions, separately stated income/deductions) |\n| **Form 1065** | Partnership | Gross receipts, COGS, guaranteed payments, salaries/wages, rents, taxes, interest, depreciation, other deductions, ordinary business income, Schedule K items, partner capital accounts |\n| **Schedule C (Form 1040)** | Sole Proprietorship | Gross receipts, COGS, advertising, car/truck expenses, commissions, contract labor, depreciation, insurance, interest, legal/professional, office expense, rent, repairs, supplies, taxes, travel, meals, utilities, wages, other expenses, net profit |\n| **Form 990** | Nonprofit | Total revenue (contributions + program service + investment + other), total expenses by functional classification (program, management, fundraising), salaries/compensation, professional fees, occupancy, depreciation, net assets |\n\n### 2.2 Personal Tax Returns\n\n| Form | Purpose | Key Data Extracted |\n|------|---------|-------------------|\n| **Form 1040** | Guarantor income and obligations | Wages (W-2), business income (Schedule C), rental income (Schedule E), interest/dividends (Schedule B), capital gains (Schedule D), total income, AGI, tax liability |\n| **Schedule E** | Rental and pass-through income | Rental income/loss per property, partnership/S-Corp income (K-1 summary), estate/trust income |\n| **Schedule K-1 (1065)** | Partnership pass-through | Ordinary income, guaranteed payments, rental income, interest, dividends, capital gains, Section 179, distributions |\n| **Schedule K-1 (1120-S)** | S-Corp pass-through | Ordinary income, rental income, interest, dividends, capital gains, Section 179, distributions |\n\n### 2.3 Internal Financial Statements\n\n| Statement | Key Data Extracted |\n|-----------|-------------------|\n| **Profit & Loss (Income Statement)** | Revenue by line, COGS by line, operating expense detail, other income/expense, net income. Statement type classified as: audited, reviewed, compiled, or internal/unaudited. |\n| **Balance Sheet** | All asset, liability, and equity line items. Current vs. long-term classification. |\n| **Cash Flow Statement** | Operating, investing, and financing cash flows. Beginning and ending cash balances. |\n\n### 2.4 Bank Statements\n\n| Source | Key Data Extracted |\n|--------|-------------------|\n| **Bank Statements (3-12 months)** | Monthly beginning/ending balances, total deposits, total withdrawals, average daily balance, overdraft occurrences, NSF count, large deposit detail (>$5,000), recurring payment identification |\n\n### 2.5 Accounting Software Data\n\n| Source | Key Data Extracted |\n|--------|-------------------|\n| **QuickBooks / Xero (via Plaid or direct export)** | Chart of accounts with balances, trial balance, P&L detail, balance sheet detail, general ledger transactions, accounts receivable aging, accounts payable aging |\n\n### 2.6 Plaid Transaction Data\n\n| Source | Key Data Extracted |\n|--------|-------------------|\n| **Plaid Transactions API** | Categorized transactions (income, expenses by category), recurring revenue identification, recurring expense identification, cash flow patterns, seasonal trends |\n\n### 2.7 Supplementary Documents\n\n| Document | Key Data Extracted |\n|----------|-------------------|\n| **AR Aging Report** | Current, 30-day, 60-day, 90-day, 90+ day buckets. Total AR. Concentration by customer. |\n| **AP Aging Report** | Current, 30-day, 60-day, 90-day, 90+ day buckets. Total AP. |\n| **Debt Schedule** | Creditor name, original amount, current balance, monthly payment, interest rate, maturity date, collateral, payment status (current/delinquent). |\n| **Personal Financial Statement (PFS)** | Personal assets, personal liabilities, personal income sources, personal expense obligations. |\n\n---\n\n## 3. Entity Type Handling\n\nThe FNE must handle six entity types. Each has a different primary tax form, different treatment of owner compensation, and different rules for separating personal from business financials.\n\n### 3.1 Sole Proprietor\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Schedule C (filed with Form 1040) |\n| **Owner Compensation Treatment** | No salary line on Schedule C. Net profit (Line 31) IS the owner's compensation. The entire net profit is an add-back for DSCR because the owner must live on this money AND service debt. Owner's reasonable compensation must be estimated and subtracted from the add-back. **Formula:** `Add-Back for Owner Comp = Schedule C Net Profit - Estimated Owner Living Expenses`. In practice, use the personal debt obligations from the PFS or 1040 as the proxy for living expenses -- this flows through Global Cash Flow (Section 9). |\n| **Pass-Through Income** | All business income flows directly to Form 1040 Line 8. There is no separate entity-level tax. |\n| **Personal vs. Business Separation** | Schedule C IS the business. All other 1040 income (W-2, Schedule E, etc.) is personal. Business expenses on Schedule C are the only business expenses. Mixed-use assets (home office, vehicle) require allocation -- use the percentages reported on Schedule C. |\n| **Key Add-Backs** | Depreciation (Line 13), depletion (Line 12), amortization (included in \"Other Expenses\"), one-time/non-recurring expenses (identified by underwriter or AI), home office deduction (Form 8829 -- add back if the borrower owns the home), owner's personal expenses run through the business (identified via bank statement cross-validation). |\n\n### 3.2 LLC (Limited Liability Company)\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Depends on LLC election: Single-member LLC files Schedule C (treat as Sole Proprietor). Multi-member LLC defaults to Form 1065 (treat as Partnership). LLC electing S-Corp status files Form 1120-S (treat as S-Corp). LLC electing C-Corp status files Form 1120 (treat as C-Corp). |\n| **Owner Compensation Treatment** | Follows the treatment of the tax election. Single-member: same as Sole Proprietor. Multi-member/Partnership: guaranteed payments + distributions. S-Corp election: officer salary + distributions. C-Corp election: officer salary + dividends. |\n| **Pass-Through Income** | Single-member: flows to 1040 Schedule C. Multi-member: flows to partners via K-1. S-Corp election: flows to shareholders via K-1. C-Corp election: no pass-through (entity-level tax). |\n| **Personal vs. Business Separation** | Same as the elected entity type. The FNE determines the LLC's tax election from the tax form filed and routes to the appropriate normalization rules. |\n| **Key Add-Backs** | Same as the elected entity type. Additionally, for multi-member LLCs, all member guaranteed payments and distributions are add-backs (same as Partnership). |\n| **Detection Logic** | The FNE detects LLC tax election by examining: (a) the `business_type` field on the application, (b) which tax form was uploaded/extracted, (c) if the application says \"LLC\" but a Schedule C was filed, classify as single-member LLC (Sole Proprietor treatment). |\n\n### 3.3 S-Corporation\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Form 1120-S (U.S. Income Tax Return for an S Corporation) |\n| **Owner Compensation Treatment** | Officer compensation (Line 7) is a W-2 salary paid to the owner(s). This is already deducted as a business expense on the 1120-S. For DSCR purposes, officer compensation is added back because it represents discretionary owner pay that could be redirected to debt service. **Additionally:** Shareholder distributions (Schedule K, Line 16d or from Schedule M-2) are NOT on the income statement but represent cash taken out by owners. Distributions are added to Adjusted Cash Flow. **Formula:** `Owner Comp Add-Back = Line 7 (Officer Compensation) + Distributions to Shareholders` |\n| **Pass-Through Income** | Ordinary business income (Line 21) flows to shareholders via Schedule K-1. Each shareholder reports their pro-rata share on personal Form 1040 Schedule E. The entity itself pays no federal income tax (with limited exceptions). |\n| **Personal vs. Business Separation** | The 1120-S is entirely business. Personal income is on the guarantor's Form 1040. K-1 income from the S-Corp appears on the guarantor's Schedule E -- this is the same income already captured on the 1120-S, so the FNE must NOT double-count it when computing Global Cash Flow. |\n| **Key Add-Backs** | Officer compensation (Line 7), depreciation (Line 14), amortization (if in Other Deductions), charitable contributions (Line 12a of Schedule K -- these are passed through to shareholders, not deducted at entity level, but appear in some internal P&Ls), one-time expenses, above-market rent paid to related parties (identified by comparing rent to market rates or flagged by underwriter). |\n\n### 3.4 C-Corporation\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Form 1120 (U.S. Corporation Income Tax Return) |\n| **Owner Compensation Treatment** | Officer compensation (Line 12) is a W-2 salary. Unlike S-Corps, C-Corps pay entity-level income tax (Line 31), so retained earnings stay in the corporation. Dividends paid to shareholders are NOT deductible by the corporation and come from after-tax profits. **For DSCR:** Add back officer compensation. Do NOT add back dividends (they are after-tax and already accounted for in net income). **Formula:** `Owner Comp Add-Back = Line 12 (Compensation of Officers)`. Note: if the C-Corp pays minimal officer salary and instead pays large \"management fees\" to a related entity, the FNE flags this for underwriter review. |\n| **Pass-Through Income** | None. C-Corps are taxed at the entity level. Shareholders only receive income via W-2 salary or dividends. This is the \"double taxation\" structure. |\n| **Personal vs. Business Separation** | Clean separation. The 1120 is entirely business. The owner's W-2 and dividends appear on their personal 1040. No K-1 overlap. |\n| **Key Add-Backs** | Officer compensation (Line 12), depreciation (Line 20), amortization (Line 26 or in Other Deductions), depletion (Line 21), federal income tax paid (Line 31 -- this is an add-back because it is a non-cash charge for DSCR purposes in the sense that it would not exist if the business were structured as a pass-through), charitable contributions (Line 19), one-time/non-recurring expenses, above-market related-party rent. |\n\n### 3.5 Partnership\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Form 1065 (U.S. Return of Partnership Income) |\n| **Owner Compensation Treatment** | Partners do NOT receive W-2 salaries. Instead, they receive: (a) Guaranteed payments (Line 10) -- fixed payments to partners regardless of profit, functionally equivalent to salary. (b) Distributions (Schedule K, Line 19a or from capital account analysis). (c) Pro-rata share of ordinary income. **For DSCR:** Add back guaranteed payments to all partners. Add back distributions. **Formula:** `Owner Comp Add-Back = Line 10 (Guaranteed Payments) + Distributions to Partners` |\n| **Pass-Through Income** | All income flows through to partners via Schedule K-1. The partnership pays no entity-level tax. Each partner reports their share on personal Form 1040 Schedule E. |\n| **Personal vs. Business Separation** | The 1065 is entirely business. Each partner's K-1 income appears on their personal 1040 Schedule E. Same double-count risk as S-Corp -- the FNE must not count K-1 income from THIS business in both the business and personal cash flows. |\n| **Key Add-Backs** | Guaranteed payments (Line 10), depreciation (Line 16a), amortization (if in Other Deductions), Section 179 expense (Line 14 of Schedule K), partner distributions, one-time expenses, above-market related-party transactions. |\n\n### 3.6 Nonprofit\n\n| Attribute | Detail |\n|-----------|--------|\n| **Primary Tax Form** | Form 990 (Return of Organization Exempt From Income Tax). Small nonprofits may file 990-EZ or 990-N (e-Postcard). |\n| **Owner Compensation Treatment** | Nonprofits have no owners. Key personnel compensation (Part VII of Form 990) lists officers, directors, and highest-compensated employees. The Executive Director/CEO salary is the functional equivalent of \"owner compensation\" for analysis purposes. **For DSCR:** Do NOT add back ED/CEO compensation unless the position is vacant or the incumbent is the loan guarantor (rare for nonprofits). Instead, focus on total program revenue vs. total expenses to determine operating surplus. |\n| **Pass-Through Income** | Not applicable. Nonprofits do not distribute income. |\n| **Personal vs. Business Separation** | Nonprofits are separate legal entities. If a personal guarantor is required (unusual for nonprofits, common for CDFI loans to small nonprofits), their personal financials are entirely separate from the 990. |\n| **Key Add-Backs** | Depreciation (Part IX, Line 22 or from the financial statements -- Form 990 does not always break out depreciation as a separate line), amortization, one-time capital campaign expenses (if material), in-kind expense offsets (donated goods/services recorded as both revenue and expense -- normalize by removing both sides), non-cash grants/contributions. |\n| **Special Considerations** | Revenue mix matters: program service revenue is more reliable than contributions/grants for DSCR. The FNE should flag if >50% of revenue comes from a single grant or donor (concentration risk). Functional expense allocation (program vs. management vs. fundraising) maps to operating expense categories but requires special handling. Net assets (unrestricted, temporarily restricted, permanently restricted -- or under ASC 958: without donor restrictions, with donor restrictions) replace equity on the balance sheet. |\n\n---\n\n## 4. Standardized Output Buckets\n\nAll entity types normalize into the following identical output structure. Every downstream consumer (Financial Analysis Engine, Scoring Engine, Credit Memo Assembly) reads from these buckets without knowing or caring about the entity type.\n\n### 4.1 Income Statement Normalization\n\n| Bucket | Code | Description | Computation |\n|--------|------|-------------|-------------|\n| **Gross Revenue** | `IS_GROSS_REVENUE` | Total top-line revenue before any deductions | Direct mapping from source |\n| **Cost of Goods Sold / Cost of Services** | `IS_COGS` | Direct costs of producing goods or delivering services | Direct mapping; for service businesses this may be zero |\n| **Gross Profit** | `IS_GROSS_PROFIT` | Revenue minus direct costs | `IS_GROSS_REVENUE - IS_COGS` |\n| **Operating Expenses: Payroll** | `IS_OPEX_PAYROLL` | Employee wages, salaries, payroll taxes, benefits. Excludes owner compensation (tracked separately). | Sum of wages, salaries, payroll tax, benefits lines. Owner/officer comp is separated out. |\n| **Operating Expenses: Rent/Occupancy** | `IS_OPEX_RENT` | Rent, lease payments, property taxes on business premises, utilities, maintenance | Sum of rent + utilities + property maintenance lines |\n| **Operating Expenses: Marketing** | `IS_OPEX_MARKETING` | Advertising, marketing, promotion, sponsorships | Direct mapping |\n| **Operating Expenses: Insurance** | `IS_OPEX_INSURANCE` | Business insurance premiums (property, liability, workers comp, E&O) | Direct mapping |\n| **Operating Expenses: Professional Services** | `IS_OPEX_PROFESSIONAL` | Legal, accounting, consulting, IT services | Direct mapping |\n| **Operating Expenses: Depreciation** | `IS_OPEX_DEPRECIATION` | Depreciation of tangible fixed assets | Direct mapping |\n| **Operating Expenses: Amortization** | `IS_OPEX_AMORTIZATION` | Amortization of intangible assets, startup costs, loan fees | Direct mapping; often embedded in \"Other Deductions\" on tax returns |\n| **Operating Expenses: Other Operating** | `IS_OPEX_OTHER` | All operating expenses not categorized above | Catch-all for remaining operating expenses |\n| **Total Operating Expenses** | `IS_TOTAL_OPEX` | Sum of all operating expense categories | `SUM(IS_OPEX_*)` |\n| **Owner Compensation (memo line)** | `IS_OWNER_COMP` | Total compensation to owners/officers including salary, guaranteed payments. This is a memo line -- it is included in Total Operating Expenses where applicable but tracked separately for add-back purposes. | Entity-specific mapping (see Section 7) |\n| **Net Operating Income (NOI)** | `IS_NOI` | Operating profit before non-operating items | `IS_GROSS_PROFIT - IS_TOTAL_OPEX` |\n| **Non-Operating Income** | `IS_NON_OP_INCOME` | Interest income, investment income, gain on sale of assets, other non-operating income | Direct mapping |\n| **Non-Operating Expenses** | `IS_NON_OP_EXPENSE` | Interest expense, loss on sale of assets, other non-operating expenses | Direct mapping |\n| **Net Income (As Reported)** | `IS_NET_INCOME` | Bottom-line net income as reported on the tax return or financial statement | Direct mapping from source. This is the starting point for add-backs. |\n| **Add-Back: Owner Compensation** | `AB_OWNER_COMP` | Owner/officer salary, guaranteed payments, and/or draws added back for DSCR | Entity-specific (see Section 7) |\n| **Add-Back: Depreciation** | `AB_DEPRECIATION` | Non-cash depreciation expense | Same as `IS_OPEX_DEPRECIATION` |\n| **Add-Back: Amortization** | `AB_AMORTIZATION` | Non-cash amortization expense | Same as `IS_OPEX_AMORTIZATION` |\n| **Add-Back: One-Time Items** | `AB_ONE_TIME` | Non-recurring expenses identified by underwriter or AI. Examples: lawsuit settlement, relocation costs, one-time equipment write-off. | Underwriter-identified with AI suggestions. Each item must have a description and justification. |\n| **Add-Back: Related-Party Rent Adjustment** | `AB_RELATED_RENT` | If rent is paid to a related party above or below market rate, the difference is adjusted. Example: owner rents building to their own business at $3,000/mo when market rate is $2,000/mo. Add back $12,000/yr. | `(Reported Rent - Market Rate Rent) * 12`. Requires underwriter input for market rate. |\n| **Add-Back: Federal Income Tax (C-Corp only)** | `AB_FIT` | Federal income tax is added back for C-Corps because pass-through entities do not pay entity-level tax. This normalizes C-Corp cash flow to be comparable with pass-through entities. | Form 1120 Line 31. Zero for all non-C-Corp entities. |\n| **Total Add-Backs** | `AB_TOTAL` | Sum of all add-backs | `SUM(AB_*)` |\n| **Adjusted Cash Flow** | `IS_ADJUSTED_CF` | The key number for DSCR. Represents the cash available to service debt after normalizing for entity type differences. | `IS_NET_INCOME + AB_TOTAL` |\n\n**DSCR Formula:**\n```\nDSCR = Adjusted Cash Flow / Annual Debt Service\n\nWhere:\n  Annual Debt Service = Sum of all annual P&I payments on existing debt\n                      + Annual P&I on the proposed new loan\n```\n\n### 4.2 Balance Sheet Normalization\n\n| Bucket | Code | Description |\n|--------|------|-------------|\n| **Cash & Cash Equivalents** | `BS_CASH` | Cash, checking, savings, money market, CDs < 90 days |\n| **Accounts Receivable** | `BS_AR` | Trade receivables net of allowance for doubtful accounts |\n| **Inventory** | `BS_INVENTORY` | Raw materials, WIP, finished goods |\n| **Other Current Assets** | `BS_OTHER_CURRENT_ASSETS` | Prepaid expenses, short-term notes receivable, other assets due within 12 months |\n| **Total Current Assets** | `BS_TOTAL_CURRENT` | `BS_CASH + BS_AR + BS_INVENTORY + BS_OTHER_CURRENT_ASSETS` |\n| **Property, Plant & Equipment (Net)** | `BS_PPE_NET` | PP&E net of accumulated depreciation |\n| **Real Estate** | `BS_REAL_ESTATE` | Real property owned, net of depreciation. Separated from PP&E for collateral analysis. |\n| **Intangible Assets** | `BS_INTANGIBLES` | Goodwill, patents, trademarks, franchise rights, net of amortization |\n| **Other Long-Term Assets** | `BS_OTHER_LT_ASSETS` | Long-term investments, notes receivable > 12 months, other |\n| **Total Assets** | `BS_TOTAL_ASSETS` | `BS_TOTAL_CURRENT + BS_PPE_NET + BS_REAL_ESTATE + BS_INTANGIBLES + BS_OTHER_LT_ASSETS` |\n| **Accounts Payable** | `BS_AP` | Trade payables |\n| **Current Portion of Long-Term Debt** | `BS_CPLTD` | Principal payments due within 12 months on long-term obligations |\n| **Accrued Expenses** | `BS_ACCRUED` | Accrued wages, taxes, interest, other |\n| **Other Current Liabilities** | `BS_OTHER_CURRENT_LIAB` | Short-term notes, lines of credit drawn, other current obligations |\n| **Total Current Liabilities** | `BS_TOTAL_CURRENT_LIAB` | `BS_AP + BS_CPLTD + BS_ACCRUED + BS_OTHER_CURRENT_LIAB` |\n| **Notes Payable (Long-Term)** | `BS_NOTES_LT` | Term loans, equipment financing, other notes with maturity > 12 months |\n| **Mortgages** | `BS_MORTGAGES` | Real estate secured long-term debt |\n| **Other Long-Term Liabilities** | `BS_OTHER_LT_LIAB` | Deferred revenue (long-term), capital lease obligations, other |\n| **Total Liabilities** | `BS_TOTAL_LIABILITIES` | `BS_TOTAL_CURRENT_LIAB + BS_NOTES_LT + BS_MORTGAGES + BS_OTHER_LT_LIAB` |\n| **Equity / Net Assets** | `BS_EQUITY` | For for-profit entities: paid-in capital + retained earnings + current year net income. For nonprofits: net assets without donor restrictions + net assets with donor restrictions. |\n| **Total Liabilities & Equity** | `BS_TOTAL_LIAB_EQUITY` | `BS_TOTAL_LIABILITIES + BS_EQUITY`. Must equal `BS_TOTAL_ASSETS`. |\n\n### 4.3 Cash Flow Normalization\n\n| Bucket | Code | Description |\n|--------|------|-------------|\n| **Operating Cash Flow** | `CF_OPERATING` | Cash from core business operations. If a formal cash flow statement is provided, use it. If not, compute from income statement + balance sheet changes using the indirect method. |\n| **Investing Cash Flow** | `CF_INVESTING` | Cash used for capital expenditures, asset purchases/sales, investment activity |\n| **Financing Cash Flow** | `CF_FINANCING` | Cash from/to debt (borrowing/repayment), equity (contributions/distributions), dividends |\n| **Net Change in Cash** | `CF_NET_CHANGE` | `CF_OPERATING + CF_INVESTING + CF_FINANCING` |\n| **Free Cash Flow** | `CF_FREE` | `CF_OPERATING - Capital Expenditures (from CF_INVESTING)` |\n\n**Indirect Method Computation (when no cash flow statement is provided):**\n```\nCF_OPERATING = Net Income\n             + Depreciation & Amortization\n             - Increase in Accounts Receivable (or + Decrease)\n             - Increase in Inventory (or + Decrease)\n             + Increase in Accounts Payable (or - Decrease)\n             + Increase in Accrued Expenses (or - Decrease)\n             +/- Other non-cash adjustments\n\nCF_INVESTING = - Capital Expenditures\n               + Proceeds from Asset Sales\n               +/- Other investing activities\n\nCF_FINANCING = + New Borrowings\n               - Debt Repayments\n               + Capital Contributions\n               - Distributions/Dividends\n               +/- Other financing activities\n```\n\n---\n\n## 5. Cross-Validation Rules\n\nThe FNE cross-validates data across sources to identify discrepancies. Each rule produces a validation result with a status of `pass`, `warning`, or `fail`, a computed variance, and a confidence impact.\n\n### 5.1 Validation Rule Definitions\n\n| Rule ID | Rule Name | Comparison | Tolerance | Status Logic | Confidence Impact on Fail |\n|---------|-----------|-----------|-----------|-------------|--------------------------|\n| `XV-001` | **Tax vs. Financial Statement Net Income** | Tax return net income vs. P&L net income for the same fiscal year | 5% of the larger absolute value | Pass: within 5%. Warning: 5-15%. Fail: >15%. | -0.20 on affected income fields |\n| `XV-002` | **Bank Deposits vs. Reported Revenue** | Sum of bank statement deposits (excluding transfers, loan proceeds, owner contributions) vs. tax return / P&L gross revenue | 15% of reported revenue | Pass: within 15%. Warning: 15-25%. Fail: >25%. | -0.15 on `IS_GROSS_REVENUE` |\n| `XV-003` | **Tax Depreciation vs. Balance Sheet** | Accumulated depreciation change on balance sheet vs. depreciation expense on tax return | 10% | Pass: within 10%. Warning: 10-20%. Fail: >20%. | -0.10 on `IS_OPEX_DEPRECIATION` and `BS_PPE_NET` |\n| `XV-004` | **AR Aging vs. Balance Sheet AR** | AR aging report total vs. balance sheet accounts receivable | 5% | Pass: within 5%. Warning: 5-10%. Fail: >10%. | -0.15 on `BS_AR` |\n| `XV-005` | **Debt Schedule vs. Balance Sheet Liabilities** | Sum of debt schedule balances vs. total liabilities (excluding AP, accrued) | 10% | Pass: within 10%. Warning: 10-20%. Fail: >20%. | -0.15 on all liability buckets |\n| `XV-006` | **Plaid Categories vs. Reported Expenses** | Plaid-categorized expenses by category vs. reported expense categories | 20% per category | Pass: within 20%. Warning: 20-35%. Fail: >35% for 3+ categories. | -0.10 per failing category |\n| `XV-007` | **Balance Sheet Balances** | Total Assets must equal Total Liabilities + Equity | 0.1% (rounding only) | Pass: balanced. Fail: unbalanced. | -0.30 on all balance sheet fields |\n| `XV-008` | **YoY Revenue Reasonableness** | Year-over-year revenue change | 50% swing in either direction | Pass: within 50%. Warning: >50% (flag for explanation). | -0.05 (informational) |\n| `XV-009` | **Bank Balance vs. Balance Sheet Cash** | Average month-end bank balance vs. balance sheet cash for period end | 20% | Pass: within 20%. Warning: 20-40%. Fail: >40%. | -0.10 on `BS_CASH` |\n| `XV-010` | **K-1 Income vs. 1120-S/1065 Income** | Sum of all K-1 ordinary income vs. entity return ordinary income | 1% (should match exactly, tolerance for rounding) | Pass: within 1%. Fail: >1%. | -0.25 on pass-through income fields |\n\n### 5.2 Validation Execution\n\nCross-validation runs automatically after normalization completes. Results are stored in the `normalization_audit` table (see Section 10). The underwriter sees a validation summary with:\n\n- Number of rules evaluated\n- Number passed / warned / failed\n- Specific discrepancies with source values and computed variance\n- Suggested resolution (e.g., \"Bank deposits exceed reported revenue by 22%. This may indicate unreported income, loan proceeds coded as deposits, or inter-account transfers. Request clarification.\")\n\n### 5.3 Tolerance Calculation\n\nAll tolerances are computed as:\n```\nVariance = |Value_A - Value_B| / MAX(|Value_A|, |Value_B|)\n\nIf both values are zero, the rule passes automatically.\nIf one value is zero and the other is not, the rule fails automatically.\n```\n\n---\n\n## 6. Confidence Scoring\n\nThe FNE assigns confidence scores at three levels: per-field, per-section (cross-validation), and overall.\n\n### 6.1 Source Reliability Hierarchy\n\nEach data source has a base confidence weight:\n\n| Source Type | Base Confidence | Rationale |\n|-------------|----------------|-----------|\n| Tax Return (IRS transcript) | 0.98 | IRS-verified, highest reliability |\n| Tax Return (borrower-provided copy) | 0.92 | Could be altered, but penalties for falsification are severe |\n| Audited Financial Statements | 0.95 | CPA-attested, GAAP-compliant |\n| Reviewed Financial Statements | 0.88 | CPA-reviewed but not fully audited |\n| Compiled Financial Statements | 0.80 | CPA-compiled from management data, no assurance |\n| Internal / Unaudited Financial Statements | 0.70 | Management-prepared, no external validation |\n| Bank Statements (direct from bank) | 0.95 | Institution-sourced, reliable for cash data |\n| Bank Statements (borrower-provided PDF) | 0.85 | Could be altered |\n| Plaid-connected bank data | 0.93 | API-sourced, reliable |\n| QuickBooks / Accounting Software (Plaid-connected) | 0.85 | System-of-record but borrower-maintained |\n| QuickBooks / Accounting Software (exported file) | 0.75 | Could be modified before export |\n| AR/AP Aging (from accounting software) | 0.80 | System-generated but borrower-maintained |\n| AR/AP Aging (manual/PDF) | 0.65 | Borrower-prepared, limited verification |\n| Debt Schedule (manual) | 0.60 | Borrower-prepared, should cross-validate against credit report |\n| Manual Entry (underwriter) | 0.50 | No source document; requires justification |\n\n### 6.2 Per-Field Confidence Calculation\n\nEach normalized field's confidence is computed as:\n\n```\nField_Confidence = Source_Base_Confidence\n                 * OCR_Confidence_Factor\n                 * Cross_Validation_Factor\n                 * Extraction_Confidence_Factor\n\nWhere:\n  OCR_Confidence_Factor = OCR confidence for the specific field region (from extraction pipeline)\n                          Range: 0.50 - 1.00\n                          If source is digital (not OCR), factor = 1.00\n\n  Cross_Validation_Factor = 1.00 if no cross-validation rule applies or all rules pass\n                          = 0.90 if warning-level discrepancy\n                          = 0.70 if fail-level discrepancy\n\n  Extraction_Confidence_Factor = Extraction model's confidence for this specific field\n                                 Range: 0.50 - 1.00\n                                 From extraction_results.field_confidences_jsonb\n```\n\n### 6.3 Cross-Validation Confidence\n\nMeasures how well multiple sources agree:\n\n```\nCross_Validation_Confidence = (Number of Rules Passed + 0.5 * Number of Warnings)\n                            / Total Rules Evaluated\n\nRange: 0.00 - 1.00\n```\n\n### 6.4 Overall Extraction Confidence\n\nThe overall confidence for a normalized financial period:\n\n```\nOverall_Confidence = WEIGHTED_AVERAGE(All Field Confidences)\n\nWhere weights are:\n  IS_GROSS_REVENUE:    weight 3 (high importance)\n  IS_NET_INCOME:       weight 3\n  IS_ADJUSTED_CF:      weight 5 (highest importance -- the DSCR driver)\n  BS_TOTAL_ASSETS:     weight 2\n  BS_TOTAL_LIABILITIES: weight 2\n  All other fields:    weight 1\n```\n\n### 6.5 Confidence Thresholds and Actions\n\n| Confidence Range | Status | Action |\n|-----------------|--------|--------|\n| >= 0.90 | `auto_validated` | Field is accepted without manual review. Displayed with green indicator. |\n| 0.70 - 0.89 | `flagged_for_review` | Field is highlighted for underwriter review. Displayed with yellow indicator. Underwriter must either confirm or correct. |\n| < 0.70 | `manual_required` | Field cannot be used without manual entry or correction. Displayed with red indicator. Underwriter must provide a value and source justification. |\n\n### 6.6 Confidence Display\n\nThe underwriter UI shows:\n- A color-coded confidence indicator next to each normalized field (green/yellow/red)\n- Hover tooltip showing: source document, source field, source confidence, cross-validation status\n- A summary bar showing overall confidence percentage for the normalization\n- A list of all flagged and manual-required fields with direct links to source documents\n\n---\n\n## 7. Entity-Specific Normalization Rules\n\nThis section provides the concrete mapping from each tax form's line items to the standardized output buckets defined in Section 4. Each table shows the source field, the normalized bucket it maps to, and whether it receives add-back treatment for DSCR calculation.\n\n### 7.1 Sole Proprietor -- Schedule C (Form 1040)\n\n| Schedule C Line | Description | Normalized Bucket | Add-Back? |\n|----------------|-------------|-------------------|-----------|\n| Line 1 | Gross receipts or sales | `IS_GROSS_REVENUE` | No |\n| Line 2 | Returns and allowances | Subtracted from `IS_GROSS_REVENUE` | No |\n| Line 4 | Cost of goods sold (from Line 42) | `IS_COGS` | No |\n| Line 5 | Gross profit | `IS_GROSS_PROFIT` (verify = Line 1 - Line 2 - Line 4) | No |\n| Line 6 | Other income | `IS_NON_OP_INCOME` | No |\n| Line 8 | Advertising | `IS_OPEX_MARKETING` | No |\n| Line 9 | Car and truck expenses | `IS_OPEX_OTHER` | No |\n| Line 10 | Commissions and fees | `IS_OPEX_OTHER` | No |\n| Line 11 | Contract labor | `IS_OPEX_PAYROLL` | No |\n| Line 12 | Depletion | `IS_OPEX_OTHER` | Yes (`AB_ONE_TIME` if non-recurring) |\n| Line 13 | Depreciation and Section 179 | `IS_OPEX_DEPRECIATION` | Yes (`AB_DEPRECIATION`) |\n| Line 14 | Employee benefit programs | `IS_OPEX_PAYROLL` | No |\n| Line 15 | Insurance (other than health) | `IS_OPEX_INSURANCE` | No |\n| Line 16a | Mortgage interest (paid to banks) | `IS_NON_OP_EXPENSE` | No |\n| Line 16b | Other interest | `IS_NON_OP_EXPENSE` | No |\n| Line 17 | Legal and professional services | `IS_OPEX_PROFESSIONAL` | No |\n| Line 18 | Office expense | `IS_OPEX_OTHER` | No |\n| Line 19 | Pension and profit-sharing plans | `IS_OPEX_PAYROLL` | No |\n| Line 20a | Rent -- vehicles, machinery, equipment | `IS_OPEX_RENT` | No |\n| Line 20b | Rent -- other business property | `IS_OPEX_RENT` | No |\n| Line 21 | Repairs and maintenance | `IS_OPEX_OTHER` | No |\n| Line 22 | Supplies | `IS_OPEX_OTHER` | No |\n| Line 23 | Taxes and licenses | `IS_OPEX_OTHER` | No |\n| Line 24a | Travel | `IS_OPEX_OTHER` | No |\n| Line 24b | Deductible meals | `IS_OPEX_OTHER` | No |\n| Line 25 | Utilities | `IS_OPEX_RENT` (combined with occupancy) | No |\n| Line 26 | Wages | `IS_OPEX_PAYROLL` | No |\n| Line 27a | Other expenses (from Line 48) | `IS_OPEX_OTHER` (review for amortization) | Amortization portion: Yes (`AB_AMORTIZATION`) |\n| Line 30 | Business use of home (Form 8829) | `IS_OPEX_RENT` | Conditionally: Yes if owner owns the home (`AB_ONE_TIME`), no if renting |\n| Line 31 | Net profit or (loss) | `IS_NET_INCOME` | No (this is the starting point) |\n| *Implied* | Owner compensation = Line 31 (entire net profit) | `IS_OWNER_COMP` (memo line) | Yes (`AB_OWNER_COMP` = Line 31). See Section 9 for how personal living expenses offset this. |\n\n**Sole Proprietor Adjusted Cash Flow:**\n```\nAdjusted Cash Flow = Line 31 (Net Profit)\n                   + Line 13 (Depreciation/179)\n                   + Amortization (from Line 27a detail)\n                   + One-time items (underwriter-identified)\n                   + Related-party rent adjustment (if applicable)\n                   + Home office deduction (if owner-occupied property)\n```\n\nNote: For Sole Proprietors, the \"owner compensation add-back\" is handled differently. Since Line 31 IS the owner's income, adding it back would double-count. Instead, Line 31 is the starting point, and add-backs are only the non-cash and non-recurring items. The personal living expenses are handled in Global Cash Flow (Section 9).\n\n### 7.2 S-Corporation -- Form 1120-S\n\n| Form 1120-S Line | Description | Normalized Bucket | Add-Back? |\n|------------------|-------------|-------------------|-----------|\n| Line 1a | Gross receipts or sales | `IS_GROSS_REVENUE` | No |\n| Line 1b | Returns and allowances | Subtracted from `IS_GROSS_REVENUE` | No |\n| Line 2 | Cost of goods sold (from Schedule A) | `IS_COGS` | No |\n| Line 3 | Gross profit | `IS_GROSS_PROFIT` | No |\n| Line 4 | Net gain (loss) from Form 4797 | `IS_NON_OP_INCOME` (if gain) or `IS_NON_OP_EXPENSE` (if loss) | No |\n| Line 5 | Other income (loss) | `IS_NON_OP_INCOME` or `IS_NON_OP_EXPENSE` | No |\n| Line 7 | Compensation of officers | `IS_OPEX_PAYROLL` + `IS_OWNER_COMP` (memo) | Yes (`AB_OWNER_COMP`) |\n| Line 8 | Salaries and wages (less employment credits) | `IS_OPEX_PAYROLL` | No |\n| Line 9 | Repairs and maintenance | `IS_OPEX_OTHER` | No |\n| Line 10 | Bad debts | `IS_OPEX_OTHER` | Review for one-time add-back |\n| Line 11 | Rents | `IS_OPEX_RENT` | Review for related-party (`AB_RELATED_RENT`) |\n| Line 12 | Taxes and licenses | `IS_OPEX_OTHER` | No |\n| Line 13 | Interest | `IS_NON_OP_EXPENSE` | No |\n| Line 14 | Depreciation (from Form 4562, not on Line 8 of Sch A) | `IS_OPEX_DEPRECIATION` | Yes (`AB_DEPRECIATION`) |\n| Line 15 | Depletion | `IS_OPEX_OTHER` | No |\n| Line 16 | Advertising | `IS_OPEX_MARKETING` | No |\n| Line 17 | Pension, profit-sharing, etc. | `IS_OPEX_PAYROLL` | No |\n| Line 18 | Employee benefit programs | `IS_OPEX_PAYROLL` | No |\n| Line 19 | Other deductions (from statement) | `IS_OPEX_OTHER` (parse for insurance, professional fees, amortization) | Amortization portion: Yes (`AB_AMORTIZATION`) |\n| Line 21 | Ordinary business income (loss) | `IS_NET_INCOME` (entity-level, before shareholder allocation) | No |\n| Schedule K, Line 16d | Distributions (property and cash) | Not on income statement. Tracked as `IS_OWNER_COMP` supplemental. | Yes (added to `AB_OWNER_COMP`) |\n| Schedule M-2 | Distributions from accumulated adjustments account | Cross-reference with K Line 16d | Verification only |\n\n**S-Corp Adjusted Cash Flow:**\n```\nAdjusted Cash Flow = Line 21 (Ordinary Business Income)\n                   + Line 7 (Officer Compensation)\n                   + Line 14 (Depreciation)\n                   + Amortization (from Line 19 detail)\n                   + Distributions to Shareholders (Schedule K, Line 16d)\n                   + One-time items (underwriter-identified)\n                   + Related-party rent adjustment (if applicable)\n```\n\n### 7.3 C-Corporation -- Form 1120\n\n| Form 1120 Line | Description | Normalized Bucket | Add-Back? |\n|----------------|-------------|-------------------|-----------|\n| Line 1a | Gross receipts or sales | `IS_GROSS_REVENUE` | No |\n| Line 1b | Returns and allowances | Subtracted from `IS_GROSS_REVENUE` | No |\n| Line 2 | Cost of goods sold (from Schedule A) | `IS_COGS` | No |\n| Line 3 | Gross profit | `IS_GROSS_PROFIT` | No |\n| Line 4 | Dividends (from Schedule C) | `IS_NON_OP_INCOME` | No |\n| Line 5 | Interest | `IS_NON_OP_INCOME` | No |\n| Line 6 | Gross rents | `IS_NON_OP_INCOME` (unless core business) | No |\n| Line 7 | Gross royalties | `IS_NON_OP_INCOME` | No |\n| Line 8 | Capital gain (loss) from Schedule D | `IS_NON_OP_INCOME` or `IS_NON_OP_EXPENSE` | No |\n| Line 9 | Net gain (loss) from Form 4797 | `IS_NON_OP_INCOME` or `IS_NON_OP_EXPENSE` | No |\n| Line 10 | Other income | `IS_NON_OP_INCOME` | No |\n| Line 12 | Compensation of officers | `IS_OPEX_PAYROLL` + `IS_OWNER_COMP` (memo) | Yes (`AB_OWNER_COMP`) |\n| Line 13 | Salaries and wages | `IS_OPEX_PAYROLL` | No |\n| Line 14 | Repairs and maintenance | `IS_OPEX_OTHER` | No |\n| Line 15 | Bad debts | `IS_OPEX_OTHER` | Review for one-time |\n| Line 16 | Rents | `IS_OPEX_RENT` | Review for related-party (`AB_RELATED_RENT`) |\n| Line 17 | Taxes and licenses | `IS_OPEX_OTHER` | No |\n| Line 18 | Interest | `IS_NON_OP_EXPENSE` | No |\n| Line 19 | Charitable contributions | `IS_OPEX_OTHER` | Yes (`AB_ONE_TIME` -- discretionary) |\n| Line 20 | Depreciation (from Form 4562) | `IS_OPEX_DEPRECIATION` | Yes (`AB_DEPRECIATION`) |\n| Line 21 | Depletion | `IS_OPEX_OTHER` | No |\n| Line 22 | Advertising | `IS_OPEX_MARKETING` | No |\n| Line 23 | Pension, profit-sharing, etc. | `IS_OPEX_PAYROLL` | No |\n| Line 24 | Employee benefit programs | `IS_OPEX_PAYROLL` | No |\n| Line 26 | Other deductions (from statement) | `IS_OPEX_OTHER` (parse for insurance, professional, amortization) | Amortization portion: Yes (`AB_AMORTIZATION`) |\n| Line 28 | Taxable income before NOL | Intermediate calculation | No |\n| Line 30 | Taxable income | `IS_NET_INCOME` (pre-tax) | No |\n| Line 31 | Total tax | Tracked separately | Yes (`AB_FIT`) |\n| *Computed* | Net income after tax = Line 30 - Line 31 | `IS_NET_INCOME` (after tax) | No (starting point) |\n\n**C-Corp Adjusted Cash Flow:**\n```\nAdjusted Cash Flow = Net Income After Tax (Line 30 - Line 31)\n                   + Line 12 (Officer Compensation)\n                   + Line 20 (Depreciation)\n                   + Amortization (from Line 26 detail)\n                   + Line 31 (Federal Income Tax)\n                   + Line 19 (Charitable Contributions)\n                   + One-time items (underwriter-identified)\n                   + Related-party rent adjustment (if applicable)\n```\n\n### 7.4 Partnership -- Form 1065\n\n| Form 1065 Line | Description | Normalized Bucket | Add-Back? |\n|----------------|-------------|-------------------|-----------|\n| Line 1a | Gross receipts or sales | `IS_GROSS_REVENUE` | No |\n| Line 1b | Returns and allowances | Subtracted from `IS_GROSS_REVENUE` | No |\n| Line 2 | Cost of goods sold (from Schedule A) | `IS_COGS` | No |\n| Line 3 | Gross profit | `IS_GROSS_PROFIT` | No |\n| Line 4 | Ordinary income (loss) from other partnerships/estates | `IS_NON_OP_INCOME` | No |\n| Line 5 | Net farm profit (loss) | `IS_NON_OP_INCOME` | No |\n| Line 6 | Net gain (loss) from Form 4797 | `IS_NON_OP_INCOME` or `IS_NON_OP_EXPENSE` | No |\n| Line 7 | Other income (loss) | `IS_NON_OP_INCOME` | No |\n| Line 9 | Salaries and wages | `IS_OPEX_PAYROLL` | No |\n| Line 10 | Guaranteed payments to partners | `IS_OPEX_PAYROLL` + `IS_OWNER_COMP` (memo) | Yes (`AB_OWNER_COMP`) |\n| Line 11 | Repairs and maintenance | `IS_OPEX_OTHER` | No |\n| Line 12 | Bad debts | `IS_OPEX_OTHER` | Review for one-time |\n| Line 13 | Rent | `IS_OPEX_RENT` | Review for related-party (`AB_RELATED_RENT`) |\n| Line 14 | Taxes and licenses | `IS_OPEX_OTHER` | No |\n| Line 15 | Interest | `IS_NON_OP_EXPENSE` | No |\n| Line 16a | Depreciation (from Form 4562) | `IS_OPEX_DEPRECIATION` | Yes (`AB_DEPRECIATION`) |\n| Line 16b | Less depreciation in COGS | Subtracted from `AB_DEPRECIATION` | Adjustment |\n| Line 17 | Depletion | `IS_OPEX_OTHER` | No |\n| Line 18 | Retirement plans, etc. | `IS_OPEX_PAYROLL` | No |\n| Line 19 | Employee benefit programs | `IS_OPEX_PAYROLL` | No |\n| Line 20 | Other deductions (from statement) | `IS_OPEX_OTHER` (parse for insurance, professional, amortization, advertising) | Amortization portion: Yes (`AB_AMORTIZATION`). Advertising portion mapped to `IS_OPEX_MARKETING`. |\n| Line 22 | Ordinary business income (loss) | `IS_NET_INCOME` | No |\n| Schedule K, Line 1 | Ordinary business income | Verify matches Line 22 | No |\n| Schedule K, Line 4 | Guaranteed payments | Verify matches Line 10 | No |\n| Schedule K, Line 14 | Section 179 deduction | `IS_OPEX_DEPRECIATION` supplemental | Yes (`AB_DEPRECIATION`) |\n| Schedule K, Line 19a | Distributions (cash and marketable securities) | Not on income statement. Tracked as `IS_OWNER_COMP` supplemental. | Yes (added to `AB_OWNER_COMP`) |\n| Analysis of Partners' Capital (Schedule M-2 equivalent) | Partner contributions and withdrawals | Cross-reference with distributions | Verification only |\n\n**Partnership Adjusted Cash Flow:**\n```\nAdjusted Cash Flow = Line 22 (Ordinary Business Income)\n                   + Line 10 (Guaranteed Payments to Partners)\n                   + Line 16a (Depreciation, net of 16b)\n                   + Schedule K Line 14 (Section 179)\n                   + Amortization (from Line 20 detail)\n                   + Distributions to Partners (Schedule K, Line 19a)\n                   + One-time items (underwriter-identified)\n                   + Related-party rent adjustment (if applicable)\n```\n\n### 7.5 Nonprofit -- Form 990\n\n| Form 990 Part/Line | Description | Normalized Bucket | Add-Back? |\n|--------------------|-------------|-------------------|-----------|\n| Part VIII, Line 1 | Contributions, gifts, grants | `IS_GROSS_REVENUE` (subcategory: contributions) | No |\n| Part VIII, Line 2 | Program service revenue | `IS_GROSS_REVENUE` (subcategory: earned revenue) | No |\n| Part VIII, Line 3 | Investment income | `IS_NON_OP_INCOME` | No |\n| Part VIII, Line 4 | Income from investment of tax-exempt bond proceeds | `IS_NON_OP_INCOME` | No |\n| Part VIII, Line 5 | Royalties | `IS_NON_OP_INCOME` | No |\n| Part VIII, Line 6-7 | Net rental income, net gain from sales | `IS_NON_OP_INCOME` | No |\n| Part VIII, Line 8 | Net income from fundraising events | `IS_GROSS_REVENUE` (subcategory: fundraising) | No |\n| Part VIII, Line 9 | Net income from gaming activities | `IS_GROSS_REVENUE` (subcategory: other) | No |\n| Part VIII, Line 10 | Net gain/loss from sales of inventory | `IS_NON_OP_INCOME` | No |\n| Part VIII, Line 11 | Other revenue | `IS_GROSS_REVENUE` (subcategory: other) | No |\n| Part VIII, Line 12 | Total revenue | `IS_GROSS_REVENUE` (verify = sum of above) | No |\n| Part IX, Line 5 | Compensation of current officers, directors, etc. | `IS_OPEX_PAYROLL` + `IS_OWNER_COMP` (memo -- ED/CEO only) | No (see Section 3.6 for exceptions) |\n| Part IX, Line 6 | Compensation not included above | `IS_OPEX_PAYROLL` | No |\n| Part IX, Line 7 | Other salaries and wages | `IS_OPEX_PAYROLL` | No |\n| Part IX, Line 8 | Pension plan accruals and contributions | `IS_OPEX_PAYROLL` | No |\n| Part IX, Line 9 | Other employee benefits | `IS_OPEX_PAYROLL` | No |\n| Part IX, Line 10 | Payroll taxes | `IS_OPEX_PAYROLL` | No |\n| Part IX, Line 11 | Fees for services (legal, accounting, lobbying, professional, investment mgmt, other) | `IS_OPEX_PROFESSIONAL` | No |\n| Part IX, Line 12 | Advertising and promotion | `IS_OPEX_MARKETING` | No |\n| Part IX, Line 13 | Office expenses | `IS_OPEX_OTHER` | No |\n| Part IX, Line 14 | Information technology | `IS_OPEX_OTHER` | No |\n| Part IX, Line 15 | Royalties | `IS_OPEX_OTHER` | No |\n| Part IX, Line 16 | Occupancy | `IS_OPEX_RENT` | No |\n| Part IX, Line 17 | Travel | `IS_OPEX_OTHER` | No |\n| Part IX, Line 18 | Payments of travel for officials | `IS_OPEX_OTHER` | No |\n| Part IX, Line 19 | Conferences, conventions, meetings | `IS_OPEX_OTHER` | No |\n| Part IX, Line 20 | Interest | `IS_NON_OP_EXPENSE` | No |\n| Part IX, Line 21 | Payments to affiliates | `IS_OPEX_OTHER` | Review for related-party |\n| Part IX, Line 22 | Depreciation, depletion, and amortization | `IS_OPEX_DEPRECIATION` + `IS_OPEX_AMORTIZATION` | Yes (`AB_DEPRECIATION` + `AB_AMORTIZATION`) |\n| Part IX, Line 23 | Insurance | `IS_OPEX_INSURANCE` | No |\n| Part IX, Line 24 | Other expenses (from Schedule O) | `IS_OPEX_OTHER` | Review for one-time items |\n| Part IX, Line 25 | Total functional expenses | `IS_TOTAL_OPEX` (verify = sum of Lines 5-24) | No |\n| Part I, Line 19 | Revenue less expenses (net) | `IS_NET_INCOME` (called \"Change in Net Assets\" for nonprofits) | No |\n| Part X, Line 16 | Total assets | `BS_TOTAL_ASSETS` | No |\n| Part X, Line 26 | Total liabilities | `BS_TOTAL_LIABILITIES` | No |\n| Part X, Line 27-29 | Net assets (unrestricted, temporarily restricted, permanently restricted) | `BS_EQUITY` (combined) | No |\n| Part X, Line 33 | Total liabilities and net assets | `BS_TOTAL_LIAB_EQUITY` | No |\n\n**Nonprofit COGS Note:** Form 990 does not have a COGS line. If the nonprofit has program service costs that are analogous to COGS (e.g., cost of goods sold in a social enterprise), these appear in Part IX functional expenses. The FNE sets `IS_COGS = 0` for nonprofits unless the underwriter manually identifies and reclassifies program costs as COGS.\n\n**Nonprofit Adjusted Cash Flow:**\n```\nAdjusted Cash Flow = Change in Net Assets (Part I, Line 19)\n                   + Depreciation & Amortization (Part IX, Line 22)\n                   + One-time capital campaign expenses (underwriter-identified)\n                   - In-kind revenue offset (if in-kind revenue is included in\n                     total revenue, and corresponding in-kind expense is in\n                     expenses, both sides net to zero -- but if only one side\n                     is recorded, adjust)\n```\n\n**Nonprofit Revenue Quality Flag:**\nThe FNE computes a revenue concentration metric:\n```\nRevenue Concentration = MAX(Single Source Revenue) / Total Revenue\n\nIf Revenue Concentration > 0.50:\n  Flag: \"Single-source revenue concentration of {X}%. Evaluate sustainability.\"\n\nRevenue Mix:\n  Earned Revenue Ratio = Program Service Revenue / Total Revenue\n  Contributed Revenue Ratio = Contributions / Total Revenue\n\nIf Contributed Revenue Ratio > 0.70:\n  Flag: \"High dependency on contributions ({X}%). Evaluate funding reliability.\"\n```\n\n### 7.6 LLC -- Routing Logic\n\nThe FNE does not have a separate mapping table for LLCs. Instead, it routes LLC borrowers to the appropriate entity mapping based on tax election:\n\n```\nfunction determineLLCTreatment(application, taxFormFiled):\n    if taxFormFiled == \"Schedule C\":\n        return \"sole_proprietor\"    // Single-member LLC, disregarded entity\n    elif taxFormFiled == \"Form 1065\":\n        return \"partnership\"         // Multi-member LLC, default\n    elif taxFormFiled == \"Form 1120-S\":\n        return \"s_corp\"             // LLC with S-Corp election\n    elif taxFormFiled == \"Form 1120\":\n        return \"c_corp\"             // LLC with C-Corp election\n    else:\n        // Flag for manual classification\n        return \"unresolved\"\n```\n\nThe `normalization_audit` table records the detected LLC treatment with the rule: `\"LLC routed to {entity_treatment} based on tax form {form_type}\"`.\n\n---\n\n## 8. Multi-Period Handling\n\nThe FNE normalizes up to three years of historical financial data and supports interim (year-to-date) periods.\n\n### 8.1 Period Structure\n\nEach normalized financial record is tagged with:\n- `fiscal_year`: The fiscal year (e.g., 2024)\n- `period_type`: One of `annual`, `interim`, `trailing_twelve_months`\n- `period_start`: Start date of the period\n- `period_end`: End date of the period\n- `months_covered`: Number of months in the period (12 for annual, varies for interim)\n\n### 8.2 Year-Over-Year Trend Calculation\n\nFor each normalized bucket, the FNE computes:\n\n```\nYoY_Change_Pct = (Current_Year_Value - Prior_Year_Value) / |Prior_Year_Value| * 100\n\nIf Prior_Year_Value == 0 and Current_Year_Value != 0:\n  YoY_Change_Pct = NULL (flag as \"new line item\")\n\nIf Prior_Year_Value == 0 and Current_Year_Value == 0:\n  YoY_Change_Pct = 0\n\nThree-Year CAGR (if 3 years available):\n  CAGR = (Year3_Value / Year1_Value)^(1/2) - 1\n```\n\nThe following trend flags are generated automatically:\n\n| Condition | Flag |\n|-----------|------|\n| Revenue declined >10% YoY | `TREND_REVENUE_DECLINE` |\n| Revenue declined >10% for 2 consecutive years | `TREND_REVENUE_SUSTAINED_DECLINE` |\n| Net income turned negative from positive | `TREND_PROFITABILITY_LOSS` |\n| Total debt increased >25% YoY | `TREND_DEBT_INCREASE` |\n| DSCR declined below 1.25 | `TREND_DSCR_DETERIORATION` |\n| Operating expenses grew faster than revenue for 2+ years | `TREND_MARGIN_COMPRESSION` |\n\n### 8.3 Interim Period Handling (YTD Annualization)\n\nWhen the borrower provides year-to-date (YTD) financial statements (e.g., January through September), the FNE annualizes the data for comparison purposes:\n\n```\nAnnualized_Value = (YTD_Value / Months_Covered) * 12\n\nExample:\n  YTD Revenue (Jan-Sep, 9 months) = $675,000\n  Annualized Revenue = ($675,000 / 9) * 12 = $900,000\n```\n\n**Seasonal Adjustment:** If bank statement data or Plaid data reveals significant seasonality (standard deviation of monthly revenue > 30% of monthly average), the FNE flags the annualized figure:\n```\nFlag: \"Annualized from {months_covered} months. Seasonal patterns detected.\n       Annualized figure may overstate/understate actual annual performance.\n       Prior full-year actuals should be weighted more heavily.\"\n```\n\n**Annualization is stored as a separate `period_type = 'annualized_interim'`** -- the raw YTD values are also preserved as `period_type = 'interim'`.\n\n### 8.4 Fiscal Year vs. Calendar Year Alignment\n\nMost tax returns are filed on a calendar year (January-December). Some businesses use a fiscal year (e.g., July-June for nonprofits). The FNE handles this as follows:\n\n- All normalized data retains its original fiscal year dates (`period_start`, `period_end`).\n- For trend analysis, periods are compared by fiscal year sequence (Year 1, Year 2, Year 3) regardless of the actual dates.\n- If comparing two entities (e.g., guarantor personal + business), and one is calendar year and the other is fiscal year, the FNE flags the mismatch:\n  ```\n  Flag: \"Fiscal year mismatch: Business FY ends {month}/{day},\n         personal tax return is calendar year. Revenue/expense timing\n         differences may affect cross-validation accuracy.\"\n  ```\n- For Global Cash Flow, the FNE uses the most recent 12-month period available from each source, with a tolerance of up to 3 months' offset between business and personal periods.\n\n### 8.5 Multi-Period Data Display\n\nThe underwriter UI presents normalized data in a multi-column spreadsheet format:\n\n```\n                          FY 2022     FY 2023     FY 2024     YTD 2025    Trend\n                          --------    --------    --------    --------    -----\nGross Revenue             $1,200,000  $1,350,000  $1,485,000  $1,100,000  +11.2% CAGR\nCOGS                       ($480,000)  ($540,000)  ($594,000)  ($440,000)\nGross Profit                $720,000    $810,000    $891,000    $660,000\n  Gross Margin                 60.0%       60.0%       60.0%       60.0%   Stable\n...\nAdjusted Cash Flow          $285,000    $330,000    $375,000    $290,000   +14.7% CAGR\nDSCR                           1.58x       1.83x       2.08x       2.15x* Rising\n                                                                 *annualized\n```\n\n---\n\n## 9. Global Cash Flow (Personal + Business Combined)\n\nGlobal Cash Flow combines the borrower's business Adjusted Cash Flow with the guarantor's personal income and obligations to produce a Global DSCR -- the single most important metric for underwriting decisions at CDFIs.\n\n### 9.1 Personal Income Sources\n\nExtracted from the guarantor's Form 1040 and supporting schedules:\n\n| Source | 1040 Line | Treatment |\n|--------|-----------|-----------|\n| Wages and salaries (W-2) | Line 1a | Include. If the guarantor is the business owner AND receives a W-2 from the subject business (S-Corp/C-Corp), this is ALREADY captured in the business financials as officer compensation. Do NOT double-count. |\n| Business income (Schedule C) | Line 8, Schedule 1 | **Exclude if this IS the subject business.** Include if from a separate business. |\n| Rental income (Schedule E) | Line 5, Schedule 1 | Include net rental income. If rental properties have associated debt, ensure both income and debt are captured. |\n| Partnership/S-Corp income (Schedule E, K-1) | Schedule E Part II | **Exclude if this IS the subject business.** Include if from other partnerships/S-Corps. |\n| Interest and dividends (Schedule B) | Lines 2b, 3b | Include. Typically small for CDFI borrowers. |\n| Capital gains (Schedule D) | Line 7, Schedule 1 | **Exclude for DSCR** -- capital gains are non-recurring. Flag if material and recurring. |\n| Social Security / Pension | Lines 5a, 6a | Include. Reliable recurring income. |\n| Other income | Line 8, Schedule 1 | Include with review. Flag non-recurring items. |\n\n### 9.2 Personal Debt Obligations\n\nExtracted from the Personal Financial Statement (PFS), credit report, or 1040:\n\n| Obligation | Source | Treatment |\n|-----------|--------|-----------|\n| Primary mortgage (P&I) | PFS / Credit Report | Include annual P&I. |\n| Home equity loan / HELOC | PFS / Credit Report | Include annual payment. |\n| Auto loans | PFS / Credit Report | Include annual payments (all vehicles). |\n| Student loans | PFS / Credit Report | Include annual payment. Use actual payment if in repayment; use IBR estimated payment if in deferment. |\n| Credit card minimum payments | Credit Report | Include sum of minimum monthly payments * 12. |\n| Personal loans | PFS / Credit Report | Include annual P&I. |\n| Alimony / child support | 1040 Schedule 1 or PFS | Include annual obligation. |\n| Other recurring personal debt | PFS | Include if verifiable. |\n\n### 9.3 Double-Count Prevention\n\nThe most critical aspect of Global Cash Flow is avoiding double-counting income that appears in both the business and personal financials.\n\n**Rules:**\n\n1. **S-Corp/C-Corp Owner Salary:** The officer compensation on Form 1120-S Line 7 or Form 1120 Line 12 IS the same as the W-2 wages on the guarantor's Form 1040 Line 1a (or a portion thereof). The FNE must identify this overlap and exclude the W-2 income attributable to the subject business from personal income.\n   ```\n   Personal W-2 Income for Global CF = Total W-2 Income - W-2 from Subject Business\n   ```\n\n2. **Partnership/S-Corp K-1 Income:** The guarantor's K-1 income from the subject partnership or S-Corp is the same income already captured in the business Adjusted Cash Flow. Exclude it from personal income.\n   ```\n   Personal K-1 Income for Global CF = Total K-1 Income - K-1 from Subject Business\n   ```\n\n3. **Sole Proprietor Schedule C:** The Schedule C net profit IS the business income. It should not appear in both business and personal cash flow. In the FNE, the Schedule C is treated entirely as the business. The guarantor's personal income excludes Schedule C from the subject business.\n\n4. **Distributions:** S-Corp and Partnership distributions to the guarantor are already included in business Adjusted Cash Flow as an add-back. Do NOT also include them as personal income.\n\n### 9.4 Global DSCR Calculation\n\n```\nGLOBAL DSCR = Global Cash Flow Available / Total Debt Service\n\nWhere:\n\nGlobal Cash Flow Available =\n    Business Adjusted Cash Flow (from FNE, Section 4.1)\n  + Personal Income (W-2 from OTHER employers, if any)\n  + Rental Income (net, from properties NOT collateralizing the subject loan)\n  + Other K-1 Income (from OTHER businesses)\n  + Social Security / Pension Income\n  + Other Recurring Personal Income\n  - Personal Living Expenses (estimated or actual)\n  - Personal Income Tax (actual from 1040, adjusted for business pass-through)\n\nTotal Debt Service =\n    Annual P&I on ALL existing business debt (from debt schedule)\n  + Annual P&I on proposed new loan\n  + Annual personal mortgage P&I\n  + Annual auto loan payments\n  + Annual student loan payments\n  + Annual credit card minimum payments * 12\n  + Annual personal loan payments\n  + Annual alimony/child support\n\nGLOBAL DSCR = Global Cash Flow Available / Total Debt Service\n```\n\n**Personal Living Expense Estimation (if actual not available):**\n```\nEstimated Personal Living Expenses =\n    Annual mortgage/rent payment (already in debt service, do NOT double-count)\n  + Estimated taxes (from 1040, net of business pass-through taxes)\n  + Health insurance (if not covered by business)\n  + Basic living allowance: use regional cost-of-living data or\n    default to $3,000/month ($36,000/year) per guarantor household\n\nNote: This is the most subjective part of Global Cash Flow.\n      The underwriter should review and override if needed.\n```\n\n### 9.5 Global Cash Flow Output Format\n\n```\n=== GLOBAL CASH FLOW ANALYSIS ===\n\nBUSINESS CASH FLOW\n  Business Adjusted Cash Flow (FNE)              $375,000\n  - Business Debt Service (existing)             ($120,000)\n  = Business Cash Flow After Debt Service         $255,000\n\n  Business-Only DSCR (existing debt):             3.13x\n  Business-Only DSCR (existing + proposed):       1.88x\n\nPERSONAL INCOME (Guarantor: John Smith)\n  W-2 Income (other employers)                    $45,000\n  Rental Income (net)                             $18,000\n  Other Income                                     $5,000\n  = Total Personal Income                         $68,000\n\nPERSONAL OBLIGATIONS (Guarantor: John Smith)\n  Mortgage P&I                                   ($24,000)\n  Auto Loan                                       ($6,000)\n  Student Loans                                   ($3,600)\n  Credit Cards (minimums)                         ($2,400)\n  Estimated Taxes & Living                       ($48,000)\n  = Total Personal Obligations                   ($84,000)\n\n  Personal Surplus / (Deficit)                   ($16,000)\n\nGLOBAL CASH FLOW\n  Business Adjusted Cash Flow                    $375,000\n  + Personal Income                               $68,000\n  - Personal Obligations                         ($84,000)\n  = Global Cash Flow Available                   $359,000\n\n  Total Debt Service (all business + personal)   $236,000\n    Existing business debt                        $120,000\n    Proposed new loan                              $80,000\n    Personal debt                                  $36,000\n\n  GLOBAL DSCR:                                     1.52x\n```\n\n---\n\n## 10. Database Schema\n\nThe following tables extend the existing CremoLogix schema (architecture.md Section 6, specification.md Section 3) to support the Financial Normalization Engine.\n\n### 10.1 Table: `normalized_financials`\n\nStores the normalized output per entity per period. One row per case per fiscal period.\n\n```sql\nCREATE TABLE normalized_financials (\n  id                          UUID PRIMARY KEY DEFAULT uuid_generate_v7(),\n  tenant_id                   UUID NOT NULL REFERENCES tenants(id),\n  case_id                     UUID NOT NULL REFERENCES cases(id),\n  entity_type                 VARCHAR(20) NOT NULL,\n      -- 'sole_proprietor', 'llc', 's_corp', 'c_corp', 'partnership', 'nonprofit'\n  entity_treatment            VARCHAR(20) NOT NULL,\n      -- For LLCs, the actual treatment applied: 'sole_proprietor', 'partnership', 's_corp', 'c_corp'\n      -- For non-LLCs, same as entity_type\n  fiscal_year                 INTEGER NOT NULL,\n  period_type                 VARCHAR(30) NOT NULL,\n      -- 'annual', 'interim', 'annualized_interim', 'trailing_twelve_months'\n  period_start                DATE NOT NULL,\n  period_end                  DATE NOT NULL,\n  months_covered              INTEGER NOT NULL,\n\n  -- Income Statement Buckets\n  is_gross_revenue            DECIMAL(15,2),\n  is_cogs                     DECIMAL(15,2),\n  is_gross_profit             DECIMAL(15,2),\n  is_opex_payroll             DECIMAL(15,2),\n  is_opex_rent                DECIMAL(15,2),\n  is_opex_marketing           DECIMAL(15,2),\n  is_opex_insurance           DECIMAL(15,2),\n  is_opex_professional        DECIMAL(15,2),\n  is_opex_depreciation        DECIMAL(15,2),\n  is_opex_amortization        DECIMAL(15,2),\n  is_opex_other               DECIMAL(15,2),\n  is_total_opex               DECIMAL(15,2),\n  is_owner_comp               DECIMAL(15,2),\n  is_noi                      DECIMAL(15,2),\n  is_non_op_income            DECIMAL(15,2),\n  is_non_op_expense           DECIMAL(15,2),\n  is_net_income               DECIMAL(15,2),\n\n  -- Add-Backs\n  ab_owner_comp               DECIMAL(15,2),\n  ab_depreciation             DECIMAL(15,2),\n  ab_amortization             DECIMAL(15,2),\n  ab_one_time                 DECIMAL(15,2),\n  ab_related_rent             DECIMAL(15,2),\n  ab_fit                      DECIMAL(15,2),\n  ab_total                    DECIMAL(15,2),\n\n  -- Key Derived Metric\n  is_adjusted_cf              DECIMAL(15,2),\n\n  -- Balance Sheet Buckets\n  bs_cash                     DECIMAL(15,2),\n  bs_ar                       DECIMAL(15,2),\n  bs_inventory                DECIMAL(15,2),\n  bs_other_current_assets     DECIMAL(15,2),\n  bs_total_current            DECIMAL(15,2),\n  bs_ppe_net                  DECIMAL(15,2),\n  bs_real_estate              DECIMAL(15,2),\n  bs_intangibles              DECIMAL(15,2),\n  bs_other_lt_assets          DECIMAL(15,2),\n  bs_total_assets             DECIMAL(15,2),\n  bs_ap                       DECIMAL(15,2),\n  bs_cpltd                    DECIMAL(15,2),\n  bs_accrued                  DECIMAL(15,2),\n  bs_other_current_liab       DECIMAL(15,2),\n  bs_total_current_liab       DECIMAL(15,2),\n  bs_notes_lt                 DECIMAL(15,2),\n  bs_mortgages                DECIMAL(15,2),\n  bs_other_lt_liab            DECIMAL(15,2),\n  bs_total_liabilities        DECIMAL(15,2),\n  bs_equity                   DECIMAL(15,2),\n  bs_total_liab_equity        DECIMAL(15,2),\n\n  -- Cash Flow Buckets\n  cf_operating                DECIMAL(15,2),\n  cf_investing                DECIMAL(15,2),\n  cf_financing                DECIMAL(15,2),\n  cf_net_change               DECIMAL(15,2),\n  cf_free                     DECIMAL(15,2),\n\n  -- Trend Metrics (computed, NULL for first year)\n  yoy_revenue_change_pct      DECIMAL(10,4),\n  yoy_net_income_change_pct   DECIMAL(10,4),\n  yoy_adjusted_cf_change_pct  DECIMAL(10,4),\n  yoy_total_assets_change_pct DECIMAL(10,4),\n  yoy_total_debt_change_pct   DECIMAL(10,4),\n  revenue_cagr_3yr            DECIMAL(10,4),\n\n  -- Confidence\n  overall_confidence          DECIMAL(5,4) NOT NULL,\n  validation_status           VARCHAR(20) NOT NULL DEFAULT 'pending',\n      -- 'pending', 'auto_validated', 'flagged_for_review', 'manual_required',\n      -- 'underwriter_reviewed', 'confirmed'\n  field_confidences_jsonb     JSONB NOT NULL DEFAULT '{}',\n      -- Per-field confidence: {\"is_gross_revenue\": 0.95, \"is_net_income\": 0.88, ...}\n\n  -- Cross-Validation\n  cross_validation_score      DECIMAL(5,4),\n  cross_validation_results_jsonb JSONB DEFAULT '{}',\n      -- {\"XV-001\": {\"status\": \"pass\", \"variance\": 0.02}, ...}\n\n  -- Trend Flags\n  trend_flags_jsonb           JSONB DEFAULT '[]',\n      -- [{\"flag\": \"TREND_REVENUE_DECLINE\", \"detail\": \"Revenue declined 12% YoY\"}, ...]\n\n  -- Source Tracking\n  primary_source_document_id  UUID REFERENCES documents(id),\n  source_documents_jsonb      JSONB NOT NULL DEFAULT '[]',\n      -- [{\"document_id\": \"uuid\", \"document_type\": \"tax_return_business\", \"fields_sourced\": [\"is_gross_revenue\", ...]}]\n\n  -- Add-Back Detail\n  add_back_details_jsonb      JSONB NOT NULL DEFAULT '[]',\n      -- [{\"type\": \"AB_OWNER_COMP\", \"amount\": 85000, \"source_field\": \"Line 7\", \"description\": \"Officer compensation\", \"auto_identified\": true}]\n\n  -- Global Cash Flow (NULL if personal data not available)\n  global_personal_income      DECIMAL(15,2),\n  global_personal_obligations DECIMAL(15,2),\n  global_cash_flow_available  DECIMAL(15,2),\n  global_total_debt_service   DECIMAL(15,2),\n  global_dscr                 DECIMAL(10,4),\n  global_cf_details_jsonb     JSONB DEFAULT '{}',\n\n  -- Metadata\n  normalization_version       VARCHAR(20) NOT NULL DEFAULT '1.0',\n  normalized_by               VARCHAR(50) NOT NULL DEFAULT 'system',\n      -- 'system' or user UUID if manually normalized\n  created_at                  TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at                  TIMESTAMPTZ NOT NULL DEFAULT now(),\n  deleted_at                  TIMESTAMPTZ NULL\n);\n\nCREATE INDEX idx_norm_fin_case ON normalized_financials(tenant_id, case_id);\nCREATE INDEX idx_norm_fin_year ON normalized_financials(tenant_id, case_id, fiscal_year);\nCREATE INDEX idx_norm_fin_status ON normalized_financials(tenant_id, validation_status);\nCREATE UNIQUE INDEX idx_norm_fin_unique_period\n  ON normalized_financials(tenant_id, case_id, fiscal_year, period_type)\n  WHERE deleted_at IS NULL;\n```\n\n### 10.2 Table: `normalization_mappings`\n\nStores the source-to-bucket mapping rules per entity type. These are the configurable rules that the FNE applies. Pre-seeded with the mappings defined in Section 7.\n\n```sql\nCREATE TABLE normalization_mappings (\n  id                          UUID PRIMARY KEY DEFAULT uuid_generate_v7(),\n  tenant_id                   UUID REFERENCES tenants(id),\n      -- NULL for system-default mappings; tenant-specific overrides have tenant_id set\n  entity_type                 VARCHAR(20) NOT NULL,\n      -- 'sole_proprietor', 's_corp', 'c_corp', 'partnership', 'nonprofit'\n  tax_form                    VARCHAR(20) NOT NULL,\n      -- 'schedule_c', '1120_s', '1120', '1065', '990'\n  source_field_code           VARCHAR(50) NOT NULL,\n      -- e.g., 'line_1a', 'line_7', 'part_viii_line_2'\n  source_field_label          VARCHAR(255) NOT NULL,\n      -- e.g., 'Gross receipts or sales', 'Compensation of officers'\n  normalized_bucket           VARCHAR(50) NOT NULL,\n      -- e.g., 'IS_GROSS_REVENUE', 'IS_OPEX_PAYROLL'\n  is_add_back                 BOOLEAN NOT NULL DEFAULT false,\n  add_back_type               VARCHAR(30),\n      -- 'AB_OWNER_COMP', 'AB_DEPRECIATION', 'AB_AMORTIZATION', 'AB_ONE_TIME',\n      -- 'AB_RELATED_RENT', 'AB_FIT', NULL if not an add-back\n  add_back_auto_apply         BOOLEAN NOT NULL DEFAULT false,\n      -- true = automatically applied; false = suggested, underwriter must confirm\n  mapping_notes               TEXT,\n      -- Explanation of any special handling\n  priority                    INTEGER NOT NULL DEFAULT 100,\n      -- Lower = higher priority. Used when multiple mappings could apply.\n  is_active                   BOOLEAN NOT NULL DEFAULT true,\n  created_at                  TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at                  TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\nCREATE INDEX idx_norm_map_entity ON normalization_mappings(entity_type, tax_form);\nCREATE INDEX idx_norm_map_tenant ON normalization_mappings(tenant_id)\n  WHERE tenant_id IS NOT NULL;\nCREATE UNIQUE INDEX idx_norm_map_unique\n  ON normalization_mappings(COALESCE(tenant_id, '00000000-0000-0000-0000-000000000000'),\n                            entity_type, tax_form, source_field_code)\n  WHERE is_active = true;\n```\n\n### 10.3 Table: `normalization_audit`\n\nTracks which rules were applied, which fields were add-backed, confidence per field, cross-validation results, and all underwriter overrides. Append-only.\n\n```sql\nCREATE TABLE normalization_audit (\n  id                          UUID PRIMARY KEY DEFAULT uuid_generate_v7(),\n  tenant_id                   UUID NOT NULL REFERENCES tenants(id),\n  case_id                     UUID NOT NULL REFERENCES cases(id),\n  normalized_financial_id     UUID NOT NULL REFERENCES normalized_financials(id),\n  event_type                  VARCHAR(50) NOT NULL,\n      -- 'normalization_started', 'mapping_applied', 'add_back_applied',\n      -- 'add_back_suggested', 'add_back_rejected', 'cross_validation_run',\n      -- 'confidence_computed', 'field_overridden', 'normalization_completed',\n      -- 'underwriter_confirmed', 'llc_routing_applied'\n  field_code                  VARCHAR(50),\n      -- The normalized bucket code, e.g., 'IS_GROSS_REVENUE'. NULL for non-field events.\n  mapping_id                  UUID REFERENCES normalization_mappings(id),\n      -- The mapping rule that was applied. NULL for non-mapping events.\n  source_document_id          UUID REFERENCES documents(id),\n  source_field_code           VARCHAR(50),\n      -- The original source field, e.g., 'line_1a'\n  original_value              DECIMAL(15,2),\n      -- The value before any override\n  applied_value               DECIMAL(15,2),\n      -- The value that was actually used\n  override_value              DECIMAL(15,2),\n      -- The value the underwriter entered (NULL if no override)\n  confidence                  DECIMAL(5,4),\n      -- Confidence score for this field at this point in time\n  override_reason             TEXT,\n      -- Required when event_type = 'field_overridden'\n  cross_validation_rule_id    VARCHAR(10),\n      -- e.g., 'XV-001'. NULL for non-cross-validation events.\n  cross_validation_status     VARCHAR(10),\n      -- 'pass', 'warning', 'fail'. NULL for non-cross-validation events.\n  cross_validation_variance   DECIMAL(10,4),\n  details_jsonb               JSONB DEFAULT '{}',\n      -- Flexible field for additional context\n  performed_by                UUID REFERENCES users(id),\n      -- NULL for system-performed events\n  performed_at                TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Append-only: no UPDATE or DELETE permissions for the application role\nCREATE INDEX idx_norm_audit_case ON normalization_audit(tenant_id, case_id);\nCREATE INDEX idx_norm_audit_financial ON normalization_audit(normalized_financial_id);\nCREATE INDEX idx_norm_audit_event ON normalization_audit(event_type);\nCREATE INDEX idx_norm_audit_time ON normalization_audit(performed_at DESC);\n```\n\n### 10.4 Table: `normalized_financial_overrides`\n\nTracks individual field overrides by underwriters with full audit trail. This is a working table (not append-only) that stores the current state of overrides.\n\n```sql\nCREATE TABLE normalized_financial_overrides (\n  id                          UUID PRIMARY KEY DEFAULT uuid_generate_v7(),\n  tenant_id                   UUID NOT NULL REFERENCES tenants(id),\n  normalized_financial_id     UUID NOT NULL REFERENCES normalized_financials(id),\n  field_code                  VARCHAR(50) NOT NULL,\n      -- The normalized bucket code being overridden\n  original_value              DECIMAL(15,2),\n  override_value              DECIMAL(15,2) NOT NULL,\n  override_reason             TEXT NOT NULL,\n      -- Required justification\n  override_source             VARCHAR(50),\n      -- e.g., 'bank_statement', 'client_conversation', 'recalculation', 'other'\n  overridden_by               UUID NOT NULL REFERENCES users(id),\n  overridden_at               TIMESTAMPTZ NOT NULL DEFAULT now(),\n  is_active                   BOOLEAN NOT NULL DEFAULT true,\n      -- false if the override was reverted\n  reverted_by                 UUID REFERENCES users(id),\n  reverted_at                 TIMESTAMPTZ,\n  revert_reason               TEXT,\n  created_at                  TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at                  TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\nCREATE INDEX idx_norm_override_financial\n  ON normalized_financial_overrides(normalized_financial_id);\nCREATE UNIQUE INDEX idx_norm_override_unique\n  ON normalized_financial_overrides(normalized_financial_id, field_code)\n  WHERE is_active = true;\n```\n\n---\n\n## 11. API Endpoints\n\nAll endpoints are under the Core API Server (NestJS) and require JWT authentication. Tenant context is derived from the JWT. These endpoints extend the existing API contract (specification.md Section 4).\n\n### 11.1 POST `/api/v1/financial/normalize`\n\n**Purpose:** Trigger normalization for a case. Reads extraction results, applies entity-specific mapping rules, computes add-backs, runs cross-validation, computes confidence, and stores normalized output.\n\n**Authorization:** `underwriter`, `credit_manager`, `admin`\n\n**Request Body:**\n```json\n{\n  \"case_id\": \"uuid\",\n  \"fiscal_years\": [2022, 2023, 2024],\n  \"include_interim\": true,\n  \"force_renormalize\": false\n}\n```\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `case_id` | UUID | Yes | The case to normalize |\n| `fiscal_years` | integer[] | No | Specific years to normalize. If omitted, normalizes all available years. |\n| `include_interim` | boolean | No | Whether to include YTD interim periods. Default: true. |\n| `force_renormalize` | boolean | No | If true, deletes existing normalization and re-runs. Default: false. |\n\n**Response (202 Accepted):**\n```json\n{\n  \"job_id\": \"uuid\",\n  \"status\": \"queued\",\n  \"case_id\": \"uuid\",\n  \"estimated_duration_seconds\": 15,\n  \"message\": \"Normalization job queued. Poll GET /api/v1/financial/normalize/status/{job_id} or await webhook.\"\n}\n```\n\n**Response (409 Conflict):**\n```json\n{\n  \"error\": \"NORMALIZATION_EXISTS\",\n  \"message\": \"Normalized financials already exist for this case. Set force_renormalize=true to re-run.\",\n  \"existing_periods\": [\n    {\"fiscal_year\": 2023, \"period_type\": \"annual\", \"normalized_at\": \"2026-02-01T...\"}\n  ]\n}\n```\n\n**Error Conditions:**\n- `404`: Case not found or not accessible\n- `422`: No extraction results available for the case (documents not yet processed)\n- `409`: Normalization already exists and `force_renormalize` is false\n\n### 11.2 GET `/api/v1/financial/normalized/{caseId}`\n\n**Purpose:** Retrieve the normalized financial output for a case, across all available periods.\n\n**Authorization:** `underwriter` (assigned to case), `credit_manager`, `admin`\n\n**Query Parameters:**\n\n| Parameter | Type | Required | Description |\n|-----------|------|----------|-------------|\n| `fiscal_year` | integer | No | Filter to a specific year |\n| `period_type` | string | No | Filter: `annual`, `interim`, `annualized_interim` |\n| `include_global_cf` | boolean | No | Include Global Cash Flow analysis. Default: true. |\n| `include_trends` | boolean | No | Include YoY trend calculations. Default: true. |\n\n**Response (200 OK):**\n```json\n{\n  \"case_id\": \"uuid\",\n  \"entity_type\": \"s_corp\",\n  \"entity_treatment\": \"s_corp\",\n  \"overall_confidence\": 0.91,\n  \"validation_status\": \"auto_validated\",\n  \"cross_validation_score\": 0.88,\n  \"periods\": [\n    {\n      \"id\": \"uuid\",\n      \"fiscal_year\": 2024,\n      \"period_type\": \"annual\",\n      \"period_start\": \"2024-01-01\",\n      \"period_end\": \"2024-12-31\",\n      \"months_covered\": 12,\n      \"income_statement\": {\n        \"is_gross_revenue\": {\"value\": 1485000.00, \"confidence\": 0.95, \"status\": \"auto_validated\"},\n        \"is_cogs\": {\"value\": 594000.00, \"confidence\": 0.93, \"status\": \"auto_validated\"},\n        \"is_gross_profit\": {\"value\": 891000.00, \"confidence\": 0.93, \"status\": \"auto_validated\"},\n        \"is_opex_payroll\": {\"value\": 285000.00, \"confidence\": 0.90, \"status\": \"auto_validated\"},\n        \"is_opex_rent\": {\"value\": 72000.00, \"confidence\": 0.92, \"status\": \"auto_validated\"},\n        \"is_opex_marketing\": {\"value\": 24000.00, \"confidence\": 0.88, \"status\": \"flagged_for_review\"},\n        \"is_opex_insurance\": {\"value\": 18000.00, \"confidence\": 0.91, \"status\": \"auto_validated\"},\n        \"is_opex_professional\": {\"value\": 15000.00, \"confidence\": 0.85, \"status\": \"flagged_for_review\"},\n        \"is_opex_depreciation\": {\"value\": 45000.00, \"confidence\": 0.97, \"status\": \"auto_validated\"},\n        \"is_opex_amortization\": {\"value\": 5000.00, \"confidence\": 0.80, \"status\": \"flagged_for_review\"},\n        \"is_opex_other\": {\"value\": 52000.00, \"confidence\": 0.78, \"status\": \"flagged_for_review\"},\n        \"is_total_opex\": {\"value\": 516000.00, \"confidence\": 0.88, \"status\": \"flagged_for_review\"},\n        \"is_owner_comp\": {\"value\": 120000.00, \"confidence\": 0.95, \"status\": \"auto_validated\"},\n        \"is_noi\": {\"value\": 375000.00, \"confidence\": 0.88, \"status\": \"flagged_for_review\"},\n        \"is_non_op_income\": {\"value\": 2000.00, \"confidence\": 0.85, \"status\": \"flagged_for_review\"},\n        \"is_non_op_expense\": {\"value\": 18000.00, \"confidence\": 0.90, \"status\": \"auto_validated\"},\n        \"is_net_income\": {\"value\": 359000.00, \"confidence\": 0.92, \"status\": \"auto_validated\"}\n      },\n      \"add_backs\": {\n        \"ab_owner_comp\": {\"value\": 120000.00, \"description\": \"Officer compensation (1120-S Line 7)\", \"auto_identified\": true},\n        \"ab_depreciation\": {\"value\": 45000.00, \"description\": \"Depreciation (1120-S Line 14)\", \"auto_identified\": true},\n        \"ab_amortization\": {\"value\": 5000.00, \"description\": \"Amortization (from Other Deductions)\", \"auto_identified\": true},\n        \"ab_one_time\": {\"value\": 15000.00, \"description\": \"Lawsuit settlement - non-recurring\", \"auto_identified\": false},\n        \"ab_related_rent\": {\"value\": 0.00, \"description\": null, \"auto_identified\": false},\n        \"ab_fit\": {\"value\": 0.00, \"description\": \"N/A - pass-through entity\", \"auto_identified\": true},\n        \"ab_total\": {\"value\": 185000.00}\n      },\n      \"adjusted_cash_flow\": {\"value\": 544000.00, \"confidence\": 0.91},\n      \"balance_sheet\": {\n        \"bs_cash\": {\"value\": 125000.00, \"confidence\": 0.95},\n        \"bs_ar\": {\"value\": 180000.00, \"confidence\": 0.88},\n        \"bs_inventory\": {\"value\": 95000.00, \"confidence\": 0.85},\n        \"bs_total_assets\": {\"value\": 850000.00, \"confidence\": 0.90}\n      },\n      \"cash_flow\": {\n        \"cf_operating\": {\"value\": 380000.00, \"confidence\": 0.82},\n        \"cf_investing\": {\"value\": -65000.00, \"confidence\": 0.80},\n        \"cf_financing\": {\"value\": -95000.00, \"confidence\": 0.85},\n        \"cf_net_change\": {\"value\": 220000.00, \"confidence\": 0.82},\n        \"cf_free\": {\"value\": 315000.00, \"confidence\": 0.80}\n      },\n      \"trends\": {\n        \"yoy_revenue_change_pct\": 10.00,\n        \"yoy_net_income_change_pct\": 12.50,\n        \"yoy_adjusted_cf_change_pct\": 13.64,\n        \"revenue_cagr_3yr\": 11.24\n      },\n      \"trend_flags\": []\n    }\n  ],\n  \"global_cash_flow\": {\n    \"business_adjusted_cf\": 544000.00,\n    \"personal_income\": 68000.00,\n    \"personal_obligations\": 84000.00,\n    \"global_cf_available\": 528000.00,\n    \"total_debt_service\": 316000.00,\n    \"global_dscr\": 1.67,\n    \"double_count_adjustments\": [\n      {\"type\": \"w2_from_subject_business\", \"amount\": 120000.00, \"excluded_from\": \"personal_income\"}\n    ]\n  },\n  \"cross_validation\": {\n    \"score\": 0.88,\n    \"rules_evaluated\": 7,\n    \"passed\": 5,\n    \"warnings\": 2,\n    \"failed\": 0,\n    \"results\": [\n      {\"rule_id\": \"XV-001\", \"status\": \"pass\", \"variance\": 0.03, \"description\": \"Tax vs. P&L net income: 3% variance (within 5% tolerance)\"},\n      {\"rule_id\": \"XV-002\", \"status\": \"warning\", \"variance\": 0.18, \"description\": \"Bank deposits vs. revenue: 18% variance (within 25% warning threshold). May include loan proceeds or inter-account transfers.\"}\n    ]\n  },\n  \"source_documents\": [\n    {\"document_id\": \"uuid\", \"document_type\": \"tax_return_business\", \"tax_year\": 2024, \"fields_sourced\": 22},\n    {\"document_id\": \"uuid\", \"document_type\": \"financial_statement\", \"period\": \"FY2024\", \"fields_sourced\": 15},\n    {\"document_id\": \"uuid\", \"document_type\": \"bank_statement\", \"period\": \"Jan-Dec 2024\", \"fields_sourced\": 3}\n  ]\n}\n```\n\n### 11.3 PUT `/api/v1/financial/normalized/{caseId}/override`\n\n**Purpose:** Allow an underwriter to correct a normalized field with justification. Creates an audit trail entry and updates the normalized output.\n\n**Authorization:** `underwriter` (assigned to case), `credit_manager`, `admin`\n\n**Request Body:**\n```json\n{\n  \"normalized_financial_id\": \"uuid\",\n  \"overrides\": [\n    {\n      \"field_code\": \"is_opex_other\",\n      \"new_value\": 42000.00,\n      \"reason\": \"Reclassified $10,000 from Other Operating to Marketing based on GL detail review. Remaining $42,000 confirmed.\",\n      \"source\": \"accounting_software\"\n    },\n    {\n      \"field_code\": \"ab_one_time\",\n      \"new_value\": 25000.00,\n      \"reason\": \"Added $10,000 moving expense as one-time item per borrower explanation. Total one-time add-backs now $25,000.\",\n      \"source\": \"client_conversation\"\n    }\n  ]\n}\n```\n\n**Response (200 OK):**\n```json\n{\n  \"normalized_financial_id\": \"uuid\",\n  \"overrides_applied\": 2,\n  \"recalculated_fields\": {\n    \"is_total_opex\": {\"old\": 516000.00, \"new\": 506000.00},\n    \"is_noi\": {\"old\": 375000.00, \"new\": 385000.00},\n    \"ab_total\": {\"old\": 185000.00, \"new\": 195000.00},\n    \"is_adjusted_cf\": {\"old\": 544000.00, \"new\": 564000.00},\n    \"global_dscr\": {\"old\": 1.67, \"new\": 1.73}\n  },\n  \"audit_entries_created\": 2\n}\n```\n\n**Validation Rules:**\n- `reason` is required and must be at least 20 characters.\n- `source` must be one of: `tax_return`, `financial_statement`, `bank_statement`, `accounting_software`, `client_conversation`, `recalculation`, `credit_report`, `other`.\n- Overriding a field triggers automatic recalculation of all dependent fields (totals, ratios, DSCR, Global DSCR).\n- Each override is recorded in both `normalized_financial_overrides` and `normalization_audit`.\n\n### 11.4 GET `/api/v1/financial/normalized/{caseId}/audit`\n\n**Purpose:** Retrieve the complete normalization audit trail for a case. Shows every mapping applied, every add-back identified, every cross-validation result, and every underwriter override.\n\n**Authorization:** `underwriter` (assigned to case), `credit_manager`, `admin`\n\n**Query Parameters:**\n\n| Parameter | Type | Required | Description |\n|-----------|------|----------|-------------|\n| `event_type` | string | No | Filter by event type |\n| `field_code` | string | No | Filter by specific field |\n| `fiscal_year` | integer | No | Filter by fiscal year |\n| `page` | integer | No | Pagination. Default: 1. |\n| `per_page` | integer | No | Items per page. Default: 50. Max: 200. |\n\n**Response (200 OK):**\n```json\n{\n  \"case_id\": \"uuid\",\n  \"total_events\": 156,\n  \"page\": 1,\n  \"per_page\": 50,\n  \"events\": [\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"normalization_started\",\n      \"performed_at\": \"2026-02-01T14:30:00Z\",\n      \"performed_by\": null,\n      \"details\": {\"entity_type\": \"s_corp\", \"fiscal_years\": [2022, 2023, 2024], \"normalization_version\": \"1.0\"}\n    },\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"llc_routing_applied\",\n      \"performed_at\": \"2026-02-01T14:30:01Z\",\n      \"performed_by\": null,\n      \"details\": {\"declared_type\": \"llc\", \"tax_form_detected\": \"1120_s\", \"treatment_applied\": \"s_corp\"}\n    },\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"mapping_applied\",\n      \"field_code\": \"is_gross_revenue\",\n      \"source_field_code\": \"line_1a\",\n      \"source_document_id\": \"uuid\",\n      \"original_value\": 1485000.00,\n      \"applied_value\": 1485000.00,\n      \"confidence\": 0.95,\n      \"performed_at\": \"2026-02-01T14:30:02Z\",\n      \"performed_by\": null,\n      \"details\": {\"mapping_id\": \"uuid\", \"mapping_rule\": \"1120-S Line 1a -> IS_GROSS_REVENUE\"}\n    },\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"add_back_applied\",\n      \"field_code\": \"ab_owner_comp\",\n      \"source_field_code\": \"line_7\",\n      \"source_document_id\": \"uuid\",\n      \"applied_value\": 120000.00,\n      \"confidence\": 0.95,\n      \"performed_at\": \"2026-02-01T14:30:03Z\",\n      \"performed_by\": null,\n      \"details\": {\"add_back_type\": \"AB_OWNER_COMP\", \"description\": \"Officer compensation (1120-S Line 7)\", \"auto_applied\": true}\n    },\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"cross_validation_run\",\n      \"cross_validation_rule_id\": \"XV-001\",\n      \"cross_validation_status\": \"pass\",\n      \"cross_validation_variance\": 0.03,\n      \"performed_at\": \"2026-02-01T14:30:10Z\",\n      \"performed_by\": null,\n      \"details\": {\"value_a\": 359000.00, \"value_a_source\": \"tax_return\", \"value_b\": 348730.00, \"value_b_source\": \"financial_statement\"}\n    },\n    {\n      \"id\": \"uuid\",\n      \"event_type\": \"field_overridden\",\n      \"field_code\": \"is_opex_other\",\n      \"original_value\": 52000.00,\n      \"override_value\": 42000.00,\n      \"performed_at\": \"2026-02-03T09:15:00Z\",\n      \"performed_by\": \"uuid-of-underwriter\",\n      \"details\": {\"reason\": \"Reclassified $10,000 from Other Operating to Marketing based on GL detail review.\", \"source\": \"accounting_software\"}\n    }\n  ]\n}\n```\n\n### 11.5 GET `/api/v1/financial/normalize/status/{jobId}`\n\n**Purpose:** Poll the status of an asynchronous normalization job.\n\n**Authorization:** `underwriter`, `credit_manager`, `admin`\n\n**Response (200 OK):**\n```json\n{\n  \"job_id\": \"uuid\",\n  \"case_id\": \"uuid\",\n  \"status\": \"completed\",\n  \"progress_pct\": 100,\n  \"started_at\": \"2026-02-01T14:30:00Z\",\n  \"completed_at\": \"2026-02-01T14:30:12Z\",\n  \"duration_seconds\": 12,\n  \"result\": {\n    \"periods_normalized\": 3,\n    \"overall_confidence\": 0.91,\n    \"cross_validation_score\": 0.88,\n    \"warnings\": 2,\n    \"errors\": 0\n  }\n}\n```\n\n**Status values:** `queued`, `processing`, `completed`, `failed`\n\n---\n\n## 12. Phasing\n\n### Phase 1: MVP (Rule-Based)\n\n**Timeline:** Included in MVP build (Phase 1 of overall CremoLogix roadmap)\n\n**Scope:**\n- Hard-coded normalization rules per entity type as defined in Section 7 of this document.\n- Tax form line-to-bucket mappings seeded in the `normalization_mappings` table.\n- Automatic add-back identification for: depreciation, amortization, officer compensation / guaranteed payments, federal income tax (C-Corp).\n- AI-suggested add-back identification for: one-time items, related-party rent adjustments. The AI (Claude) reviews the extracted data and suggests potential add-backs with explanations. The underwriter confirms or rejects each suggestion.\n- Cross-validation rules (Section 5) implemented as deterministic checks.\n- Confidence scoring (Section 6) with source hierarchy.\n- All six entity types supported.\n- Multi-period support (1-3 years).\n- Global Cash Flow computation.\n- Underwriter override capability with full audit trail.\n- All four API endpoints operational.\n\n**What is NOT in MVP:**\n- ML-based add-back identification (suggestions only, not auto-apply for non-obvious items).\n- Automated learning from underwriter corrections.\n- Plaid transaction-level categorization matching (Plaid data used for bank balance cross-validation only).\n- QuickBooks direct API integration (export file import only).\n- Seasonal adjustment models for interim annualization.\n\n### Phase 2: ML-Enhanced\n\n**Timeline:** Post-MVP, after sufficient portfolio data is accumulated (~100+ normalized cases)\n\n**Scope:**\n- ML models trained on underwriter-corrected normalization data to improve mapping accuracy.\n- Auto-identification of add-backs based on patterns in historical corrections. Example: if underwriters consistently add back a specific expense type for a specific industry, the model learns to suggest it automatically.\n- Confidence scores calibrated against actual correction rates (predicted confidence should match actual accuracy).\n- Plaid transaction-level categorization matching against reported expense categories.\n- QuickBooks direct API integration via Plaid for real-time accounting data.\n- Industry-specific normalization adjustments (e.g., construction: percentage-of-completion revenue recognition; restaurants: tip income handling; real estate: depreciation treatment for investment properties).\n- Seasonal adjustment models using historical cash flow patterns to produce more accurate interim annualization.\n- Anomaly detection: ML model flags unusual patterns (sudden expense category changes, revenue spikes without corresponding COGS increases, unexplained balance sheet movements).\n\n**Training Data Requirements:**\n- Minimum 100 normalized and underwriter-reviewed cases across at least 3 entity types.\n- Each case must have: original normalization, underwriter overrides (if any), final confirmed values.\n- Training runs quarterly with new data.\n- Model versioning with A/B testing against rule-based baseline.\n\n---\n\n## 13. Acceptance Criteria\n\nEach criterion includes a concrete test scenario and expected outcome.\n\n### AC-1: Normalize a Sole Proprietor (Schedule C)\n\n**Scenario:** A sole proprietor barbershop files Schedule C. Gross receipts: $185,000. COGS: $12,000. Depreciation (Line 13): $8,500. Wages (Line 26): $45,000. Rent (Line 20b): $24,000. Net profit (Line 31): $62,300. No balance sheet (sole prop).\n\n**Expected Output:**\n- `IS_GROSS_REVENUE` = $185,000\n- `IS_COGS` = $12,000\n- `IS_GROSS_PROFIT` = $173,000\n- `IS_OPEX_PAYROLL` = $45,000\n- `IS_OPEX_RENT` = $24,000\n- `IS_OPEX_DEPRECIATION` = $8,500\n- `IS_NET_INCOME` = $62,300\n- `AB_DEPRECIATION` = $8,500\n- `IS_ADJUSTED_CF` = $62,300 + $8,500 = $70,800\n- `IS_OWNER_COMP` (memo) = $62,300 (entire net profit)\n- Entity treatment = `sole_proprietor`\n\n**Verification:** Adjusted Cash Flow of $70,800 is the correct number to use for business DSCR.\n\n### AC-2: Normalize an S-Corp (Form 1120-S)\n\n**Scenario:** An S-Corp consulting firm. Gross receipts (Line 1a): $950,000. COGS: $0 (service business). Officer compensation (Line 7): $150,000. Salaries/wages (Line 8): $280,000. Rent (Line 11): $48,000. Depreciation (Line 14): $22,000. Other deductions (Line 19): $85,000 (includes $5,000 amortization). Ordinary business income (Line 21): $365,000. Shareholder distributions (Schedule K Line 16d): $200,000.\n\n**Expected Output:**\n- `IS_GROSS_REVENUE` = $950,000\n- `IS_COGS` = $0\n- `IS_GROSS_PROFIT` = $950,000\n- `IS_OPEX_PAYROLL` = $280,000 + $150,000 = $430,000 (wages + officer comp)\n- `IS_OPEX_RENT` = $48,000\n- `IS_OPEX_DEPRECIATION` = $22,000\n- `IS_OPEX_AMORTIZATION` = $5,000\n- `IS_OPEX_OTHER` = $80,000 (Other deductions minus amortization)\n- `IS_NET_INCOME` = $365,000\n- `IS_OWNER_COMP` = $150,000 (officer comp only for memo line)\n- `AB_OWNER_COMP` = $150,000 + $200,000 = $350,000 (officer comp + distributions)\n- `AB_DEPRECIATION` = $22,000\n- `AB_AMORTIZATION` = $5,000\n- `IS_ADJUSTED_CF` = $365,000 + $350,000 + $22,000 + $5,000 = $742,000\n\n**Verification:** Adjusted Cash Flow of $742,000 correctly captures all cash available to the owner(s) including compensation, distributions, and non-cash expenses.\n\n### AC-3: Normalize a C-Corp (Form 1120)\n\n**Scenario:** A C-Corp manufacturing company. Gross receipts (Line 1a): $2,400,000. COGS (Line 2): $1,440,000. Officer compensation (Line 12): $200,000. Salaries (Line 13): $380,000. Rent (Line 16): $96,000. Depreciation (Line 20): $65,000. Charitable contributions (Line 19): $10,000. Other deductions (Line 26): $120,000. Taxable income (Line 30): $89,000. Total tax (Line 31): $18,690.\n\n**Expected Output:**\n- `IS_GROSS_REVENUE` = $2,400,000\n- `IS_COGS` = $1,440,000\n- `IS_GROSS_PROFIT` = $960,000\n- `IS_NET_INCOME` = $89,000 - $18,690 = $70,310 (after tax)\n- `AB_OWNER_COMP` = $200,000\n- `AB_DEPRECIATION` = $65,000\n- `AB_FIT` = $18,690\n- `AB_ONE_TIME` = $10,000 (charitable, discretionary)\n- `IS_ADJUSTED_CF` = $70,310 + $200,000 + $65,000 + $18,690 + $10,000 = $364,000\n\n**Verification:** Adjusted Cash Flow of $364,000 includes the C-Corp-specific add-back of federal income tax ($18,690) to normalize against pass-through entities.\n\n### AC-4: Cross-Validate Tax Return Against Bank Deposits\n\n**Scenario:** S-Corp reports gross receipts of $950,000 on Form 1120-S. Bank statements for the same 12-month period show total deposits of $1,185,000 (includes $100,000 loan proceeds and $50,000 inter-account transfer).\n\n**Expected Behavior:**\n- Raw bank deposits: $1,185,000\n- Adjustments: -$100,000 (loan proceeds), -$50,000 (transfers) = $1,035,000 adjusted deposits\n- Reported revenue: $950,000\n- Variance: |$1,035,000 - $950,000| / $1,035,000 = 8.2%\n- Rule XV-002 tolerance: 15%\n- **Result:** PASS (8.2% < 15%)\n- If adjusted deposits were $1,200,000: variance = 20.8%, **Result:** WARNING (between 15% and 25%)\n\n### AC-5: Produce Global DSCR from Combined Personal + Business Data\n\n**Scenario:** S-Corp owner (from AC-2) with personal data: W-2 from subject business: $150,000 (exclude -- already in business), W-2 from spouse's employer: $55,000, rental income: $12,000/yr. Personal obligations: mortgage $2,400/mo, auto $450/mo, student loans $300/mo. Proposed new business loan: $500,000 at 7.5% for 10 years (annual P&I ~$71,676). Existing business debt service: $48,000/yr.\n\n**Expected Computation:**\n```\nBusiness Adjusted Cash Flow:               $742,000\nPersonal Income (non-subject-business):      $67,000  ($55,000 + $12,000)\nPersonal Obligations:                       ($37,800) ($2,400*12 + $450*12 + $300*12)\nEstimated Personal Taxes & Living:          ($48,000) (default estimate)\n\nGlobal Cash Flow Available =\n  $742,000 + $67,000 - $37,800 - $48,000 = $723,200\n\nTotal Debt Service:\n  Existing business:   $48,000\n  Proposed new loan:   $71,676\n  Personal mortgage:   $28,800\n  Personal auto:        $5,400\n  Personal student:     $3,600\n  Total:              $157,476\n\nGlobal DSCR = $723,200 / $157,476 = 4.59x\n```\n\n### AC-6: Underwriter Override with Audit Trail\n\n**Scenario:** Underwriter reviews the normalized S-Corp data (AC-2) and determines that $30,000 of the \"Other deductions\" was actually a one-time relocation expense. Underwriter overrides `ab_one_time` from $0 to $30,000.\n\n**Expected Behavior:**\n1. PUT `/api/v1/financial/normalized/{caseId}/override` succeeds with field_code `ab_one_time`, new_value $30,000, reason \"One-time office relocation expense per borrower documentation.\"\n2. `ab_total` recalculates: $350,000 + $22,000 + $5,000 + $30,000 = $407,000\n3. `is_adjusted_cf` recalculates: $365,000 + $407,000 = $772,000\n4. `global_dscr` recalculates accordingly.\n5. `normalization_audit` contains a `field_overridden` event with the underwriter's user ID, timestamp, original value ($0), override value ($30,000), and reason.\n6. `normalized_financial_overrides` contains an active override record.\n7. GET `/api/v1/financial/normalized/{caseId}/audit` returns the override event in the trail.\n8. The underwriter UI shows the overridden field with a visual indicator and tooltip showing the override history.\n\n---\n\n## Appendix A: Glossary\n\n| Term | Definition |\n|------|------------|\n| **Add-Back** | A non-cash or discretionary expense added back to net income to arrive at Adjusted Cash Flow. Used to normalize for entity type differences and arrive at true cash available for debt service. |\n| **Adjusted Cash Flow** | Net Income + Add-Backs. The key number for DSCR calculation. Represents the actual cash available to service debt. |\n| **DSCR (Debt Service Coverage Ratio)** | Adjusted Cash Flow / Annual Debt Service. The primary metric for loan repayment ability. Minimum typically 1.25x for CDFIs. |\n| **Global DSCR** | DSCR computed using combined business + personal cash flows and all business + personal debt obligations. Provides a complete picture of the guarantor's repayment ability. |\n| **Normalization** | The process of converting diverse financial data formats into a single standardized structure that enables comparison regardless of entity type or source format. |\n| **Pass-Through Entity** | An entity type (S-Corp, Partnership, Sole Prop) where business income \"passes through\" to the owner's personal tax return and is taxed at the individual level rather than the entity level. |\n| **Common-Sizing** | Expressing financial statement line items as percentages of a base (typically revenue for income statement, total assets for balance sheet) to enable comparison across different-sized businesses. |\n\n## Appendix B: Normalization Mapping Seed Data Count\n\n| Entity Type | Tax Form | Number of Mapping Rules |\n|------------|----------|------------------------|\n| Sole Proprietor | Schedule C | 28 line items |\n| S-Corporation | Form 1120-S | 22 line items + 4 Schedule K items |\n| C-Corporation | Form 1120 | 24 line items |\n| Partnership | Form 1065 | 22 line items + 5 Schedule K items |\n| Nonprofit | Form 990 | 30 line items (Part VIII + Part IX + Part X) |\n| LLC | *Routed* | Uses mapping of elected entity type |\n\n**Total mapping rules to seed:** ~135 rules across all entity types.\n\n---\n\n*End of Financial Normalization Engine Specification Addendum*\n";
  document.getElementById('content').innerHTML = marked.parse(md);
</script>
</body>
</html>